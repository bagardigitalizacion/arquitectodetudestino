<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arquitecto de tu Destino - Eugenio Baeza Fares</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="imagenes/favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="imagenes/favicon.ico">
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'arquitecto-navy': '#1a2f4a',
                        'arquitecto-navy-dark': '#0f1f33',
                        'arquitecto-blue': '#4a9fc7',
                        'arquitecto-blue-light': '#5fb4dc',
                        'arquitecto-blue-dark': '#3b8ab5',
                        'arquitecto-gray': '#f5f7fa',
                    },
                    fontFamily: {
                        'sans': ['Poppins', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'slide-up': 'slide-up 0.5s ease-out',
                        'fade-in': 'fade-in 0.5s ease-out',
                        'scale-in': 'scale-in 0.3s ease-out',
                    },
                    keyframes: {
                        'float': {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        'slide-up': {
                            '0%': { transform: 'translateY(20px)', opacity: 0 },
                            '100%': { transform: 'translateY(0)', opacity: 1 }
                        },
                        'fade-in': {
                            '0%': { opacity: 0 },
                            '100%': { opacity: 1 }
                        },
                        'scale-in': {
                            '0%': { transform: 'scale(0.95)', opacity: 0 },
                            '100%': { transform: 'scale(1)', opacity: 1 }
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Librerías -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Vimeo Player API -->
    <script src="https://player.vimeo.com/api/player.js"></script>
    
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            overflow-x: hidden;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .hover-lift {
            transition: all 0.3s ease;
        }
        
        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15);
        }
        
        /* Custom scrollbar para zona blanca */
        .white-panel::-webkit-scrollbar {
            width: 8px;
        }
        
        .white-panel::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        .white-panel::-webkit-scrollbar-thumb {
            background: #1a2f4a;
            border-radius: 4px;
        }
        
        .white-panel::-webkit-scrollbar-thumb:hover {
            background: #0f1f33;
        }
        
        /* Custom scrollbar general */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #1a2f4a;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #0f1f33;
        }
        
        /* Video de fondo con overlay */
        .architect-video {
            position: relative;
            overflow: hidden;
        }
        
        .architect-video video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: 80% center;
        }
        
        .architect-video::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2;
        }

        /* Zona blanca con scroll independiente */
        .white-panel {
            overflow-y: auto;
            height: 100vh;
            background: black;
        }

        /* Zona de imagen fija */
        .image-section {
            position: fixed;
            left: 0;
            top: 0;
            width: 65%;
            height: 100vh;
        }

        /* Zona blanca ajustada */
        .content-section {
            margin-left: 65%;
            width: 35%;
            min-height: 100vh;
        }

        /* Responsive mobile */
        @media (max-width: 1024px) {
            .image-section {
                position: relative;
                width: 100%;
                height: 50vh;
                min-height: 400px;
            }
            
            .content-section {
                margin-left: 0;
                width: 100%;
                min-height: 50vh;
                position: relative;
                z-index: 10;
            }
            
            .white-panel {
                height: auto;
                min-height: 50vh;
                overflow-y: visible;
            }
        }
        
        /* Estilos para el recuadro gris responsive */
        .gray-box-responsive {
            width: 450px;
            height: 92vh;
            max-height: 680px;
        }
        
        /* Media query para móviles */
        @media (max-width: 768px) {
            .gray-box-responsive {
                width: 90vw;
                max-width: 400px;
                height: 100vh;
                max-height: 900px;
            }
        }
        
        /* Media query para laptop y tablet - mover textos más abajo */
        @media (min-width: 769px) {
            .architect-video .absolute.inset-0 {
                padding-top: 240px;
            }
        }
        
        /* Estilos para imagen de fallback */
        .architect-image-fallback {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('imagenes/arquitecto2.jpg');
            background-size: cover;
            background-position: 15% center;
            background-repeat: no-repeat;
        }
    </style>
</head>
<body class="bg-white">
    
    <!-- SECCIÓN 1: PÁGINA DE INICIO (Para usuarios logueados) -->
    <div id="inicioSection" class="min-h-screen" style="display: none;">
        <!-- Cabecera con navegación -->
        <header class="bg-arquitecto-navy shadow-lg sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <div class="flex justify-between items-center">
                    <div class="text-white">
                        <div class="text-xs md:text-sm">Eugenio Baeza Fares</div>
                        <div class="text-sm md:text-xl font-bold">ARQUITECTO DE TU DESTINO</div>
                    </div>
                    
                    <!-- Navegación Desktop (oculta en móvil) -->
                    <div class="hidden md:flex items-center space-x-6">
                        <nav class="flex space-x-6">
                            <button onclick="showSection('inicio')" id="navInicio" class="text-white hover:text-gray-300 transition-colors font-medium border-b-2 border-transparent hover:border-white">
                                Inicio
                            </button>
                            <button onclick="showSection('viaje')" id="navViaje" class="text-white hover:text-gray-300 transition-colors font-medium border-b-2 border-transparent hover:border-white">
                                Inicio de tu viaje
                            </button>
                        </nav>
                        <div class="relative">
                            <button onclick="toggleUserMenu()" id="userMenuButton" class="w-12 h-12 bg-white rounded-full flex items-center justify-center text-arquitecto-navy font-bold text-lg shadow-md hover:shadow-lg transition-shadow">
                                U
                            </button>
                            <!-- Menú desplegable del usuario (solo desktop) -->
                            <div id="userDropdown" class="hidden absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border border-gray-200 z-50">
                                <div class="p-4">
                                    <div class="flex items-center space-x-3 mb-3">
                                        <div class="w-12 h-12 flex-shrink-0 bg-arquitecto-navy rounded-full flex items-center justify-center text-white font-bold text-lg user-avatar">
                                            U
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <div class="font-semibold text-gray-800 break-words" id="userNameDisplay">Usuario</div>
                                            <div class="text-sm text-gray-600 truncate" id="userEmailDisplay">email@ejemplo.com</div>
                                        </div>
                                    </div>
                                    <hr class="border-gray-200 mb-3">
                                    <button onclick="logout()" class="w-full flex items-center space-x-2 px-3 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">
                                        <i class="fas fa-sign-out-alt"></i>
                                        <span>Salir</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Navegación Móvil (visible solo en móvil) -->
                    <div class="flex md:hidden items-center space-x-3">
                        <!-- Botón menú hamburguesa -->
                        <button onclick="toggleMobileMenu()" id="mobileMenuButton" class="text-white hover:text-gray-300 text-2xl font-bold">
                            ☰
                        </button>
                        <div id="mobileUserMenuButton" class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-arquitecto-navy font-bold text-sm shadow-md user-avatar">
                            U
                        </div>
                    </div>
                </div>
                
                <!-- Menú móvil desplegable -->
                <div id="mobileMenu" class="hidden md:hidden bg-arquitecto-navy-dark border-t border-gray-600">
                    <div class="px-4 py-2 space-y-2">
                        <button onclick="showSection('inicio'); closeMobileMenu();" class="block w-full text-left text-white hover:text-gray-300 py-2 font-medium">
                            Inicio
                        </button>
                        <button onclick="showSection('viaje'); closeMobileMenu();" class="block w-full text-left text-white hover:text-gray-300 py-2 font-medium">
                            Inicio de tu viaje
                        </button>
                        <hr class="border-gray-600 my-2">
                        <button onclick="logout(); closeMobileMenu();" class="block w-full text-left text-white hover:text-gray-300 py-2 font-medium">
                            <i class="fas fa-sign-out-alt mr-2"></i>Salir
                        </button>
                    </div>
                </div>
            </div>
        </header>


        <!-- Franja negra con imagen de fondo -->
        <!-- Versión Desktop/Tablet (md y superior) -->
        <div class="hidden md:block relative h-48 bg-black">
            <!-- Bloque negro más pequeño con imagen -->
            <div class="absolute left-0 top-0 h-full bg-black" style="width: 288px; background-image: url('imagenes/arquitecto4.jpg'); background-size: cover; background-position: center 35%; background-repeat: no-repeat;">
            </div>
            
            <!-- Textos centrados a la derecha del bloque negro -->
            <div class="absolute h-full flex flex-col justify-center items-center text-white px-12" style="left: 288px; right: 0; top: 0;">
                <h1 class="text-3xl font-bold mb-3 text-center">Sé el arquitecto de tu propio destino</h1>
                <p class="text-xl text-center">¿Estás listo para escribir tu propia historia?</p>
            </div>
        </div>
        
        <!-- Versión Móvil (solo sm) - Layout Vertical -->
        <div class="block md:hidden">
            <!-- Imagen arriba -->
            <div class="w-full h-48 bg-black">
                <img src="imagenes/arquitecto4.jpg" 
                     alt="Escultura del Arquitecto" 
                     class="w-full h-full object-cover object-center">
            </div>
            <!-- Textos abajo -->
            <div class="bg-black text-white py-6 px-4 text-center">
                <h1 class="text-xl font-bold mb-2">Sé el arquitecto de tu propio destino</h1>
                <p class="text-sm">¿Estás listo para escribir tu propia historia?</p>
            </div>
        </div>

        <!-- Sección azul con contenido educativo -->
        <div class="bg-arquitecto-navy text-white py-16">
            <div class="max-w-6xl mx-auto px-4">
                <h2 class="text-2xl font-bold mb-8 text-center">Este taller es una invitación a tomar conciencia de ese poder. Aprenderás a:</h2>
                <div class="grid md:grid-cols-2 gap-6 text-base">
                    <div class="flex items-start space-x-3">
                        <div class="w-2 h-2 bg-white rounded-full mt-2 flex-shrink-0"></div>
                        <p>Reconocer tu libertad y potencial: Entender que tienes el control sobre tus decisiones y, por lo tanto, sobre la dirección de tu vida.</p>
                    </div>
                    <div class="flex items-start space-x-3">
                        <div class="w-2 h-2 bg-white rounded-full mt-2 flex-shrink-0"></div>
                        <p>Definir tu propósito: Clarificar qué es lo que realmente quieres ser y lograr, convirtiéndote en el protagonista de tu propia historia.</p>
                    </div>
                    <div class="flex items-start space-x-3">
                        <div class="w-2 h-2 bg-white rounded-full mt-2 flex-shrink-0"></div>
                        <p>Tomar acciones conscientes: Desarrollar la habilidad de tomar decisiones alineadas con tus valores y metas.</p>
                    </div>
                    <div class="flex items-start space-x-3">
                        <div class="w-2 h-2 bg-white rounded-full mt-2 flex-shrink-0"></div>
                        <p>Impactar positivamente tu entorno: Convertirte en una fuente de inspiración para tu familia, tu comunidad y, lo más importante, para ti mismo.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bloque gris azulado -->
        <div class="py-16" style="background-color: #E9ECEF;">
            <div class="max-w-4xl mx-auto px-4 text-center">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Conviértete en el héroe de tu vida.</h2>
                <p class="text-lg text-gray-700 leading-relaxed">
                    Este no es solo un taller, es una guía para la auto-reflexión y la acción dividida en 10 módulos. 
                    Te reto a mirarte al espejo con satisfacción, reconociendo el valor y la importancia de tu propia existencia. 
                    Aprende a construir un destino que te llene de plenitud y felicidad.
                </p>
            </div>
        </div>

        <!-- Sección de botones -->
        <div class="bg-white py-16">
            <div class="max-w-4xl mx-auto px-4">
                <!-- Contenedor de todos los botones -->
                <div class="flex flex-col items-center space-y-6">
                    <!-- Botón principal -->
                    <button onclick="showSection('viaje')" class="px-12 py-5 text-white font-bold rounded-lg hover:opacity-90 transition-opacity text-lg md:text-xl shadow-lg max-w-xs md:max-w-sm w-full" style="background-color: #1179B4;">
                        Inicio de tu viaje
                    </button>
                    
                    <!-- Botones secundarios -->
                    <div class="flex flex-col md:flex-row justify-center items-center space-y-4 md:space-y-0 md:space-x-6 w-full">
                        <button onclick="showObjetivoModal()" class="px-10 py-4 text-white font-semibold rounded-lg hover:opacity-90 transition-opacity text-lg shadow-md max-w-xs md:max-w-sm w-full" style="background-color: #1179B4;">
                            Objetivo
                        </button>
                        <button onclick="showFilosofiaModal()" class="px-10 py-4 text-white font-semibold rounded-lg hover:opacity-90 transition-opacity text-lg shadow-md max-w-xs md:max-w-sm w-full" style="background-color: #1179B4;">
                            Filosofía
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pie de página -->
        <footer class="bg-arquitecto-navy py-8">
            <div class="max-w-2xl mx-auto text-center">
                <p class="text-white font-medium">Arquitecto de tu destino 2025</p>
            </div>
        </footer>
    </div>

    <!-- Pantalla Principal de Bienvenida (SOLO PARA USUARIOS NO LOGUEADOS) -->
    <div id="welcomeScreen" class="h-screen flex" style="display: none;">
        <!-- Layout Unificado Responsive -->
        <div class="w-full h-screen relative">
            <!-- Lado izquierdo - Video de fondo (65%) -->
            <div class="image-section architect-video">
                <!-- Video de fondo -->
                <video 
                    autoplay 
                    muted 
                    loop 
                    playsinline 
                    preload="auto"
                    onloadeddata="onArchitectVideoLoaded()"
                    onerror="onArchitectVideoError()"
                    id="architectVideoPlayer">
                    <source src="videos/arquitecto.mp4" type="video/mp4">
                    <!-- Fallback para navegadores que no soportan video -->
                    Su navegador no soporta el elemento video.
                </video>
                
                <!-- Imagen de fallback (oculta por defecto) -->
                <div id="architectImageFallback" class="architect-image-fallback" style="display: none;">
                </div>
                
                <div class="absolute inset-0 flex flex-col justify-center p-6 lg:p-12 z-10">
                    <div class="text-white text-center lg:text-left">
                        <!-- Eugenio Baeza Fares NO centrado -->
                        <p class="text-lg lg:text-2xl mb-2 lg:mb-4">Eugenio Baeza Fares</p>
                        <!-- Arquitecto de tu Destino alineado igual que Eugenio Baeza Fares -->
                        <h1 class="text-3xl lg:text-5xl font-bold">Arquitecto de tu Destino</h1>
                    </div>
                </div>
            </div>
            
            <!-- Lado derecho - Zona con recuadro gris (35%) -->
            <div class="content-section bg-black">
                <div class="white-panel">
                    <!-- Contenido inicial de bienvenida -->
                    <div id="welcomeContent" class="p-4 h-full flex flex-col justify-center">
                        <div class="mx-auto bg-arquitecto-gray rounded-xl p-6 shadow-lg flex flex-col justify-center gray-box-responsive">
                            <h2 class="text-3xl font-bold text-arquitecto-navy mb-6 text-center">Conviértete en el arquitecto de tu destino</h2>
                            
                            <button onclick="showIntroVideo()" class="w-full py-3 bg-arquitecto-blue text-white font-semibold rounded-lg hover:bg-arquitecto-blue-dark transition-colors mb-4 relative z-20 text-base">
                                <i class="fas fa-play mr-2"></i>Ver Video Introductorio
                            </button>
                            
                            <button onclick="showRegister()" class="w-full py-3 bg-arquitecto-navy text-white font-semibold rounded-lg hover:bg-arquitecto-navy-dark transition-colors mb-6 relative z-20 text-base">
                                Comenzar mi Viaje
                            </button>
                            
                            <p class="text-gray-600 text-sm text-center">
                                ¿Ya tienes cuenta? 
                                <a href="#" onclick="showLogin()" class="text-arquitecto-navy hover:text-arquitecto-navy-dark underline relative z-20">
                                    Inicia sesión
                                </a>
                            </p>
                        </div>
                    </div>

                    <!-- Formulario de Registro -->
                    <div id="registerForm" class="hidden p-4 h-full flex flex-col justify-center">
                        <div class="mx-auto bg-arquitecto-gray rounded-xl p-6 shadow-lg flex flex-col justify-center gray-box-responsive">
                            <h2 class="text-xl font-bold text-arquitecto-navy mb-6 text-center">Comienza tu viaje</h2>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Nombre completo</label>
                                    <input type="text" id="userName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-arquitecto-navy focus:outline-none transition-colors text-base" placeholder="Tu nombre">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                    <input type="email" id="userEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-arquitecto-navy focus:outline-none transition-colors text-base" placeholder="tu@email.com">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Contraseña</label>
                                    <input type="password" id="userPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-arquitecto-navy focus:outline-none transition-colors text-base" placeholder="••••••••">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-3">¿Cuál es tu mayor motivación?</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input type="radio" name="motivation" value="relaciones" class="w-4 h-4 text-arquitecto-navy mr-3">
                                            <span class="text-gray-700 text-sm">Mejorar mis relaciones</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="motivation" value="proposito" class="w-4 h-4 text-arquitecto-navy mr-3">
                                            <span class="text-gray-700 text-sm">Encontrar mi propósito</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="motivation" value="balance" class="w-4 h-4 text-arquitecto-navy mr-3">
                                            <span class="text-gray-700 text-sm">Balance vida-trabajo</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="motivation" value="crecimiento" class="w-4 h-4 text-arquitecto-navy mr-3">
                                            <span class="text-gray-700 text-sm">Crecimiento personal</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="motivation" value="transformacion" checked class="w-4 h-4 text-arquitecto-navy mr-3">
                                            <span class="text-gray-700 text-sm">Transformación integral</span>
                                        </label>
                                    </div>
                                </div>

                                <button onclick="completeRegistration()" class="w-full py-3 bg-arquitecto-navy text-white font-semibold rounded-lg hover:bg-arquitecto-navy-dark transition-colors relative z-20 text-base">
                                    Comenzar mi Viaje
                                </button>
                                
                                <button onclick="backToWelcome()" class="w-full py-3 border border-arquitecto-navy text-arquitecto-navy font-semibold rounded-lg hover:bg-gray-50 transition-colors relative z-20 text-base">
                                    Regresar
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Formulario de Login -->
                    <div id="loginForm" class="hidden p-4 h-full flex flex-col justify-center">
                        <div class="mx-auto bg-arquitecto-gray rounded-xl p-6 shadow-lg flex flex-col justify-center gray-box-responsive">
                            <h2 class="text-xl font-bold text-arquitecto-navy mb-6 text-center">Bienvenido</h2>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                    <input type="email" id="loginEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-arquitecto-navy focus:outline-none transition-colors text-base" placeholder="tu@email.com">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Contraseña</label>
                                    <input type="password" id="loginPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-arquitecto-navy focus:outline-none transition-colors text-base" placeholder="••••••••">
                                </div>

                                <button onclick="processLogin()" class="w-full py-3 bg-arquitecto-navy text-white font-semibold rounded-lg hover:bg-arquitecto-navy-dark transition-colors relative z-20 text-base">
                                    INICIAR SESIÓN
                                </button>
                                
                                <button onclick="backToWelcome()" class="w-full py-3 border border-arquitecto-navy text-arquitecto-navy font-semibold rounded-lg hover:bg-gray-50 transition-colors relative z-20 text-base">
                                    Regresar
                                </button>

                                <p class="text-center text-gray-600 text-sm">
                                    ¿No tienes cuenta? 
                                    <a href="#" onclick="showRegister()" class="text-arquitecto-navy hover:text-arquitecto-navy-dark underline relative z-20">
                                        Regístrate aquí
                                    </a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SECCIÓN 2: DASHBOARD (INICIO DE TU VIAJE) -->
    <div id="viajeSection" class="min-h-screen" style="display: none;">
        <!-- Cabecera idéntica -->
        <header class="bg-arquitecto-navy shadow-lg sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <!-- Versión Desktop/Tablet (md y superior) -->
                <div class="hidden md:flex justify-between items-center">
                    <div class="text-white">
                        <div class="text-sm">Eugenio Baeza Fares</div>
                        <div class="text-xl font-bold">ARQUITECTO DE TU DESTINO</div>
                    </div>
                    <div class="flex items-center space-x-6">
                        <nav class="flex space-x-6">
                            <button onclick="showSection('inicio')" class="text-white hover:text-gray-300 transition-colors font-medium border-b-2 border-transparent hover:border-white">
                                Inicio
                            </button>
                            <button onclick="showSection('viaje')" class="text-white hover:text-gray-300 transition-colors font-medium border-b-2 border-transparent hover:border-white">
                                Inicio de tu viaje
                            </button>
                        </nav>
                        <div class="relative">
                            <button onclick="toggleUserMenuViaje()" class="w-12 h-12 bg-white rounded-full flex items-center justify-center text-arquitecto-navy font-bold text-lg shadow-md hover:shadow-lg transition-shadow user-avatar">
                                U
                            </button>
                            <!-- Menú desplegable del usuario (solo desktop) -->
                            <div id="userDropdownViaje" class="hidden absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border border-gray-200 z-50">
                                <div class="p-4">
                                    <div class="flex items-center space-x-3 mb-3">
                                        <div class="w-12 h-12 flex-shrink-0 bg-arquitecto-navy rounded-full flex items-center justify-center text-white font-bold text-lg user-avatar">
                                            U
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <div class="font-semibold text-gray-800 break-words" id="userNameDisplayViaje">Usuario</div>
                                            <div class="text-sm text-gray-600 truncate" id="userEmailDisplayViaje">email@ejemplo.com</div>
                                        </div>
                                    </div>
                                    <hr class="border-gray-200 mb-3">
                                    <button onclick="logout()" class="w-full flex items-center space-x-2 px-3 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">
                                        <i class="fas fa-sign-out-alt"></i>
                                        <span>Salir</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Versión Móvil (solo sm) -->
                <div class="flex md:hidden justify-between items-center">
                    <div class="text-white">
                        <div class="text-xs">Eugenio Baeza Fares</div>
                        <div class="text-sm font-bold">ARQUITECTO DE TU DESTINO</div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <!-- Botón menú hamburguesa -->
                        <button onclick="toggleMobileMenuViaje()" class="text-white hover:text-gray-300 text-2xl font-bold">
                            ☰
                        </button>
                        <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-arquitecto-navy font-bold text-sm shadow-md user-avatar">
                            U
                        </div>
                    </div>
                </div>
                
                <!-- Menú móvil desplegable -->
                <div id="mobileMenuViaje" class="hidden md:hidden bg-arquitecto-navy-dark border-t border-gray-600">
                    <div class="px-4 py-2 space-y-2">
                        <button onclick="showSection('inicio'); closeMobileMenuViaje();" class="block w-full text-left text-white hover:text-gray-300 py-2 font-medium">
                            Inicio
                        </button>
                        <button onclick="showSection('viaje'); closeMobileMenuViaje();" class="block w-full text-left text-white hover:text-gray-300 py-2 font-medium">
                            Inicio de tu viaje
                        </button>
                        <hr class="border-gray-600 my-2">
                        <button onclick="logout(); closeMobileMenuViaje();" class="block w-full text-left text-white hover:text-gray-300 py-2 font-medium">
                            <i class="fas fa-sign-out-alt mr-2"></i>Salir
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Franja negra con estadísticas -->
        <div class="bg-black py-8">
            <div class="max-w-7xl mx-auto px-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="text-center text-white">
                        <div class="text-4xl font-bold mb-2" id="completedModulesCount">0</div>
                        <div class="text-lg">Módulos Completados</div>
                        <i class="fas fa-book text-2xl mt-2"></i>
                    </div>
                    <div class="text-center text-white">
                        <div class="text-4xl font-bold mb-2" id="exercisesCompletedCount">0</div>
                        <div class="text-lg">Ejercicios realizados</div>
                        <i class="fas fa-dumbbell text-2xl mt-2"></i>
                    </div>
                    <div class="text-center text-white">
                        <div class="text-4xl font-bold mb-2" id="globalProgressPercent">0%</div>
                        <div class="text-lg">Progreso global</div>
                        <div class="w-full bg-gray-600 rounded-full h-2 mt-2">
                            <div class="bg-white h-2 rounded-full" style="width: 0%" id="globalProgressBar"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contenido principal del dashboard -->
        <div class="bg-arquitecto-gray min-h-screen py-8">
            <div class="max-w-7xl mx-auto px-4">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Módulos del lado izquierdo con fondo azul -->
                    <div class="lg:col-span-2">
                        <div class="bg-arquitecto-navy rounded-xl p-6">
                            <h2 class="text-2xl font-bold text-white mb-4">Tu Viaje de Transformación - 10 Módulos</h2>
                            <p class="text-white/80 text-sm mb-6">Antes de comenzar te invitamos a descargar el <a href="https://bafar1.sharepoint.com/sites/Digitalizacin/proyectos/Arquitectodetudestino/pdf/Cuaderno_ADTD.pdf" target="_blank" class="text-white underline hover:text-white/90 transition-colors">cuadernillo de trabajo</a></p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="modulesContainer">
                                <!-- Los módulos se generarán aquí dinámicamente -->
                            </div>
                        </div>
                    </div>

                    <!-- Panel lateral derecho -->
                    <div class="space-y-6">
                        <!-- Próxima Meta con fondo azul claro -->
                        <div class="rounded-xl p-6 shadow-lg text-black" style="background-color: #5fb4dc;">
                            <h3 class="text-xl font-bold mb-4">Próxima Meta</h3>
                            <p id="nextGoalText">Completar el Módulo 1: El Emprendedor</p>
                        </div>

                        <!-- Complementos -->
                        <div class="bg-white rounded-xl p-6 shadow-lg">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">Complementos</h3>
                            <div class="space-y-3">
                                <button onclick="showIntroVideo()" class="w-full flex items-center space-x-3 p-3 text-left hover:bg-gray-50 rounded-lg transition-colors">
                                    <i class="fas fa-play text-arquitecto-blue"></i>
                                    <span>Video Introductorio</span>
                                </button>
                                <button onclick="showVision()" class="w-full flex items-center space-x-3 p-3 text-left hover:bg-gray-50 rounded-lg transition-colors">
                                    <i class="fas fa-eye text-arquitecto-blue"></i>
                                    <span>Mi Visión Personal</span>
                                </button>
                                <button onclick="showLifeWheel()" class="w-full flex items-center space-x-3 p-3 text-left hover:bg-gray-50 rounded-lg transition-colors">
                                    <i class="fas fa-circle-notch text-arquitecto-blue"></i>
                                    <span>Rueda Motivacional</span>
                                </button>
                                <button onclick="showConfidenceTest()" class="w-full flex items-center space-x-3 p-3 text-left hover:bg-gray-50 rounded-lg transition-colors">
                                    <i class="fas fa-user-check text-arquitecto-blue"></i>
                                    <span>Test de Confianza</span>
                                </button>
                                <a href="pdf/Cuaderno_ADTD.pdf" target="_blank" class="w-full flex items-center space-x-3 p-3 text-left hover:bg-gray-50 rounded-lg transition-colors">
                                    <i class="fas fa-file-pdf text-arquitecto-blue"></i>
                                    <span>Cuaderno de Trabajo</span>
                                </a>
                            </div>
                        </div>

                        <!-- Reflexión del Día -->
                        <div class="bg-white rounded-xl p-6 shadow-lg">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">Reflexión del Día</h3>
                            <p class="text-gray-600 italic" id="dailyReflection">El ejemplo es la mejor educación para los hijos.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Pie de página -->
        <footer class="bg-arquitecto-navy py-8">
            <div class="max-w-2xl mx-auto text-center">
                <p class="text-white font-medium">Arquitecto de tu destino 2025</p>
            </div>
        </footer>
    </div>

    <!-- Dashboard Principal (VERSIÓN ANTIGUA - AHORA MODAL) -->
    <div id="dashboard" class="hidden min-h-screen bg-arquitecto-gray">
        <!-- Header Modernizado -->
        <header class="bg-arquitecto-navy shadow-lg sticky top-0 z-50 border-b border-arquitecto-navy-dark">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <div class="flex justify-between items-center">
                    <div>
                        <h1 class="text-2xl font-bold text-white">ARQUITECTO DE TU DESTINO</h1>
                        <p class="text-sm text-white mt-1">Eugenio Baeza Fares</p>
                    </div>
                    <div class="flex items-center space-x-6">
                        <div class="text-right">
                            <div class="text-white font-semibold" id="userGreeting">¡Bienvenido!</div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <button onclick="logout()" class="text-white hover:text-gray-300 transition-colors text-sm font-medium flex items-center space-x-1" title="Cerrar sesión">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Salir</span>
                            </button>
                            <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center text-arquitecto-navy font-bold text-lg shadow-md" id="userAvatar">U</div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Barra de Estadísticas Modernizada -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">

                
                <div class="bg-white rounded-xl shadow-md p-6 hover-lift border-l-4 border-arquitecto-navy">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-3xl font-bold text-arquitecto-navy" id="completedChapters">3</div>
                            <div class="text-gray-600 text-sm mt-1">Módulos completados</div>
                        </div>
                        <div class="w-14 h-14 bg-arquitecto-navy/10 rounded-xl flex items-center justify-center">
                            <i class="fas fa-book text-arquitecto-navy text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-md p-6 hover-lift border-l-4 border-arquitecto-navy">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-3xl font-bold text-arquitecto-navy" id="exercisesDone">12</div>
                            <div class="text-gray-600 text-sm mt-1">Ejercicios realizados</div>
                        </div>
                        <div class="w-14 h-14 bg-arquitecto-navy/10 rounded-xl flex items-center justify-center">
                            <i class="fas fa-dumbbell text-arquitecto-navy text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-md p-6 hover-lift border-l-4 border-arquitecto-navy">
                    <div class="flex items-center justify-between">
                        <div class="w-full">
                            <div class="text-3xl font-bold text-arquitecto-navy" id="progressPercent">25%</div>
                            <div class="text-gray-600 text-sm mt-1">Progreso global</div>
                            <div class="w-full bg-gray-200 rounded-full h-3 mt-3 overflow-hidden">
                                <div class="h-full bg-arquitecto-navy rounded-full transition-all duration-1000 ease-out progress-fill" style="width: 25%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Grid Principal -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Sección de Capítulos -->
                <div class="lg:col-span-2">
                    <h2 class="text-2xl font-bold text-arquitecto-navy mb-4">Tu Viaje de Transformación - 10 Módulos</h2>
                    <p class="text-gray-600 text-sm mb-6">Antes de comenzar te invitamos a descargar el <a href="https://bafar1.sharepoint.com/sites/Digitalizacin/proyectos/Arquitectodetudestino/pdf/Cuaderno_ADTD.pdf" target="_blank" class="text-arquitecto-navy underline hover:text-arquitecto-navy/80 transition-colors">cuadernillo de trabajo</a></p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="chaptersGrid">
                        <!-- Los capítulos se generarán dinámicamente -->
                    </div>

                    <!-- Detalle del Capítulo (AHORA SERÁ MODAL) -->
                    <div id="chapterDetail" class="hidden mt-8 bg-white rounded-xl shadow-lg p-8">
                        <!-- El contenido del capítulo se generará dinámicamente -->
                    </div>
                </div>

                <!-- Panel Lateral Modernizado -->
                <div class="space-y-6">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-lg font-bold text-arquitecto-navy mb-4">Accesos Rápidos</h3>
                        <div class="space-y-3">
                            <a href="#" onclick="showIntroVideo()" class="flex items-center p-3 rounded-lg hover:bg-arquitecto-blue/5 transition-colors group border-l-2 border-transparent hover:border-arquitecto-blue">
                                <div class="w-10 h-10 bg-arquitecto-blue/10 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fas fa-play text-arquitecto-blue"></i>
                                </div>
                                <span class="text-gray-700 group-hover:text-arquitecto-blue font-medium">Video Introductorio</span>
                            </a>
                            <a href="#" onclick="showVision()" class="flex items-center p-3 rounded-lg hover:bg-arquitecto-navy/5 transition-colors group">
                                <div class="w-10 h-10 bg-arquitecto-navy/10 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fas fa-eye text-arquitecto-navy"></i>
                                </div>
                                <span class="text-gray-700 group-hover:text-arquitecto-navy">Mi Visión Personal</span>
                            </a>

                            <a href="#" onclick="showLifeWheel()" class="flex items-center p-3 rounded-lg hover:bg-arquitecto-navy/5 transition-colors group">
                                <div class="w-10 h-10 bg-arquitecto-navy/10 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fas fa-circle-notch text-arquitecto-navy"></i>
                                </div>
                                <span class="text-gray-700 group-hover:text-arquitecto-navy">Rueda Motivacional</span>
                            </a>
                            <a href="#" onclick="showConfidenceTest()" class="flex items-center p-3 rounded-lg hover:bg-arquitecto-navy/5 transition-colors group">
                                <div class="w-10 h-10 bg-arquitecto-navy/10 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fas fa-user-check text-arquitecto-navy"></i>
                                </div>
                                <span class="text-gray-700 group-hover:text-arquitecto-navy">Test de Confianza</span>
                            </a>
                            <a href="pdf/Cuaderno_ADTD.pdf" target="_blank" class="flex items-center p-3 rounded-lg hover:bg-arquitecto-navy/5 transition-colors group">
                                <div class="w-10 h-10 bg-arquitecto-navy/10 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fas fa-file-pdf text-arquitecto-navy"></i>
                                </div>
                                <span class="text-gray-700 group-hover:text-arquitecto-navy">Cuaderno de Trabajo</span>
                            </a>
                        </div>
                    </div>

                    <!-- Frase del Día -->
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-arquitecto-navy">
                        <h4 class="text-arquitecto-navy font-bold mb-3 flex items-center">
                            <i class="fas fa-quote-left text-arquitecto-navy mr-2"></i> Reflexión del Día
                        </h4>
                        <p class="text-gray-700 italic leading-relaxed" id="dailyQuote">
                            "El libre albedrío es el don más sublime que Dios nos ha concedido, es la oportunidad de decidir por nosotros mismos."
                        </p>
                    </div>

                    <!-- Próxima Meta -->
                    <div class="bg-gradient-to-br from-arquitecto-navy to-arquitecto-navy-dark rounded-xl p-6 text-white shadow-lg">
                        <h4 class="font-bold mb-3">
                            <i class="fas fa-flag mr-2"></i> Próxima Meta
                        </h4>
                        <p class="mb-3 text-white/90" id="nextGoalText">Completar el Módulo 1: El Emprendedor</p>
                        <div class="w-full bg-white/20 rounded-full h-2 overflow-hidden">
                            <div class="h-full bg-white rounded-full transition-all duration-1000 ease-out" id="nextGoalProgress" style="width: 0%;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal General Modernizado -->
    <div id="modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden animate-scale-in">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center bg-arquitecto-gray">
                <h2 id="modalTitle" class="text-2xl font-bold text-arquitecto-navy">Título</h2>
                <button onclick="closeModal()" class="text-gray-500 hover:text-arquitecto-navy transition-colors p-2 hover:bg-white rounded-lg">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="modalBody" class="p-6 overflow-y-auto max-h-[60vh]">
                <!-- Contenido dinámico -->
            </div>
        </div>
    </div>

    <!-- Modal de Objetivo -->
    <div id="objetivoModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-4xl w-full max-h-[80vh] overflow-y-auto shadow-2xl">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h2 class="text-2xl font-bold text-arquitecto-navy">Objetivo</h2>
                <button onclick="closeObjetivoModal()" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6">
                <p class="text-gray-700 leading-relaxed text-lg">
                    En este taller descubrirás la importancia de la auto-responsabilidad para diseñar la vida que deseas. No es un remedio rápido, sino un proceso de crecimiento continuo que te enseña a ser el arquitecto de tu propio destino. A través de una metodología integral, definirás una visión clara de tu futuro, aprenderás a superar tus propios límites y a utilizar tu libre albedrío como la herramienta principal para tomar decisiones. El objetivo es que encuentres un balance en todos tus roles, desarrolles tu independencia y comiences a construir hoy una vida más plena y satisfactoria, convirtiéndote en la persona que realmente quieres ser.
                </p>
            </div>
        </div>
    </div>

    <!-- Modal de Filosofía -->
    <div id="filosofiaModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-4xl w-full max-h-[80vh] overflow-y-auto shadow-2xl">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h2 class="text-2xl font-bold text-arquitecto-navy">Filosofía</h2>
                <button onclick="closeFilosofiaModal()" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6">
                <p class="text-gray-700 leading-relaxed text-lg">
                    Esta filosofía única no busca imponer reglas, sino ofrecerte herramientas para alcanzar tus metas y encontrar un balance entre tus roles de vida (familiar, profesional, personal y laboral). Se fundamenta en un principio clave: tú eres el Arquitecto de tu propio destino. Eres el dueño de tu vida y la forjas a través de tus decisiones, rechazando la excusa de que "el destino está escrito".
                    <br><br>
                    Aprenderás a usar el poder de la visión para definir con claridad la persona que quieres ser y a reconocer que el mayor reto eres tú mismo, eliminando el "no puedo" de tu vocabulario. Mediante la reflexión constante, te impulsarás a utilizar tus dones más valiosos: tu vida, tu tiempo y tu libre albedrío. El objetivo final es que, a través del trabajo diario, logres la meta más importante: "SER LO QUE QUIERAS LLEGAR A SER".
                </p>
            </div>
        </div>
    </div>

    <!-- Modal de Módulo (Para contenido completo de cada módulo) -->
    <div id="moduleModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-7xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center bg-arquitecto-navy text-white rounded-t-xl">
                <h2 class="text-2xl font-bold" id="moduleModalTitle">Módulo</h2>
                <button onclick="closeModuleModal()" class="text-white hover:text-gray-300 text-2xl font-bold">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-0" id="moduleModalContent">
                <!-- El contenido del módulo se cargará aquí dinámicamente -->
            </div>
        </div>
    </div>

    <!-- Modal de Configuración de Calendario -->
    <div id="calendarModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-lg w-full max-h-[85vh] animate-scale-in flex flex-col">
            <!-- Header fijo -->
            <div class="p-4 border-b border-gray-200 flex justify-between items-center bg-gradient-to-r from-arquitecto-blue to-arquitecto-blue-dark text-white rounded-t-xl flex-shrink-0">
                <h2 class="text-lg font-bold">
                    <i class="fas fa-calendar-plus mr-2"></i>Configurar Evento
                </h2>
                <button onclick="closeCalendarModal()" class="text-white/80 hover:text-white transition-colors p-1 hover:bg-white/10 rounded-lg">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
            
            <!-- Contenido scrolleable -->
            <div id="calendarModalBody" class="flex-1 overflow-y-auto p-4">
                <!-- Contenido de configuración del calendario -->
            </div>
            
            <!-- Botones fijos -->
            <div id="calendarModalButtons" class="p-4 border-t border-gray-200 bg-gray-50 rounded-b-xl flex-shrink-0">
                <!-- Los botones se generarán dinámicamente -->
            </div>
        </div>
    </div>

    <script>
        // Inicialización de AOS
        AOS.init({
            duration: 800,
            once: true,
            offset: 100
        });

        // Datos de los módulos basados en el análisis actualizado
        const chapters = [
            {
                id: 1,
                title: "El Emprendedor",
                description: "El emprendedor se crece con la emoción, tensión y riesgo de cada reto",
                status: "locked",
                video: {
                    duration: "Videos múltiples del módulo",
                    keyPoints: [
                        "Cada uno llega al mundo con un libro en blanco",
                        "El poder de crear nuestro futuro está en nuestras manos",
                        "Superación de la \"parálisis por análisis\"",
                        "El libre albedrío como don más hermoso",
                        "\"El único lugar donde el éxito viene primero que el trabajo, es en el diccionario\""
                    ],
                    videos: [
                        { id: "1.1", vimeoId: "1133552049", title: "El Emprendedor Parte 1", status: "available" },
                        { id: "1.2", vimeoId: "1133552270", title: "El Emprendedor Parte 2", status: "locked" },
                        { id: "1.3", vimeoId: "1133552330", title: "El Emprendedor Parte 3", status: "locked" },
                        { id: "1.4", vimeoId: "1133552303", title: "El Emprendedor Parte 4", status: "locked" },
                        { id: "1.5", vimeoId: "1133552526", title: "El Emprendedor Parte 5", status: "locked" }
                    ]
                },
                content: {
                    intro: "Cada uno de nosotros llega a este mundo con un libro en blanco, listo para ser llenado con la historia que deseemos escribir. Un emprendedor es una persona que está dispuesta a cambiar, es alguien que se convierte en un diseñador y creador de sí mismo.",
                    concepts: [
                        "Emprendedor como diseñador nato y creador",
                        "Visión clara de metas y mejoramiento día con día",
                        "Emoción, tensión y riesgo como combustible del crecimiento",
                        "Búsqueda del mejoramiento permanente",
                        "\"Sesenta segundos de combate bravío a cada minuto de nuestra vida\""
                    ],
                    exercise: {
                        title: "Autoevaluación del Emprendedor Interior",
                        type: "Autoevaluación emprendedora personal según cuadernillo de trabajo",
                        steps: [
                            "Completar autoevaluación diseñada en el cuadernillo",
                            "Identificar en qué punto del camino emprendedor me encuentro",
                            "Ser honesto y profundo en las respuestas",
                            "Crear el primer borrador del plano para construir el arquitecto interior",
                            "Definir áreas de mejoramiento emprendedor"
                        ]
                    },
                    reflection: {
                        questions: [
                            "¿Estoy viviendo la vida como realmente quisiera?",
                            "¿La estoy viviendo intensamente?",
                            "¿Estoy consciente de que el tiempo es lo más perecedero que existe?",
                            "Si en este momento sufriera un accidente y muriera, ¿estaba siendo y haciendo lo que había planeado para mi vida?",
                            "¿Estoy dispuesto a cambiar y mejorar permanentemente?"
                        ]
                    },
                    commitment: {
                        elements: [
                            "Característica emprendedora específica que desarrollaré",
                            "Plan de acción para vivir \"60 segundos de combate bravío\"",
                            "Compromiso con el mejoramiento permanente diario"
                        ]
                    }
                }
            },
            {
                id: 2,
                title: "La Visión",
                description: "La visión nos da libertad, independencia y seguridad",
                status: "locked",
                video: {
                    duration: "Videos múltiples del módulo",
                    keyPoints: [
                        "Visión como piedra angular del proceso",
                        "Libertad, Independencia y Seguridad como pilares",
                        "\"Sólo aquellos que ven lo invisible pueden hacer lo imposible\"",
                        "Visión como brújula interior",
                        "Autocontrol como base de la libertad"
                    ],
                    videos: [
                        { id: "2.1", vimeoId: "1133552094", title: "La Visión Parte 1", status: "locked" },
                        { id: "2.2", vimeoId: "1133552234", title: "La Visión Parte 2", status: "locked" },
                        { id: "2.3", vimeoId: "1133552480", title: "La Visión Parte 3", status: "locked" }
                    ]
                },
                content: {
                    intro: "Cuando tenemos una visión clara del futuro, obtenemos un sentido de vida muy definido. La visión nos proporciona libertad, independencia y seguridad. Es la acción mental de visualizar nuestro futuro deseado.",
                    concepts: [
                        "Libertad interior basada en autocontrol y convicciones propias",
                        "Independencia como decisión personal sobre lo que queremos ser",
                        "Seguridad proveniente del interior, orientada al \"ser\" más que al \"tener\"",
                        "Visión como instrumento que orienta hacia metas elegidas",
                        "\"No podemos elegir ciertas situaciones, pero sí nuestro comportamiento\""
                    ],
                    exercise: {
                        title: "Constructor de Visión Personal",
                        type: "Redacción y construcción de visión integral",
                        steps: [
                            "Redactar en el cuadernillo lo que quiero lograr",
                            "Ponerle fecha específica a cada meta",
                            "Definir actitud necesaria para hacerlo",
                            "Crear visión basada en \"cómo quiero ser\" y \"cómo me veo en el futuro\"",
                            "Establecer plan de revisión y seguimiento"
                        ]
                    },
                    reflection: {
                        questions: [
                            "¿Cómo quiero ser? ¿Cómo me veo en el futuro?",
                            "¿Tengo una visión clara que me dé libertad, independencia y seguridad?",
                            "¿Estoy construyendo mi futuro o alguien más lo está escribiendo?",
                            "¿Mi visión me permite decidir según mis convicciones y no según el entorno?"
                        ]
                    },
                    commitment: {
                        elements: [
                            "Mi visión específica escrita con fechas concretas",
                            "Plan para desarrollar autocontrol y libertad interior",
                            "Compromiso de revisar y ajustar mi visión regularmente"
                        ]
                    }
                }
            },
            {
                id: 3,
                title: "En Mi Relación con Dios",
                description: "En Dios encontraré el apoyo para transformar mis defectos en virtudes",
                status: "locked",
                video: {
                    duration: "Videos múltiples del módulo",
                    keyPoints: [
                        "Relación con Dios como fuente de fortaleza interna",
                        "Brújula interior para juicio sincero",
                        "Transformación de defectos en virtudes",
                        "La persona del espejo como juez más importante",
                        "Regla de oro: ¿Es bueno? ¿Es correcto? ¿Es verdadero?"
                    ],
                    videos: [
                        { id: "3.1", vimeoId: "1133552172", title: "En Mi Relación con Dios Parte 1", status: "locked" },
                        { id: "3.2", vimeoId: "1133551527", title: "En Mi Relación con Dios Parte 2", status: "locked" },
                        { id: "3.3", vimeoId: "1133551940", title: "En Mi Relación con Dios Parte 3", status: "locked" },
                        { id: "3.4", vimeoId: "1133551241", title: "En Mi Relación con Dios Parte 4", status: "locked" },
                        { id: "3.5", vimeoId: "1133551805", title: "En Mi Relación con Dios Parte 5", status: "locked" },
                        { id: "3.6", vimeoId: "1133552206", title: "En Mi Relación con Dios Parte 6", status: "locked" }
                    ]
                },
                content: {
                    intro: "En mi relación con Dios he de verme acudiendo a Él, en el éxito y en el fracaso, ya que en Él encontraré el apoyo para transformar mis defectos en virtudes, para mejorar la capacidad de comprensión de mí mismo y de los demás.",
                    concepts: [
                        "Diálogo interior claro, transparente y sincero",
                        "Brújula interior para ver sentimientos, debilidades y fortalezas",
                        "Análisis de acciones en pasado, presente y futuro",
                        "Identificación de los 7 defectos: Soberbia, Avaricia, Lujuria, Ira, Envidia, Gula, Pereza",
                        "Regla de oro como guía de acción diaria"
                    ],
                    exercise: {
                        title: "Inventario Espiritual y Transformación Personal",
                        type: "Autoevaluación espiritual y plan de transformación",
                        steps: [
                            "Identificar mi equipaje personal (procedencia, religión, personalidad, hábitos)",
                            "Evaluar cuáles de los 7 defectos me afectan más",
                            "Aplicar las 3 preguntas de la regla de oro a mis acciones",
                            "Crear plan para transformar un defecto específico en virtud",
                            "Establecer práctica diaria de comunicación interior"
                        ]
                    },
                    reflection: {
                        questions: [
                            "¿Puedo mirar a la persona del espejo directamente a los ojos?",
                            "¿Cuáles de los 7 defectos necesito transformar prioritariamente?",
                            "¿Estoy aplicando la regla de oro en mis decisiones diarias?",
                            "¿Mi comunicación con Dios es clara, transparente y sincera?"
                        ]
                    },
                    commitment: {
                        elements: [
                            "Un defecto específico que transformaré en virtud",
                            "Práctica diaria de aplicar la regla de oro",
                            "Plan para desarrollar comunicación interior sincera"
                        ]
                    }
                }
            },
            {
                id: 4,
                title: "El Rol de Hijo",
                description: "El tiempo con los padres es el más valioso y perecedero",
                status: "locked",
                video: {
                    duration: "Videos del módulo",
                    keyPoints: [
                        "El tiempo es lo más perecedero que existe",
                        "Amor incondicional de los padres",
                        "Hacerlos sentir útiles y generar sentimiento de utilidad",
                        "\"Como tratamos a nuestros padres, así seremos tratados\"",
                        "Importancia de convivir, disfrutar y amar al máximo"
                    ],
                    videos: [
                        { id: "4.1", vimeoId: "1133551701", title: "El Rol de Hijo Parte 1", status: "locked" },
                        { id: "4.2", vimeoId: "1133552507", title: "El Rol de Hijo Parte 2", status: "locked" }
                    ]
                },
                content: {
                    intro: "Como hijo, debo pensar que el tiempo es lo más perecedero que existe en la vida, por lo tanto, debo convivir, disfrutar y amar al máximo a mis padres. El amor de nuestros padres es el único amor verdaderamente incondicional; lo dan todo a cambio de nada.",
                    concepts: [
                        "Tiempo como elemento más perecedero de la vida",
                        "Amor incondicional e incomparable de los padres",
                        "Generar sentimiento de utilidad en los padres",
                        "Seguir aprendiendo de su sabiduría y experiencia",
                        "Ley de reciprocidad: como tratamos seremos tratados"
                    ],
                    exercise: {
                        title: "Plan de Acción Filial",
                        type: "Evaluación y mejora de la relación con los padres",
                        steps: [
                            "Evaluar tiempo actual dedicado a mis padres",
                            "Calcular cuántos años más tendré con ellos",
                            "Planificar actividades específicas de convivencia",
                            "Crear calendario de detalles y comunicación",
                            "Establecer tradiciones familiares nuevas"
                        ]
                    },
                    reflection: {
                        questions: [
                            "¿Cuánto tiempo de calidad dedico realmente a mis padres?",
                            "¿Los hago sentir útiles y necesarios?",
                            "¿Estoy aprovechando su sabiduría y experiencia?",
                            "¿Cómo quiero que mis hijos me traten en el futuro?"
                        ]
                    },
                    commitment: {
                        elements: [
                            "Tiempo específico semanal que dedicaré a mis padres",
                            "Acciones concretas para hacerlos sentir útiles",
                            "Plan para crear nuevos recuerdos y tradiciones familiares"
                        ]
                    }
                }
            },
            {
                id: 5,
                title: "El Rol de Padre",
                description: "El ejemplo es la mejor educación para los hijos",
                status: "locked",
                video: {
                    duration: "Videos del módulo",
                    keyPoints: [
                        "El ejemplo como modelo más poderoso",
                        "Tiempo dedicado como mejor inversión",
                        "Desarrollar visión en los hijos y ejercicio de libre albedrío",
                        "Confianza, comunicación y amor como elementos clave",
                        "Analogía del jabón: ni apretar mucho ni soltar demasiado"
                    ],
                    videos: [
                        { id: "5.1", vimeoId: "1133551440", title: "El Rol de Padre Parte 1", status: "locked" },
                        { id: "5.2", vimeoId: "1133552410", title: "El Rol de Padre Parte 2", status: "locked" }
                    ]
                },
                content: {
                    intro: "Como padre, debo aceptar que el ejemplo es la mejor educación para los hijos, y que el tiempo dedicado a ellos será mi mejor inversión. El mejor legado que podemos dejar no es material, sino buscar que desarrollen una visión de sí mismos y ejerzan su libre albedrío.",
                    concepts: [
                        "Ejemplo y congruencia como modelo más poderoso",
                        "Tiempo dedicado como mejor inversión",
                        "Desarrollo de visión personal en los hijos",
                        "Construcción de relación de confianza, comunicación y amor",
                        "Lograr que sean mejores que nosotros"
                    ],
                    exercise: {
                        title: "Plan de Paternidad Consciente",
                        type: "Evaluación y mejora del rol paternal",
                        steps: [
                            "Evaluar la calidad del ejemplo que estoy dando",
                            "Medir tiempo real de calidad con mis hijos",
                            "Identificar cómo estoy ayudando a desarrollar su visión personal",
                            "Crear plan para fortalecer confianza y comunicación",
                            "Establecer metas para su crecimiento y desarrollo"
                        ]
                    },
                    reflection: {
                        questions: [
                            "¿Qué ejemplo estoy dando a mis hijos con mis acciones?",
                            "¿Estoy invirtiendo tiempo de calidad en su desarrollo?",
                            "¿Los estoy ayudando a desarrollar su propia visión?",
                            "¿Mantengo el equilibrio entre guía y libertad?"
                        ]
                    },
                    commitment: {
                        elements: [
                            "Mejora específica en mi ejemplo personal",
                            "Tiempo de calidad semanal dedicado a cada hijo",
                            "Plan para ayudarlos a desarrollar su visión personal"
                        ]
                    }
                }
            },
            {
                id: 6,
                title: "El Rol de Pareja",
                description: "Formar la sociedad más importante de tu vida",
                status: "locked",
                video: {
                    duration: "Videos del módulo",
                    keyPoints: [
                        "Búsqueda de complemento, no solo diferencias",
                        "Sociedad más importante de la vida",
                        "Las personas cambian y evolucionan",
                        "Búsqueda constante y reencuentro continuo",
                        "\"Primero es la pareja y después son los hijos\""
                    ],
                    videos: [
                        { id: "6.1", vimeoId: "1133551619", title: "El Rol de Pareja Parte 1", status: "locked" },
                        { id: "6.2", vimeoId: "1133552456", title: "El Rol de Pareja Parte 2", status: "locked" }
                    ]
                },
                content: {
                    intro: "Como esposo, debo buscar a la persona que me pueda complementar y yo complementarla, para así, ser uno, con la cual formaré la sociedad más importante de mi vida. Las parejas cambian y debemos buscar a nuestra pareja siempre.",
                    concepts: [
                        "Complementariedad sobre simple diferencia",
                        "Formación de la sociedad más importante",
                        "Reconocimiento de la evolución mutua",
                        "Búsqueda y reencuentro constante",
                        "Prioridad de la pareja en la estructura familiar"
                    ],
                    exercise: {
                        title: "Fortalecimiento de la Sociedad Conyugal",
                        type: "Evaluación y mejora de la relación de pareja",
                        steps: [
                            "Evaluar nivel actual de complementariedad",
                            "Identificar cambios y evolución en ambos",
                            "Planificar tiempo a solas sin hijos",
                            "Crear nuevos proyectos y metas compartidas",
                            "Establecer rituales de reconexión regular"
                        ]
                    },
                    reflection: {
                        questions: [
                            "¿Nos estamos complementando o solo conviviendo?",
                            "¿Estoy buscando constantemente a mi pareja?",
                            "¿Reconozco y acepto cómo hemos cambiado ambos?",
                            "¿Priorizamos nuestra relación de pareja?"
                        ]
                    },
                    commitment: {
                        elements: [
                            "Plan específico para mejorar complementariedad",
                            "Tiempo semanal dedicado exclusivamente a la pareja",
                            "Proyecto conjunto que fortalezca la sociedad conyugal"
                        ]
                    }
                }
            },
            {
                id: 7,
                title: "El Rol de Amigo",
                description: "La amistad es uno de los mayores tesoros de la vida",
                status: "locked",
                video: {
                    duration: "Videos del módulo",
                    keyPoints: [
                        "Amistad como tesoro que se debe cultivar",
                        "Diferentes niveles de amistad (C, B, A, AAA)",
                        "Importancia de mantener relación constante",
                        "Elección cuidadosa con criterios similares a elegir pareja",
                        "Amigos como personas con visión similar de la vida"
                    ],
                    videos: [
                        { id: "7.1", vimeoId: "1133551871", title: "El Rol de Amigo Parte 1", status: "locked" },
                        { id: "7.2", vimeoId: "1133552360", title: "El Rol de Amigo Parte 2", status: "locked" }
                    ]
                },
                content: {
                    intro: "Como amigo debo recordar que la amistad, es uno de los mayores tesoros de la vida y se debe cultivar. Las personas cambian, si no mantenemos una relación constante con nuestros amigos, pronto dejaremos de ser afines.",
                    concepts: [
                        "Amistad como tesoro que requiere cultivo",
                        "Diferentes categorías de amistad (Circunstanciales, Cercanos, Amigos-Amigos, Hermanos)",
                        "Necesidad de relación constante para mantener afinidad",
                        "Selección cuidadosa basada en principios y valores",
                        "Búsqueda de perfil ganador en las amistades"
                    ],
                    exercise: {
                        title: "Mapa de Amistades y Plan de Cultivo",
                        type: "Clasificación y fortalecimiento de amistades",
                        steps: [
                            "Clasificar amigos actuales en categorías (C, B, A, AAA)",
                            "Evaluar tiempo dedicado a cada categoría",
                            "Identificar amistades que necesitan más atención",
                            "Crear plan de actividades para fortalecer vínculos",
                            "Establecer criterios para futuras amistades"
                        ]
                    },
                    reflection: {
                        questions: [
                            "¿Estoy cultivando adecuadamente mis amistades?",
                            "¿Mis amigos tienen visión y valores similares a los míos?",
                            "¿Dedico tiempo suficiente a mantener la afinidad?",
                            "¿Estoy siendo el tipo de amigo que me gustaría tener?"
                        ]
                    },
                    commitment: {
                        elements: [
                            "Plan específico para cultivar mis amistades más importantes",
                            "Tiempo regular dedicado a mantener y fortalecer vínculos",
                            "Criterios claros para seleccionar nuevas amistades"
                        ]
                    }
                }
            },
            {
                id: 8,
                title: "El Rol Profesional",
                description: "Encontrar propósito y realización en el trabajo",
                status: "locked",
                video: {
                    duration: "Videos del módulo",
                    keyPoints: [
                        "Trabajo que genere retos suficientes para mantener motivación",
                        "Desarrollo basado en carácter y competencia",
                        "Matriz del tiempo: enfoque en lo importante",
                        "\"Los hombres de carácter son infinitamente más raros que los de talento\"",
                        "Estabilidad económica como base de solidez personal y familiar"
                    ],
                    videos: [
                        { id: "8.1", vimeoId: "1133554327", title: "El Rol Profesional Parte 1", status: "locked" },
                        { id: "8.2", vimeoId: "1133552430", title: "El Rol Profesional Parte 2", status: "locked" }
                    ]
                },
                content: {
                    intro: "Como profesional, debo buscar el campo que me genere los suficientes retos para mantenerme motivado, con el cual sienta que puedo desarrollarme plenamente y dar lo mejor de mí. El trabajo debe generar los retos necesarios para mantenerme actualizado.",
                    concepts: [
                        "Trabajo como fuente de retos y motivación",
                        "Desarrollo sostenido en carácter y competencia",
                        "Orientación a metas específicas en tiempo determinado",
                        "Priorización de lo importante sobre lo urgente",
                        "Carácter como resultado de victorias sobre uno mismo"
                    ],
                    exercise: {
                        title: "Plan de Desarrollo Profesional Integral",
                        type: "Evaluación y mejora del desempeño profesional",
                        steps: [
                            "Evaluar nivel actual de satisfacción y retos en mi trabajo",
                            "Identificar áreas de desarrollo en carácter y competencia",
                            "Crear plan de metas profesionales con fechas específicas",
                            "Organizar tiempo según matriz de importancia/urgencia",
                            "Establecer plan de crecimiento y actualización continua"
                        ]
                    },
                    reflection: {
                        questions: [
                            "¿Qué tanto agrado siento por lo que hago?",
                            "¿Estoy contento y doy lo mejor de mí?",
                            "¿En dónde estoy y a dónde me gustaría llegar?",
                            "¿Mi trabajo me genera los retos necesarios para crecer?"
                        ]
                    },
                    commitment: {
                        elements: [
                            "Meta profesional específica con fecha concreta",
                            "Plan de desarrollo de carácter y competencia",
                            "Estrategia para enfocarme en lo importante sobre lo urgente"
                        ]
                    }
                }
            },
            {
                id: 9,
                title: "El Rol de Ciudadano y la Relación Conmigo Mismo",
                description: "Cumplir obligaciones para exigir derechos y cuidar el cuerpo como máquina única",
                status: "locked",
                video: {
                    duration: "Videos del módulo",
                    keyPoints: [
                        "Ciudadanía como oportunidad de trascendencia",
                        "Combate activo contra corrupción, impunidad e injusticia",
                        "Liderazgo empezando por uno mismo",
                        "Cuidado del cuerpo como máquina sin repuesto",
                        "Círculo de la vida para diagnóstico integral"
                    ],
                    videos: [
                        { id: "9.1", vimeoId: "1133551990", title: "La Relación Conmigo Mismo Parte 1", status: "locked" },
                        { id: "9.2", vimeoId: "1133552381", title: "La Relación Conmigo Mismo Parte 2", status: "locked" }   
                    ]
                },
                content: {
                    intro: "Como ciudadano debo cumplir con mis obligaciones para poder exigir respeto a mis derechos. Cuida tu cuerpo, no tienes otro de repuesto. La salud es la unidad que le agrega valor a todos tus activos personales.",
                    concepts: [
                        "Cumplimiento de obligaciones como base para exigir derechos",
                        "Combate activo contra corrupción e injusticia",
                        "Ayuda a comunidad y personas marginadas",
                        "Cuidado integral del cuerpo (emocional, mental, físico)",
                        "Moderación como palabra mágica para el equilibrio"
                    ],
                    exercise: {
                        title: "Círculo de Vida y Plan Ciudadano",
                        type: "Diagnóstico integral y plan de acción social",
                        steps: [
                            "Completar Círculo de la Vida (12 aspectos, 0-100 puntos)",
                            "Enumerar por orden de prioridad áreas a trabajar",
                            "Identificar obstáculos que he estado evitando",
                            "Crear 5 objetivos pequeños para salud integral",
                            "Planificar contribución específica a la comunidad"
                        ]
                    },
                    reflection: {
                        questions: [
                            "¿Cómo ayudo a la comunidad y al necesitado?",
                            "¿Cómo impulso actividades para que la comunidad crezca?",
                            "¿Cómo evito ser corrupto en mis acciones diarias?",
                            "¿Estoy cuidando adecuadamente mi cuerpo y salud integral?"
                        ]
                    },
                    commitment: {
                        elements: [
                            "Acción específica de contribución ciudadana",
                            "Plan de mejora en las 2 áreas más bajas del Círculo de Vida",
                            "Compromiso de moderación y cuidado integral de mi salud"
                        ]
                    }
                }
            },
            {
                id: 10,
                title: "Conclusiones - La Agenda como Herramienta de Transformación",
                description: "Integra todo tu aprendizaje en un plan de acción diario",
                status: "locked",
                video: {
                    duration: "Videos del módulo",
                    keyPoints: [
                        "Agenda como herramienta que une visión con acción diaria",
                        "Compromiso diario para ser lo que queremos llegar a ser",
                        "La mayor limitante somos nosotros mismos",
                        "\"Imposible\" no cabe en vocabulario de triunfador",
                        "Ejercicio del libre albedrío para planear, desarrollar y ejecutar visión"
                    ],
                    videos: [
                        { id: "10.1", vimeoId: "1133552129", title: "Conclusiones Parte 1", status: "locked" },
                        { id: "10.2", vimeoId: "1133552558", title: "Conclusiones Parte 2", status: "locked" }
                    ]
                },
                content: {
                    intro: "Solo a través de una agenda y un compromiso diario podremos ser lo que queremos llegar a ser. La visión que deben generar de sí mismos tiene que partir de la persona que quieren llegar a ser, trabajando día con día, mes con mes y año con año.",
                    concepts: [
                        "Agenda como herramienta de transformación diaria",
                        "Visión basada en quien queremos ser, no en quien somos",
                        "Trabajo constante y progresivo hacia metas",
                        "Superación de autolimitaciones mentales",
                        "Libre albedrío como don para planear y ejecutar destino"
                    ],
                    exercise: {
                        title: "Plan Maestro de Vida y Agenda de Transformación",
                        type: "Integración total y planificación de acción",
                        steps: [
                            "Integrar aprendizajes de todos los módulos",
                            "Crear visión integral consolidada",
                            "Establecer plan de acción diario en agenda",
                            "Definir métricas de seguimiento y evaluación",
                            "Crear sistema de revisión y ajuste continuo"
                        ]
                    },
                    reflection: {
                        questions: [
                            "¿He integrado todos los roles y aprendizajes en una visión coherente?",
                            "¿Tengo un plan de acción diario que me acerque a mi visión?",
                            "¿Estoy preparado para ser el arquitecto de mi destino?",
                            "¿Qué compromiso diario haré para mi transformación?"
                        ]
                    },
                    commitment: {
                        elements: [
                            "Mi visión integral final como arquitecto de mi destino",
                            "Plan de acción diario específico en mi agenda",
                            "Sistema de seguimiento y evaluación continua"
                        ]
                    }
                }
            }
        ];

        // Frases inspiradoras del programa actualizado
        const quotes = [
            "Cada uno llega al mundo con un libro en blanco, listo para ser llenado con la historia que deseemos escribir.",
            "El único lugar donde el éxito viene primero que el trabajo, es en el diccionario.",
            "Sólo aquellos que ven lo invisible pueden hacer lo imposible.",
            "No podemos elegir ciertas situaciones difíciles en la vida, pero sí podemos elegir nuestro comportamiento ante esa circunstancia.",
            "La cabeza de los demás es un lugar demasiado desdichado para que en él se asiente la auténtica felicidad.",
            "El tiempo es lo más perecedero que existe en la vida.",
            "Como tratamos a nuestros padres, así seremos tratados.",
            "El ejemplo es la mejor educación para los hijos.",
            "Los hombres de carácter son infinitamente más raros que los de talento.",
            "Solo a través de una agenda y un compromiso diario podremos ser lo que queremos llegar a ser."
        ];

        // Estado de la aplicación
        let currentUser = {
            name: '',
            email: '',
            motivation: '',
            startDate: new Date(),
            currentChapter: 1,
            completedChapters: [],

            exercises: 0,
            journal: [],
            vision: '',
            badges: []
        };

        // Helper para generar claves específicas por usuario
        function getUserKey(baseKey, email = null) {
            const userEmail = email || currentUser.email;
            if (!userEmail) return baseKey; // Fallback si no hay email
            return `${baseKey}_${userEmail}`;
        }

        // Sincronizar estados de capítulos con progreso real del usuario
        function syncChapterStates() {
            // PRIMERO: Recalcular currentChapter basándose en módulos realmente completados
            // currentChapter = siguiente módulo después del último completado
            if (currentUser.completedChapters && currentUser.completedChapters.length > 0) {
                const maxCompleted = Math.max(...currentUser.completedChapters);
                currentUser.currentChapter = Math.min(maxCompleted + 1, chapters.length);
            } else {
                currentUser.currentChapter = 1; // Si no hay completados, empezar en módulo 1
            }
            
            // Configurar estados basándose en el progreso real
            chapters.forEach(chapter => {
                if (currentUser.completedChapters.includes(chapter.id)) {
                    // Módulos completados: mantener como completados y accesibles para repasar
                    chapter.status = "completed";
                } else if (chapter.id <= currentUser.currentChapter) {
                    // Módulo actual o anteriores: disponibles para el usuario
                    chapter.status = "available";
                } else {
                    // Módulos futuros: bloqueados hasta completar los anteriores
                    chapter.status = "locked";
                }
            });
            
            // Guardar el currentChapter corregido
            localStorage.setItem(getUserKey('arquitectoUser'), JSON.stringify(currentUser));
        }

        // Actualizar próxima meta basándose en el progreso real
        function updateNextGoal() {
            const nextGoalTextEl = document.getElementById('nextGoalText');
            const nextGoalProgressEl = document.getElementById('nextGoalProgress');
            
            if (!nextGoalTextEl || !nextGoalProgressEl) return;

            // Encontrar el siguiente módulo a completar
            let nextChapter = null;
            let currentProgress = 0;

            // Si hay un módulo actual en progreso
            if (currentUser.currentChapter <= chapters.length) {
                nextChapter = chapters.find(c => c.id === currentUser.currentChapter);
                
                // Calcular progreso del módulo actual (basado en videos, ejercicios, etc.)
                if (nextChapter) {
                    // Progreso básico: si está disponible = 20%, si hay videos completados = más progreso
                    currentProgress = 20;
                    
                    // Agregar progreso por videos completados
                    if (nextChapter.video && nextChapter.video.videos) {
                        const completedVideos = nextChapter.video.videos.filter(v => v.status === 'completed').length;
                        const videoProgress = (completedVideos / nextChapter.video.videos.length) * 60; // 60% máximo por videos
                        currentProgress += videoProgress;
                    }
                    
                    // Verificar si tiene ejercicios, reflexiones, compromisos
                    const exercises = JSON.parse(localStorage.getItem(getUserKey('arquitectoExercises')) || '[]');
                    const reflections = JSON.parse(localStorage.getItem(getUserKey('arquitectoReflections')) || '[]');
                    const commitments = JSON.parse(localStorage.getItem(getUserKey('arquitectoCommitments')) || '[]');
                    
                    const hasExercise = exercises.some(e => e.chapterId === nextChapter.id);
                    const hasReflection = reflections.some(r => r.chapterId === nextChapter.id);
                    const hasCommitment = commitments.some(c => c.chapterId === nextChapter.id);
                    
                    if (hasExercise) currentProgress += 5;
                    if (hasReflection) currentProgress += 5;
                    if (hasCommitment) currentProgress += 10;
                    
                    currentProgress = Math.min(currentProgress, 95); // Máximo 95% hasta completar
                }
            }

            // Si no hay siguiente capítulo, el usuario completó todo
            if (!nextChapter || currentUser.currentChapter > chapters.length) {
                nextGoalTextEl.textContent = '¡Felicidades! Has completado todos los módulos';
                nextGoalProgressEl.style.width = '100%';
                return;
            }

            // Actualizar texto y progreso
            nextGoalTextEl.textContent = `Completar el Módulo ${nextChapter.id}: ${nextChapter.title}`;
            nextGoalProgressEl.style.width = `${currentProgress}%`;
        }

        // Funciones de navegación
        function showRegister() {
            const registerForm = document.getElementById('registerForm');
            const loginForm = document.getElementById('loginForm');
            const welcomeContent = document.getElementById('welcomeContent');
            
            welcomeContent.style.display = 'none';
            welcomeContent.classList.add('hidden');
            
            loginForm.style.display = 'none';
            loginForm.classList.add('hidden');
            
            registerForm.style.display = 'flex';
            registerForm.classList.remove('hidden');
            
            // Scroll to top
            const panel = document.querySelector('.white-panel');
            if (panel) panel.scrollTop = 0;
        }

        function showLogin() {
            const registerForm = document.getElementById('registerForm');
            const loginForm = document.getElementById('loginForm');
            const welcomeContent = document.getElementById('welcomeContent');
            
            welcomeContent.style.display = 'none';
            welcomeContent.classList.add('hidden');
            
            registerForm.style.display = 'none';
            registerForm.classList.add('hidden');
            
            loginForm.style.display = 'flex';
            loginForm.classList.remove('hidden');
            
            // Scroll to top
            const panel = document.querySelector('.white-panel');
            if (panel) panel.scrollTop = 0;
        }

        function backToWelcome() {
            const registerForm = document.getElementById('registerForm');
            const loginForm = document.getElementById('loginForm');
            const welcomeContent = document.getElementById('welcomeContent');
            
            registerForm.style.display = 'none';
            registerForm.classList.add('hidden');
            
            loginForm.style.display = 'none';
            loginForm.classList.add('hidden');
            
            welcomeContent.style.display = 'flex';
            welcomeContent.classList.remove('hidden');
            
            // Scroll to top
            const panel = document.querySelector('.white-panel');
            if (panel) panel.scrollTop = 0;
        }

        function completeRegistration() {
            const name = document.getElementById('userName').value;
            const email = document.getElementById('userEmail').value;
            const password = document.getElementById('userPassword').value;
            const motivationElement = document.querySelector('input[name="motivation"]:checked');
            
            if (!name || !email || !password) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Campos incompletos',
                    text: 'Por favor completa todos los campos',
                    confirmButtonColor: '#4a9fc7'
                });
                return;
            }

            if (!motivationElement) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Selecciona una motivación',
                    text: 'Por favor selecciona tu motivación principal',
                    confirmButtonColor: '#4a9fc7'
                });
                return;
            }

            // Crear usuario completamente nuevo (sin heredar valores hardcodeados)
            currentUser = {
                name: name,
                email: email,
                motivation: motivationElement.value,
                startDate: new Date(),
                currentChapter: 1,
                completedChapters: [],
    
                exercises: 0,
                journal: [],
                vision: '',
                badges: ['Iniciador']
            };

            // Guardar en localStorage con clave específica del usuario
            localStorage.setItem(getUserKey('arquitectoUser'), JSON.stringify(currentUser));
            
            // Guardar como último usuario activo
            localStorage.setItem('lastActiveUser', email);

            // Mostrar mensaje de bienvenida
            Swal.fire({
                icon: 'success',
                title: `¡Bienvenido ${name.split(' ')[0]}!`,
                text: 'Tu viaje de transformación comienza ahora',
                confirmButtonText: 'Comenzar',
                confirmButtonColor: '#4a9fc7'
            }).then(() => {
                updateUserInterface();
                // Inicializar estado de videos para usuario nuevo
                loadVideoState();
                // RESETEAR ESTADOS VISUALES PARA USUARIO NUEVO
                resetStatesForNewUser();
                showDashboard();
            });
        }

        function processLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Campos incompletos',
                    text: 'Por favor ingresa tu email y contraseña',
                    confirmButtonColor: '#4a9fc7'
                });
                return;
            }

            // Simulación de login (aquí podrías validar credenciales)
            if (email && password) {
                // Buscar datos específicos del usuario por email
                const userKey = getUserKey('arquitectoUser', email);
                const savedUserData = localStorage.getItem(userKey);
                
                if (savedUserData) {
                    // Cargar datos existentes del usuario específico
                    currentUser = JSON.parse(savedUserData);
                } else {
                    // Crear perfil completamente nuevo para este usuario
                    currentUser = {
                        name: email.split('@')[0], // Extraer nombre del email
                        email: email,
                        motivation: '',
                        startDate: new Date(),
                        currentChapter: 1,
                        completedChapters: [],
            
                        exercises: 0,
                        journal: [],
                        vision: '',
                        badges: ['Iniciador']
                    };
                }

                // Guardar datos específicos del usuario
                localStorage.setItem(getUserKey('arquitectoUser'), JSON.stringify(currentUser));
                
                // Guardar como último usuario activo
                localStorage.setItem('lastActiveUser', email);

                Swal.fire({
                    icon: 'success',
                    title: '¡Bienvenido!',
                    text: 'Continuemos con tu transformación',
                    confirmButtonText: 'Continuar',
                    confirmButtonColor: '#4a9fc7'
                }).then(() => {
                    updateUserInterface();
                    // Cargar estado de videos del usuario
                    loadVideoState();
                    // RESETEAR ESTADOS VISUALES DESPUÉS DEL LOGIN
                    resetStatesForNewUser();
                    showDashboard();
                });
            }
        }

        function showDashboard() {
            // Limpiar flag de logout al entrar al dashboard
            localStorage.removeItem('arquitectoLoggedOut');
            
            // Recuperar la última sección activa o usar 'inicio' por defecto
            const lastSection = localStorage.getItem(getUserKey('currentSection')) || 'inicio';
            
            // Mostrar la última sección en la que estaba el usuario
            showSection(lastSection);
            
            // Sincronizar todos los datos antes de mostrar
            syncUserProgress();
            
            // Sincronizar estados de capítulos con progreso real
            syncChapterStates();
            
            // Actualizar próxima meta
            updateNextGoal();
            
            // Actualizar información del usuario
            const firstName = currentUser.name.split(' ')[0] || 'Usuario';
            document.getElementById('userGreeting').textContent = `¡Bienvenido, ${firstName}!`;
            document.getElementById('userAvatar').textContent = firstName.charAt(0).toUpperCase();
            
            // Renderizar capítulos
            renderChapters();
            
            // Actualizar frase del día
            updateDailyQuote();
        }

        function renderChapters() {
            const grid = document.getElementById('chaptersGrid');
            grid.innerHTML = '';
            
            chapters.forEach((chapter, index) => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-xl shadow-md p-6 hover-lift cursor-pointer transition-all';
                card.onclick = () => openChapter(chapter.id);
                
                let statusIcon = '';
                let statusColor = '';
                let borderColor = '';
                
                if (chapter.status === 'completed') {
                    statusIcon = '<i class="fas fa-check-circle text-green-500"></i>';
                    statusColor = 'text-green-500';
                    borderColor = 'border-green-500';
                } else if (chapter.status === 'in-progress' || chapter.status === 'available') {
                    statusIcon = '<i class="fas fa-play-circle text-arquitecto-blue"></i>';
                    statusColor = 'text-arquitecto-blue';
                    borderColor = 'border-arquitecto-blue';
                } else {
                    statusIcon = '<i class="fas fa-lock text-gray-400"></i>';
                    statusColor = 'text-gray-400';
                    borderColor = 'border-gray-300';
                }
                
                card.innerHTML = `
                    <div class="flex items-start justify-between mb-4">
                        <div class="w-12 h-12 bg-arquitecto-navy rounded-xl flex items-center justify-center text-white font-bold text-lg">
                            ${chapter.id}
                        </div>
                        ${statusIcon}
                    </div>
                    <h3 class="text-lg font-semibold text-arquitecto-navy mb-2">${chapter.title}</h3>
                    <p class="text-gray-600 text-sm">${chapter.description}</p>
                    <div class="mt-4 w-full bg-gray-200 rounded-full h-2 overflow-hidden">
                        <div class="h-full ${chapter.status === 'completed' ? 'bg-green-500' : (chapter.status === 'in-progress' || chapter.status === 'available') ? 'bg-arquitecto-blue' : 'bg-gray-300'} rounded-full transition-all duration-500" style="width: ${chapter.status === 'completed' ? '100%' : (chapter.status === 'in-progress' || chapter.status === 'available') ? '20%' : '0%'};"></div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        function openChapter(chapterId) {
            const chapter = chapters.find(c => c.id === chapterId);
            
            if (chapter.status === 'locked') {
                Swal.fire({
                    icon: 'info',
                    title: 'Módulo bloqueado',
                    text: 'Completa los módulos anteriores para desbloquear este contenido',
                    confirmButtonColor: '#4a9fc7'
                });
                return;
            }
            
            // Asegurar que el primer video del módulo esté disponible
            if (chapter.video && chapter.video.videos && chapter.video.videos.length > 0) {
                if (chapter.video.videos[0].status === 'locked') {
                    chapter.video.videos[0].status = 'available';
                    saveVideoState();
                    console.log(`✅ Primer video del módulo ${chapterId} ahora disponible`);
                }
            }
            
            const detail = document.getElementById('chapterDetail');
            detail.innerHTML = `
                <div class="border-b border-gray-200 pb-6 mb-6">
                    <h2 class="text-2xl font-bold text-arquitecto-navy">Módulo ${chapter.id}: ${chapter.title}</h2>
                    <p class="text-gray-600 mt-2">${chapter.description}</p>
                </div>
                
                <div class="flex space-x-2 mb-6 border-b border-gray-200">
                    <button class="tab-btn px-4 py-2 font-semibold text-arquitecto-navy border-b-2 border-arquitecto-navy" onclick="showTab('video', ${chapter.id})">
                        <i class="fas fa-video mr-2"></i>Video
                    </button>
                    <button class="tab-btn px-4 py-2 font-semibold text-gray-600 hover:text-arquitecto-navy" onclick="showTab('reading', ${chapter.id})">
                        <i class="fas fa-book-open mr-2"></i>Lectura
                    </button>
                    <button class="tab-btn px-4 py-2 font-semibold text-gray-600 hover:text-arquitecto-navy" onclick="showTab('reflection', ${chapter.id})">
                        <i class="fas fa-brain mr-2"></i>Reflexión
                    </button>
                    <button class="tab-btn px-4 py-2 font-semibold text-gray-600 hover:text-arquitecto-navy" onclick="showTab('exercise', ${chapter.id})">
                        <i class="fas fa-dumbbell mr-2"></i>Ejercicio
                    </button>
                    <button class="tab-btn px-4 py-2 font-semibold text-gray-600 hover:text-arquitecto-navy" onclick="showTab('commitment', ${chapter.id})">
                        <i class="fas fa-handshake mr-2"></i>Compromiso
                    </button>
                </div>
                
                <div id="tabContent">
                    ${generateVideoContent(chapter)}
                </div>
            `;
            
            detail.classList.remove('hidden');
            detail.scrollIntoView({ behavior: 'smooth' });
        }

        function showTab(tabName, chapterId) {
            const chapter = chapters.find(c => c.id === chapterId);
            const tabs = document.querySelectorAll('.tab-btn');
            tabs.forEach(tab => {
                tab.classList.remove('text-arquitecto-navy', 'border-b-2', 'border-arquitecto-navy');
                tab.classList.add('text-gray-600');
            });
            
            // Buscar y activar la pestaña correcta por el tipo de tab
            const activeTab = document.querySelector(`.tab-btn[onclick*="showTab('${tabName}', ${chapterId})"]`);
            if (activeTab) {
                activeTab.classList.remove('text-gray-600');
                activeTab.classList.add('text-arquitecto-navy', 'border-b-2', 'border-arquitecto-navy');
            }
            
            let content = '';
            switch(tabName) {
                case 'video':
                    content = generateVideoContent(chapter);
                    document.getElementById('tabContent').innerHTML = content;
                    // Inicializar Vimeo Player después de renderizar
                    setTimeout(() => {
                        const currentIndex = getCurrentVideoIndex(chapter.id);
                        const currentVideo = chapter.video.videos[currentIndex];
                        if (currentVideo) {
                            initializeVimeoPlayer(chapter.id, currentVideo);
                        }
                    }, 100);
                    return; // Salir temprano ya que ya actualizamos el contenido
                case 'reading':
                    content = generateReadingContent(chapter);
                    break;
                case 'exercise':
                    content = generateExerciseContent(chapter);
                    break;
                case 'reflection':
                    content = generateReflectionContent(chapter);
                    break;
                case 'commitment':
                    content = generateCommitmentContent(chapter);
                    break;
            }
            
            document.getElementById('tabContent').innerHTML = content;
        }

        function generateVideoContent(chapter) {
            const currentVideo = getCurrentVideo(chapter.id);
            const currentVideoIndex = getCurrentVideoIndex(chapter.id);
            
            return `
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Lista de Videos -->
                    <div class="lg:col-span-1">
                        <h3 class="text-lg font-semibold text-arquitecto-navy mb-4">
                            <i class="fas fa-list mr-2"></i>Videos del Módulo
                        </h3>
                        <div class="space-y-2">
                            ${chapter.video.videos.map((video, index) => `
                                <div class="video-item ${index === currentVideoIndex ? 'bg-arquitecto-blue/10 border-arquitecto-blue' : 'bg-white hover:bg-gray-50'} 
                                     border rounded-lg p-3 transition-all
                                     ${video.status === 'locked' ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer hover:shadow-md'}" 
                                     onclick="${video.status !== 'locked' ? `selectVideo(${chapter.id}, ${index})` : 'console.log(\"Video bloqueado: ${video.title}\")'}"
                                     title="${video.status === 'locked' ? 'Completa el video anterior para desbloquear' : 'Clic para reproducir'}">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <div class="w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm font-semibold
                                                 ${video.status === 'completed' ? 'bg-green-500 text-white' : 
                                                   video.status === 'in-progress' ? 'bg-arquitecto-navy text-white' :
                                                   video.status === 'available' ? 'bg-arquitecto-blue text-white' : 'bg-gray-300 text-gray-600'}">
                                                ${video.status === 'completed' ? '✓' : 
                                                  video.status === 'locked' ? '🔒' : index + 1}
                                            </div>
                                            <div>
                                                <div class="font-medium text-sm">${video.title}</div>
                                                <div class="text-xs text-gray-500">Video ${video.id}</div>
                                            </div>
                                        </div>
                                        <div class="text-xs">
                                            ${video.status === 'completed' ? '<i class="fas fa-check-circle text-green-500"></i>' :
                                              video.status === 'in-progress' ? '<i class="fas fa-play-circle text-arquitecto-navy"></i>' :
                                              video.status === 'available' ? '<i class="fas fa-play text-arquitecto-blue"></i>' :
                                              '<i class="fas fa-lock text-gray-400"></i>'}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- Progreso del Módulo -->
                        <div class="mt-6 p-4 bg-arquitecto-gray rounded-lg">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm font-medium text-arquitecto-navy">Progreso del Módulo</span>
                                <span class="text-sm text-gray-600" id="moduleProgress-${chapter.id}">${getModuleVideoProgress(chapter)}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-arquitecto-navy rounded-full h-2 transition-all duration-500" 
                                     style="width: ${getModuleVideoProgress(chapter)}%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Reproductor Principal -->
                    <div class="lg:col-span-2">
                        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                            <div class="bg-gradient-to-r from-arquitecto-navy to-arquitecto-navy-dark text-white p-4">
                                <h3 class="text-xl font-bold">${currentVideo ? currentVideo.title : 'Selecciona un video'}</h3>
                                <p class="text-sm opacity-90">Módulo ${chapter.id}: ${chapter.title}</p>
                            </div>
                            
                            <div class="relative bg-black" style="aspect-ratio: 16/9;">
                                ${currentVideo ? `
                                    <div id="vimeoPlayerContainer-${chapter.id}" style="width: 100%; height: 100%;"></div>
                                    
                                    <!-- Overlay para video no disponible -->
                                    <div id="videoError-${chapter.id}" class="hidden absolute inset-0 bg-gray-900 flex items-center justify-center">
                                        <div class="text-center text-white">
                                            <i class="fas fa-video-slash text-6xl mb-4 opacity-50"></i>
                                            <h3 class="text-xl font-semibold mb-2">Video no disponible</h3>
                                            <p class="text-gray-300">${currentVideo.title}</p>
                                            <p class="text-sm text-gray-400 mt-2">Error al cargar el video de Vimeo</p>
                                        </div>
                                    </div>
                                ` : `
                                    <div class="absolute inset-0 bg-gray-800 flex items-center justify-center">
                                        <div class="text-center text-white">
                                            <i class="fas fa-play-circle text-6xl mb-4 opacity-50"></i>
                                            <h3 class="text-xl font-semibold mb-2">Selecciona un video</h3>
                                            <p class="text-gray-300">Elige un video de la lista para comenzar</p>
                                        </div>
                                    </div>
                                `}
                            </div>
                            
                            <!-- Controles de Navegación -->
                            <div class="p-4 border-t border-gray-200">
                                <div class="flex items-center justify-between">
                                    <button onclick="navigateVideo(${chapter.id}, 'prev')" 
                                            class="flex items-center px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors
                                                   ${currentVideoIndex === 0 ? 'opacity-50 cursor-not-allowed' : ''}"
                                            ${currentVideoIndex === 0 ? 'disabled' : ''}>
                                        <i class="fas fa-chevron-left mr-2"></i>
                                        Anterior
                                    </button>
                                    
                                    <div class="flex items-center space-x-4">
                                        <button onclick="toggleFullscreen(${chapter.id})" 
                                                class="flex items-center px-4 py-2 bg-arquitecto-navy text-white hover:bg-arquitecto-navy-dark rounded-lg transition-colors">
                                            <i class="fas fa-expand mr-2"></i>
                                            Pantalla Completa
                                        </button>
                                    </div>
                                    
                                    <button onclick="navigateVideo(${chapter.id}, 'next')" 
                                            class="flex items-center px-4 py-2 rounded-lg transition-colors
                                                   ${(currentVideoIndex >= chapter.video.videos.length - 1 || 
                                                     (chapter.video.videos[currentVideoIndex + 1] && chapter.video.videos[currentVideoIndex + 1].status === 'locked')) ? 
                                                     'bg-gray-200 text-gray-500 opacity-50 cursor-not-allowed' : 
                                                     'bg-arquitecto-navy text-white hover:bg-arquitecto-navy-dark'}"
                                            ${(currentVideoIndex >= chapter.video.videos.length - 1 || 
                                              (chapter.video.videos[currentVideoIndex + 1] && chapter.video.videos[currentVideoIndex + 1].status === 'locked')) ? 'disabled' : ''}
                                            title="${chapter.video.videos[currentVideoIndex + 1]?.status === 'locked' ? 'Completa el video actual para continuar' : 'Ir al siguiente video'}"
                                        Siguiente
                                        <i class="fas fa-chevron-right ml-2"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Puntos Clave del Video Actual -->
                        ${currentVideo ? `
                            <div class="mt-6 bg-arquitecto-gray rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-arquitecto-navy mb-4">
                                    <i class="fas fa-lightbulb mr-2"></i>Puntos clave del módulo:
                                </h4>
                                <ul class="space-y-2">
                                    ${chapter.video.keyPoints.map(point => `
                                        <li class="flex items-start">
                                            <i class="fas fa-check-circle text-arquitecto-navy mt-1 mr-3 flex-shrink-0"></i>
                                            <span class="text-gray-700">${point}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function generateReadingContent(chapter) {
            return `
                <div>
                    <div class="prose max-w-none">
                        <p class="text-lg text-gray-700 leading-relaxed mb-6">
                            ${chapter.content.intro}
                        </p>
                        
                        <h3 class="text-xl font-semibold text-arquitecto-navy mb-4">Conceptos Fundamentales</h3>
                        <div class="space-y-3">
                            ${chapter.content.concepts.map(concept => `
                                <div class="p-4 bg-arquitecto-gray border-l-4 border-arquitecto-navy rounded">
                                    <i class="fas fa-lightbulb text-arquitecto-navy mr-2"></i>
                                    <span class="text-gray-700">${concept}</span>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="mt-8 p-6 bg-arquitecto-gray rounded-lg border-l-4 border-arquitecto-navy">
                            <h4 class="text-arquitecto-navy font-semibold mb-3">
                                <i class="fas fa-quote-left"></i> Reflexión del Capítulo
                            </h4>
                            <p class="text-gray-700 italic">
                                ${getChapterQuote(chapter.id)}
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateExerciseContent(chapter) {
            if (!chapter.content.exercise) {
                return '<p class="text-gray-600">Ejercicio no disponible para este módulo.</p>';
            }
            
            return `
                <div>
                    <div class="bg-arquitecto-gray rounded-lg p-6">
                        <h3 class="text-xl font-semibold text-arquitecto-navy mb-4">${chapter.content.exercise.title}</h3>
                        <div class="mb-4 p-4 bg-white rounded-lg border-l-4 border-arquitecto-blue">
                            <h4 class="font-semibold text-arquitecto-navy mb-2">Tipo de ejercicio:</h4>
                            <p class="text-gray-600">${chapter.content.exercise.type}</p>
                        </div>
                        <p class="text-gray-600 mb-6">
                            Este ejercicio te ayudará a aplicar los conceptos del módulo en tu vida diaria.
                        </p>
                        
                        <div class="space-y-4">
                            ${chapter.content.exercise.steps.map((step, index) => `
                                <div class="bg-white p-4 rounded-lg border-l-4 border-arquitecto-navy">
                                    <div class="flex items-start">
                                        <span class="w-8 h-8 bg-arquitecto-navy text-white rounded-full flex items-center justify-center font-semibold mr-3 flex-shrink-0">
                                            ${index + 1}
                                        </span>
                                        <div class="flex-1">
                                            <p class="text-gray-700 mb-3">${step}</p>
                                            <textarea class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-arquitecto-navy focus:outline-none transition-colors" rows="3" placeholder="Escribe tu respuesta aquí..."></textarea>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <button onclick="saveExercise(${chapter.id})" class="mt-6 px-6 py-3 bg-arquitecto-navy text-white font-semibold rounded-lg hover:bg-arquitecto-navy-dark transition-colors">
                            <i class="fas fa-save mr-2"></i> Guardar Ejercicio
                        </button>
                    </div>
                </div>
            `;
        }

        function generateReflectionContent(chapter) {
            return `
                <div>
                    <div class="max-w-2xl mx-auto">
                        <h3 class="text-xl font-semibold text-arquitecto-navy mb-4">Momento de Reflexión</h3>
                        <p class="text-gray-600 mb-6">
                            Tómate unos minutos para reflexionar sobre lo aprendido en este módulo.
                        </p>
                        
                        <div class="bg-arquitecto-gray rounded-lg p-6 mb-6">
                            <h4 class="font-semibold text-arquitecto-navy mb-3">Preguntas guía específicas del módulo:</h4>
                            <ul class="space-y-2 text-gray-700">
                                ${chapter.content.reflection.questions.map(question => `
                                    <li class="flex items-start">
                                        <i class="fas fa-question-circle text-arquitecto-navy mt-1 mr-3 flex-shrink-0"></i>
                                        <span>${question}</span>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                        
                        <div class="bg-arquitecto-gray rounded-lg p-6 mb-6">
                            <h4 class="font-semibold text-arquitecto-navy mb-3">Preguntas generales de reflexión:</h4>
                            <ul class="space-y-2 text-gray-700">
                                <li>• ¿Qué aprendizaje principal obtuve de este módulo?</li>
                                <li>• ¿Cómo puedo aplicar esto en mi vida diaria?</li>
                                <li>• ¿Qué cambio específico voy a implementar?</li>
                                <li>• ¿Qué obstáculos podría encontrar y cómo los superaré?</li>
                            </ul>
                        </div>
                        
                        <textarea class="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-arquitecto-navy focus:outline-none transition-colors" rows="8" placeholder="Escribe aquí tu reflexión personal..."></textarea>
                        
                        <button onclick="saveReflection(${chapter.id})" class="mt-4 px-6 py-3 bg-arquitecto-navy text-white font-semibold rounded-lg hover:bg-arquitecto-navy-dark transition-colors">
                            <i class="fas fa-save mr-2"></i> Guardar Reflexión
                        </button>
                    </div>
                </div>
            `;
        }

        function generateCommitmentContent(chapter) {
            return `
                <div>
                    <div class="max-w-2xl mx-auto text-center">
                        <i class="fas fa-handshake text-6xl text-arquitecto-navy mb-4"></i>
                        <h3 class="text-xl font-semibold text-arquitecto-navy mb-4">Mi Compromiso de Acción</h3>
                        <p class="text-gray-600 mb-6">
                            Basado en lo aprendido en este módulo, me comprometo a:
                        </p>
                        
                        <div class="text-left space-y-6">
                            <div class="bg-arquitecto-gray rounded-lg p-4 mb-6">
                                <h4 class="font-semibold text-arquitecto-navy mb-3">Elementos específicos de compromiso para este módulo:</h4>
                                <ul class="space-y-2 text-gray-700">
                                    ${chapter.content.commitment.elements.map(element => `
                                        <li class="flex items-start">
                                            <i class="fas fa-star text-arquitecto-navy mt-1 mr-3 flex-shrink-0"></i>
                                            <span>${element}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                            
                            ${chapter.content.commitment.elements.map((element, index) => `
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">${element}:</label>
                                    <textarea class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-arquitecto-navy focus:outline-none transition-colors" rows="3" placeholder="Describe específicamente tu compromiso..."></textarea>
                                </div>
                            `).join('')}
                            
                            <div class="border-t pt-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Cuándo lo haré (fecha y frecuencia específica):</label>
                                    <input type="text" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-arquitecto-navy focus:outline-none transition-colors" placeholder="Ej: Todas las mañanas a las 6:00 AM, comenzando el lunes">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Cómo mediré mi progreso (indicadores de seguimiento):</label>
                                <input type="text" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-arquitecto-navy focus:outline-none transition-colors" placeholder="Ej: Marcaré en mi calendario cada día completado">
                            </div>
                        </div>
                        
                        <div class="mt-6 flex flex-col sm:flex-row gap-4 justify-center">
                            <button onclick="saveCommitment(${chapter.id})" class="px-8 py-3 bg-arquitecto-navy text-white font-semibold rounded-lg hover:bg-arquitecto-navy-dark transition-colors">
                                <i class="fas fa-check mr-2"></i> Confirmar Compromiso
                            </button>
                            <button onclick="calendarizeCommitment(${chapter.id})" class="px-8 py-3 bg-arquitecto-blue text-white font-semibold rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                                <i class="fas fa-calendar-plus mr-2"></i> Calendarizar Compromiso
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function getChapterQuote(chapterId) {
            const chapterQuotes = {
                1: "El emprendedor se crece con la emoción, tensión y riesgo de cada reto.",
                2: "Sólo aquellos que ven lo invisible pueden hacer lo imposible.",
                3: "En Dios encontraré el apoyo para transformar mis defectos en virtudes.",
                4: "El tiempo es lo más perecedero que existe en la vida.",
                5: "El ejemplo es la mejor educación para los hijos.",
                6: "La pareja es la sociedad más importante de tu vida.",
                7: "La amistad es uno de los mayores tesoros de la vida.",
                8: "El trabajo debe generar los suficientes retos para mantenerte motivado.",
                9: "Como ciudadano, debo cumplir con mis obligaciones para poder exigir respeto a mis derechos.",
                10: "Eres el arquitecto de tu destino. Eres lo que haces de ti mismo."
            };
            return chapterQuotes[chapterId] || quotes[0];
        }

        // Funciones de Modal
        function openModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = content;
            const modal = document.getElementById('modal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            
            // Destruir player de video introductorio si existe
            if (window.introVimeoPlayer) {
                try {
                    window.introVimeoPlayer.destroy();
                    window.introVimeoPlayer = null;
                    console.log('🗑️ Player de video introductorio destruido');
                } catch (e) {
                    console.log('⚠️ Error al destruir player introductorio:', e);
                }
            }
            
            // Pausar y destruir todos los players de Vimeo de los módulos
            if (window.vimeoPlayers) {
                Object.keys(window.vimeoPlayers).forEach(moduleId => {
                    try {
                        if (window.vimeoPlayers[moduleId]) {
                            window.vimeoPlayers[moduleId].pause();
                            window.vimeoPlayers[moduleId].destroy();
                            console.log(`🗑️ Player Vimeo del módulo ${moduleId} destruido`);
                        }
                    } catch (e) {
                        console.log(`⚠️ Error al destruir player del módulo ${moduleId}:`, e);
                    }
                });
                window.vimeoPlayers = {};
            }
            
            // Detener síntesis de voz si está reproduciéndose
            if (window.speechSynthesis && (window.speechSynthesis.speaking || window.speechSynthesis.paused)) {
                window.speechSynthesis.cancel();
            }
            
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        // Funciones de Accesos Rápidos
        function showIntroVideo() {
            openModal('Video Introductorio - Arquitecto de tu Destino', `
                <div class="text-center">
                    <div class="relative bg-black rounded-lg overflow-hidden mb-6" style="aspect-ratio: 16/9;">
                        <div id="introVimeoPlayerContainer" style="width: 100%; height: 100%;"></div>
                        
                        <!-- Overlay para video no disponible -->
                        <div id="introVideoError" class="hidden absolute inset-0 bg-gray-900 flex items-center justify-center">
                            <div class="text-center text-white">
                                <i class="fas fa-video-slash text-6xl mb-4 opacity-50"></i>
                                <h3 class="text-xl font-semibold mb-2">Video no disponible</h3>
                                <p class="text-gray-300">Video Introductorio del Programa</p>
                                <p class="text-sm text-gray-400 mt-2">Error al cargar el video de Vimeo</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-left bg-arquitecto-gray rounded-lg p-4">
                        <h4 class="text-arquitecto-navy font-semibold mb-3">
                            <i class="fas fa-info-circle mr-2"></i>Sobre este video:
                        </h4>
                        <ul class="space-y-2 text-gray-700 text-sm">
                            <li class="flex items-start">
                                <i class="fas fa-check-circle text-arquitecto-blue mt-1 mr-2 flex-shrink-0"></i>
                                <span>Conoce la filosofía completa del programa</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-check-circle text-arquitecto-blue mt-1 mr-2 flex-shrink-0"></i>
                                <span>Entiende los 10 módulos de transformación</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-check-circle text-arquitecto-blue mt-1 mr-2 flex-shrink-0"></i>
                                <span>Aprende a navegar por el portal</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-check-circle text-arquitecto-blue mt-1 mr-2 flex-shrink-0"></i>
                                <span>Prepárate para tu viaje de transformación</span>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="mt-6 flex flex-col sm:flex-row gap-3">
                        <button onclick="toggleIntroVideoFullscreen()" 
                                class="flex-1 px-4 py-2 bg-arquitecto-navy text-white font-semibold rounded-lg hover:bg-arquitecto-navy-dark transition-colors">
                            <i class="fas fa-expand mr-2"></i>Pantalla Completa
                        </button>
                        <button onclick="closeModal()" 
                                class="flex-1 px-4 py-2 border-2 border-gray-300 text-gray-700 font-semibold rounded-lg hover:bg-gray-50 transition-colors">
                            <i class="fas fa-times mr-2"></i>Cerrar
                        </button>
                    </div>
                </div>
            `);
            
            // Inicializar Vimeo Player después de abrir el modal
            setTimeout(() => {
                initializeIntroVimeoPlayer();
            }, 100);
        }
        
        // Inicializar reproductor de Vimeo para video introductorio
        function initializeIntroVimeoPlayer() {
            const container = document.getElementById('introVimeoPlayerContainer');
            if (!container) {
                console.log('⚠️ Contenedor de video introductorio no encontrado');
                return;
            }
            
            try {
                console.log('🎬 Inicializando Vimeo Player para video introductorio');
                
                const player = new Vimeo.Player(container, {
                    id: '1133551325', // ID del video 00.Introduccion
                    width: '100%',
                    responsive: true
                });
                
                // Guardar referencia
                window.introVimeoPlayer = player;
                
                // Escuchar cuando carga
                player.on('loaded', function() {
                    console.log('✅ Video introductorio cargado correctamente');
                    onIntroVideoLoaded();
                });
                
                // Manejar errores
                player.on('error', function(error) {
                    console.error('❌ Error en video introductorio:', error);
                    onIntroVideoError();
                });
                
            } catch (error) {
                console.error('❌ Error al crear player de video introductorio:', error);
                onIntroVideoError();
            }
        }
        
        function showVision() {
            // Cargar datos guardados desde localStorage
            const savedVision = JSON.parse(localStorage.getItem(getUserKey('arquitectoVision')) || '{}');
            
            const areas = ['Personal/Carácter', 'Salud/Bienestar', 'Relaciones/Familia', 
                          'Profesional/Propósito', 'Financiero/Recursos', 'Espiritual/Trascendencia'];
            const keys = ['personal', 'salud', 'relaciones', 'profesional', 'financiero', 'espiritual'];
            
            openModal('Mi Visión Personal', `
                <div class="space-y-6">
                    <div class="text-gray-600">
                        <p class="font-bold text-gray-800 mb-3">Introducción previa para mi visión personal:</p>
                        <p>Considerando el análisis realizado anteriormente en el módulo II, define tu visión para los próximos cinco años. Considera cómo te vez en cada área de tu vida.</p>
                    </div>
                    
                    <div class="grid gap-4">
                        ${areas.map((area, index) => `
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">${area}</label>
                                <textarea class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-arquitecto-navy focus:outline-none transition-colors" rows="3" placeholder="Mi visión en ${area}...">${savedVision[keys[index]] || ''}</textarea>
                            </div>
                        `).join('')}
                    </div>
                    
                    <button onclick="saveVision()" class="w-full py-3 bg-arquitecto-navy text-white font-semibold rounded-lg hover:bg-arquitecto-navy-dark transition-colors">
                        <i class="fas fa-save mr-2"></i> Guardar Mi Visión
                    </button>
                </div>
            `);
        }





       function showLifeWheel() {
           // Cargar datos guardados
           const savedData = JSON.parse(localStorage.getItem(getUserKey('ruedaMotivacional')) || '{}');
           
           openModal('Rueda Motivacional', `
               <div class="max-w-4xl mx-auto">
                   <div class="mb-6">
                       <p class="font-bold text-gray-800 mb-3">Instrucciones previas en la rueda motivacional:</p>
                       <p class="text-gray-600">Evalúa cada área de tu vida respondiendo honestamente las preguntas. Califica cada respuesta del 1 al 10, donde 1 es muy bajo y 10 es excelente.</p>
                   </div>
                   
                   <!-- Carrusel de secciones -->
                   <div id="carouselContainer" class="mb-6">
                       <div id="sectionContent" class="min-h-96 bg-gray-50 rounded-lg p-6">
                           <!-- El contenido de cada sección se cargará aquí -->
                               </div>
                       
                       <!-- Navegación del carrusel -->
                       <div class="flex justify-between items-center mt-4">
                           <button id="prevBtn" onclick="navigateCarousel(-1)" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors" disabled>
                               <i class="fas fa-chevron-left mr-2"></i>Anterior
                           </button>
                           <div class="flex space-x-2">
                               ${Array.from({length: 7}, (_, i) => `
                                   <div class="w-3 h-3 rounded-full ${i === 0 ? 'bg-arquitecto-navy' : 'bg-gray-300'}" id="dot-${i}"></div>
                       `).join('')}
                           </div>
                           <button id="nextBtn" onclick="navigateCarousel(1)" class="px-4 py-2 bg-arquitecto-navy text-white rounded-lg hover:bg-arquitecto-navy-dark transition-colors">
                               Siguiente<i class="fas fa-chevron-right ml-2"></i>
                           </button>
                       </div>
                   </div>
                   
                   <!-- Botón para generar rueda -->
                   <button id="generateWheelBtn" onclick="generateMotivationalWheel()" class="w-full py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-colors mb-4" disabled>
                       <i class="fas fa-chart-radar mr-2"></i>Generar Rueda Motivacional
                   </button>
                   
                   <!-- Contenedor para la gráfica -->
                   <div id="wheelChartContainer" class="hidden">
                       <div class="max-w-md mx-auto mb-6">
                           <canvas id="motivationalWheelChart"></canvas>
                       </div>
                       <div class="space-y-3">
                           <button onclick="saveMotivationalWheel()" class="w-full py-3 bg-arquitecto-navy text-white font-semibold rounded-lg hover:bg-arquitecto-navy-dark transition-colors">
                               <i class="fas fa-save mr-2"></i>Actualizar Rueda
                           </button>
                           <button onclick="exportWheelToPDF()" class="w-full py-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition-colors">
                               <i class="fas fa-file-pdf mr-2"></i>Guardar en PDF
                           </button>
                       </div>
                   </div>
               </div>
           `);
           
           // Inicializar el carrusel
           setTimeout(() => {
               initializeMotivationalWheel();
           }, 100);
       }

       // Variables globales para la Rueda Motivacional
       let motivationalWheelChart = null;
       let currentSection = 0;
       let motivationalData = {
           familiar: {},
           laboral: {},
           social: {},
           cultural: {},
           personal: {},
           espiritual: {},
           fisico: {}
       };
       
       // Datos de las secciones
       const motivationalSections = [
           {
               name: 'FAMILIAR',
               key: 'familiar',
               questions: [
                   '¿Cómo me califico en mi aspecto familiar?',
                   '¿Qué papel juego en mi familia?',
                   '¿Soy una persona vital, vibrante, entusiasta al interior de mi familia o represento la negatividad, el regaño, la queja permanente?',
                   '¿Soy capaz de representar un punto de ecuanimidad y equilibrio al interior de mi familia?',
                   '¿He construido la familia con la que soñé?',
                   '¿Me gusta mi familia y lo que represento al interior de ella?',
                   'La siguiente pregunta es fundamental ¿Cuánto tiempo de calidad le dedico a mi familia cada día?'
               ]
           },
           {
               name: 'LABORAL',
               key: 'laboral',
               questions: [
                   '¿Me gusta el trabajo que realizo?',
                   '¿Lo realizo con entusiasmo?',
                   '¿Me es satisfactorio? ¿Estoy donde me gusta estar?',
                   '¿La profesión que desempeño es la que elegí o estoy ahí porque no me queda otra alternativa?',
                   '¿Me gustaría cambiar de trabajo?'
               ]
           },
           {
               name: 'SOCIAL',
               key: 'social',
               questions: [
                   '¿Soy una persona amigable, generosa con mi entorno?',
                   '¿Soy un ciudadano-a comprometido, participativo?',
                   '¿Cultivo la amistad como una parte importante de mi desarrollo humano?',
                   '¿Soy un vecino-amable, generoso, socializo con mi comunidad?',
                   '¿Con cuánta regularidad busco y convivo con los amigos que sé que valen la pena?',
                   '¿Soy, realmente, un buen amigo-a?',
                   '¿Respeto a los demás, aunque piensen distinto que yo?'
               ]
           },
           {
               name: 'CULTURAL',
               key: 'cultural',
               questions: [
                   '¿Suelo practicar, ver, escuchar o tener algún contacto con las artes?',
                   'En caso afirmativo, ¿con qué regularidad?',
                   '¿Cuántos libros leo al mes? ¿Elijo una buena lectura sobre una lectura vana? ¿Estudio con regularidad?',
                   '¿Me entero diariamente de las noticias?',
                   '¿Estoy enterado -a sobre los acontecimientos científicos y tecnológicos actuales?',
                   '¿Me preocupo por actualizarme tecnológicamente hablando, o uso el celular sólo para hablar?',
                   '¿Veo en la televisión programas que me enseñan cosas nuevas?'
               ]
           },
           {
               name: 'PERSONAL',
               key: 'personal',
               questions: [
                   '¿Qué lugar ocupo en mi vida?',
                   '¿Mis prioridades son los demás, por encima de mí mismo-a?',
                   '¿Cada cuándo me procuro bienestares personales?',
                   '¿Cuánto tiempo del día lo dedico a mi satisfacción y bienestar?',
                   '¿Tengo claro que cuento solamente conmigo mismo-a?',
                   '¿Asumo que la única herramienta con la que cuento para toda mi vida, soy yo mismo-a?'
               ]
           },
           {
               name: 'ESPIRITUAL',
               key: 'espiritual',
               questions: [
                   '¿Soy una persona en paz con el entorno?',
                   '¿Mi interior se encuentra en equilibrio?',
                   '¿Cuántos minutos diarios dedico a la meditación o actividades de conexión con mi ser interior?',
                   '¿Practico la fe?',
                   '¿Suelo orar con devoción o repito sin sentido oraciones aprendidas desde la infancia?',
                   '¿Tengo alguna conexión con mi espíritu?',
                   'Frente a la adversidad, ¿conservo la calma?'
               ]
           },
           {
               name: 'FÍSICO',
               key: 'fisico',
               questions: [
                   '¿Cómo me encuentro físicamente?',
                   '¿Tengo el peso adecuado?',
                   '¿Voy al dentista y/o al ginecólogo con regularidad?',
                   '¿Cuido mi alimentación?',
                   '¿Hago ejercicio regularmente?'
               ]
           }
       ];

       // Variable global para el gráfico
       let lifeWheelChart = null;
       
       function drawLifeWheel() {
           const ctx = document.getElementById('lifeWheelChart');
           if (!ctx) return;
           
           // Cargar valores guardados
           const savedValues = JSON.parse(localStorage.getItem(getUserKey('arquitectoLifeWheel')) || '[5,5,5,5,5,5,5,5]');
           
           // Destruir gráfico anterior si existe
           if (lifeWheelChart) {
               lifeWheelChart.destroy();
           }
           
           lifeWheelChart = new Chart(ctx, {
               type: 'radar',
               data: {
                   labels: ['Hijo', 'Padre', 'Pareja', 'Amigo', 'Profesional', 'Ciudadano', 'Salud', 'Espiritualidad'],
                   datasets: [{
                       label: 'Mi Balance de Vida',
                       data: savedValues,
                       backgroundColor: 'rgba(74, 159, 199, 0.2)',
                       borderColor: '#4a9fc7',
                       pointBackgroundColor: '#4a9fc7',
                       pointBorderColor: '#fff',
                       pointHoverBackgroundColor: '#fff',
                       pointHoverBorderColor: '#4a9fc7',
                       pointRadius: 5,
                       pointHoverRadius: 7
                   }]
               },
               options: {
                   responsive: true,
                   maintainAspectRatio: true,
                   scales: {
                       r: {
                           beginAtZero: true,
                           max: 10,
                           ticks: {
                               stepSize: 2
                           }
                       }
                   },
                   plugins: {
                       legend: {
                           display: false
                       }
                   }
               }
           });
       }



     // Funciones de Guardado
     function saveExercise(chapterId) {
         const inputs = document.querySelectorAll('textarea');
         const responses = Array.from(inputs).map(input => input.value);
         
         if (responses.some(r => r.trim() === '')) {
             Swal.fire({
                 icon: 'warning',
                 title: 'Ejercicio incompleto',
                 text: 'Por favor completa todos los pasos del ejercicio',
                 confirmButtonColor: '#4a9fc7'
             });
             return;
         }
         
         // Guardar en localStorage
         const exerciseData = {
             chapterId,
             responses,
             date: new Date().toISOString()
         };
         
         let exercises = JSON.parse(localStorage.getItem(getUserKey('arquitectoExercises')) || '[]');
         exercises.push(exerciseData);
         localStorage.setItem(getUserKey('arquitectoExercises'), JSON.stringify(exercises));
         
         Swal.fire({
             icon: 'success',
             title: '¡Ejercicio guardado!',
             text: 'Has completado exitosamente este ejercicio',
             confirmButtonColor: '#4a9fc7',
             showConfirmButton: true,
             timer: 3000,
             timerProgressBar: true
         });
         
         // Verificar si el capítulo se completó
         checkChapterCompletion(chapterId);
         
        // Actualizar contadores y próxima meta
        syncUserProgress();
         updateNextGoal();
     }

     function saveReflection(chapterId) {
         const reflection = document.querySelector('textarea').value;
         
         if (!reflection.trim()) {
             Swal.fire({
                 icon: 'warning',
                 title: 'Reflexión vacía',
                 text: 'Por favor escribe tu reflexión antes de guardar',
                 confirmButtonColor: '#4a9fc7'
             });
             return;
         }
         
         // Guardar reflexión
         const reflectionData = {
             chapterId,
             content: reflection,
             date: new Date().toISOString()
         };
         
         let reflections = JSON.parse(localStorage.getItem(getUserKey('arquitectoReflections')) || '[]');
         reflections.push(reflectionData);
         localStorage.setItem(getUserKey('arquitectoReflections'), JSON.stringify(reflections));
         
         Swal.fire({
             icon: 'success',
             title: 'Reflexión guardada',
             text: 'Tu reflexión ha sido guardada exitosamente',
             confirmButtonColor: '#4a9fc7',
             timer: 3000,
             timerProgressBar: true
         });
     }

     function saveCommitment(chapterId) {
         const inputs = document.querySelectorAll('input[type="text"]');
         const commitment = {
             action: inputs[0].value,
             when: inputs[1].value,
             measure: inputs[2].value
         };
         
         if (!commitment.action || !commitment.when || !commitment.measure) {
             Swal.fire({
                 icon: 'warning',
                 title: 'Compromiso incompleto',
                 text: 'Por favor completa todos los campos del compromiso',
                 confirmButtonColor: '#4a9fc7'
             });
             return;
         }
         
         // Guardar compromiso
         const commitmentData = {
             chapterId,
             ...commitment,
             date: new Date().toISOString()
         };
         
         let commitments = JSON.parse(localStorage.getItem(getUserKey('arquitectoCommitments')) || '[]');
         commitments.push(commitmentData);
         localStorage.setItem(getUserKey('arquitectoCommitments'), JSON.stringify(commitments));
         
         Swal.fire({
             icon: 'success',
             title: '¡Compromiso confirmado!',
             text: 'Tu compromiso de acción ha sido registrado',
             confirmButtonColor: '#4a9fc7',
             showConfirmButton: true,
             confirmButtonText: 'Excelente'
         }).then(() => {
            // Verificar si realmente completó todo el módulo
            const isModuleComplete = checkModuleCompletion(chapterId);
            
            if (!isModuleComplete) {
                // Mostrar qué falta por hacer
                const hasExercise = localStorage.getItem(getUserKey(`exercise_${chapterId}`)) !== null;
                
                Swal.fire({
                    icon: 'info',
                    title: '¡Compromiso Guardado!',
                    html: `
                        <div class="text-center">
                            <div class="text-4xl mb-3">📝</div>
                            <p class="text-gray-600">Tu compromiso ha sido guardado.</p>
                            ${getMissingRequirementsHTML(moduleId)}
                        </div>
                    `,
                    confirmButtonText: 'Continuar',
                    confirmButtonColor: '#4a9fc7'
                });
            }
            
            // Actualizar contadores siempre
            syncUserProgress();
         });
     }

     function saveVision() {
         // Seleccionar solo los textareas del modal activo
         const visionInputs = document.querySelectorAll('#modal textarea');
         
         if (visionInputs.length < 6) {
             Swal.fire({
                 icon: 'error',
                 title: 'Error',
                 text: 'No se pudieron encontrar todos los campos de visión',
                 confirmButtonColor: '#4a9fc7'
             });
             return;
         }
         
         const visionData = {
             personal: visionInputs[0].value,
             salud: visionInputs[1].value,
             relaciones: visionInputs[2].value,
             profesional: visionInputs[3].value,
             financiero: visionInputs[4].value,
             espiritual: visionInputs[5].value,
             date: new Date().toISOString()
         };
         
         localStorage.setItem(getUserKey('arquitectoVision'), JSON.stringify(visionData));
         
         Swal.fire({
             icon: 'success',
             title: 'Visión guardada',
             text: 'Tu visión personal ha sido guardada exitosamente',
             confirmButtonColor: '#4a9fc7'
         });
         
         closeModal();
     }

     // Variables para el audio
     let speechSynthesis = null;
     let currentUtterance = null;
     
     // Función para mostrar/ocultar el texto completo de lectura
     function toggleReadMore() {
         const previewText = document.getElementById('previewText');
         const fullText = document.getElementById('fullText');
         const readMoreBtn = document.getElementById('readMoreBtn');
         const readLessBtn = document.getElementById('readLessBtn');
         const playAudioBtn = document.getElementById('playAudioBtn');
         
         if (fullText.classList.contains('hidden')) {
             // Mostrar texto completo
             previewText.classList.add('hidden');
             fullText.classList.remove('hidden');
             readMoreBtn.classList.add('hidden');
             readLessBtn.classList.remove('hidden');
             if (playAudioBtn) playAudioBtn.classList.remove('hidden');
         } else {
             // Mostrar solo preview
             previewText.classList.remove('hidden');
             fullText.classList.add('hidden');
             readMoreBtn.classList.remove('hidden');
             readLessBtn.classList.add('hidden');
             if (playAudioBtn) playAudioBtn.classList.add('hidden');
             
             // Detener audio si está reproduciéndose
             stopAudio();
         }
     }
     
     // Función para reproducir/pausar audio
     function toggleAudio() {
         if (!('speechSynthesis' in window)) {
             Swal.fire({
                 icon: 'error',
                 title: 'No compatible',
                 text: 'Tu navegador no soporta síntesis de voz',
                 confirmButtonColor: '#4a9fc7'
             });
             return;
         }
         
         const fullText = document.getElementById('fullText');
         const playAudioBtn = document.getElementById('playAudioBtn');
         const stopAudioBtn = document.getElementById('stopAudioBtn');
         
         if (!fullText) return;
         
         // Si ya está hablando, pausar
         if (window.speechSynthesis.speaking) {
             window.speechSynthesis.pause();
             playAudioBtn.innerHTML = '<i class="fas fa-play mr-2"></i>Continuar lectura';
             return;
         }
         
         // Si está pausado, continuar
         if (window.speechSynthesis.paused) {
             window.speechSynthesis.resume();
             playAudioBtn.innerHTML = '<i class="fas fa-pause mr-2"></i>Pausar lectura';
             return;
         }
         
         // Limpiar cualquier síntesis anterior
         window.speechSynthesis.cancel();
         
         // Esperar un momento antes de iniciar nueva síntesis
         setTimeout(() => {
             try {
                 // Iniciar nueva lectura
                 const text = fullText.textContent;
                 currentUtterance = new SpeechSynthesisUtterance(text);
                 
                 // Configurar voz en español (cargar voces si no están disponibles)
                 const loadVoicesAndSpeak = () => {
                     const voices = window.speechSynthesis.getVoices();
                     const spanishVoice = voices.find(voice => 
                         voice.lang.includes('es') && voice.name.includes('Google')
                     ) || voices.find(voice => voice.lang.includes('es'));
                     
                     if (spanishVoice) {
                         currentUtterance.voice = spanishVoice;
                     }
                     
                     // Configuración de la voz
                     currentUtterance.rate = 0.9;
                     currentUtterance.pitch = 1.0;
                     currentUtterance.volume = 1.0;
                     
                     // Eventos de la síntesis de voz
                     currentUtterance.onstart = function() {
                         playAudioBtn.innerHTML = '<i class="fas fa-pause mr-2"></i>Pausar lectura';
                         playAudioBtn.classList.add('hidden');
                         stopAudioBtn.classList.remove('hidden');
                     };
                     
                     currentUtterance.onend = function() {
                         playAudioBtn.innerHTML = '<i class="fas fa-play mr-2"></i>Reproducir lectura';
                         playAudioBtn.classList.remove('hidden');
                         stopAudioBtn.classList.add('hidden');
                     };
                     
                     currentUtterance.onerror = function(event) {
                         console.error('Error de síntesis de voz:', event);
                         playAudioBtn.innerHTML = '<i class="fas fa-play mr-2"></i>Reproducir lectura';
                         playAudioBtn.classList.remove('hidden');
                         stopAudioBtn.classList.add('hidden');
                     };
                     
                     // Iniciar síntesis de voz
                     window.speechSynthesis.speak(currentUtterance);
                 };
                 
                 // Si las voces no están cargadas, esperar a que se carguen
                 if (window.speechSynthesis.getVoices().length === 0) {
                     window.speechSynthesis.addEventListener('voiceschanged', loadVoicesAndSpeak, { once: true });
                 } else {
                     loadVoicesAndSpeak();
                 }
                 
             } catch (error) {
                 console.error('Error al inicializar síntesis de voz:', error);
                 playAudioBtn.innerHTML = '<i class="fas fa-play mr-2"></i>Reproducir lectura';
                 playAudioBtn.classList.remove('hidden');
                 stopAudioBtn.classList.add('hidden');
             }
         }, 100);
     }
     
     // Función para detener audio
     function stopAudio() {
         if (window.speechSynthesis.speaking || window.speechSynthesis.paused) {
             window.speechSynthesis.cancel();
         }
         
         const playAudioBtn = document.getElementById('playAudioBtn');
         const stopAudioBtn = document.getElementById('stopAudioBtn');
         
         if (playAudioBtn) {
             playAudioBtn.innerHTML = '<i class="fas fa-play mr-2"></i>Reproducir lectura';
             playAudioBtn.classList.remove('hidden');
         }
         if (stopAudioBtn) {
             stopAudioBtn.classList.add('hidden');
         }
     }
     
     // Función para guardar reflexiones de cualquier módulo
     function saveModuleReflection(moduleId) {
         // Guardar reflexiones del módulo especificado
         const reflections = {
             q1: document.getElementById(`reflection_${moduleId}_q1`).value.trim(),
             q2: document.getElementById(`reflection_${moduleId}_q2`).value.trim(),
             q3: document.getElementById(`reflection_${moduleId}_q3`).value.trim(),
             q4: document.getElementById(`reflection_${moduleId}_q4`).value.trim(),
             date: new Date().toISOString()
         };
         
         // Validar que al menos una reflexión tenga contenido
         const hasContent = Object.values(reflections).some(value => 
             typeof value === 'string' && value.length > 0
         );
         
         if (!hasContent) {
             Swal.fire({
                 icon: 'warning',
                 title: 'Reflexiones vacías',
                 text: 'Por favor escribe al menos una reflexión antes de guardar',
                 confirmButtonColor: '#4a9fc7'
             });
             return;
         }
         
         // Guardar en localStorage
         localStorage.setItem(getUserKey(`reflection_${moduleId}`), JSON.stringify(reflections));
         
         Swal.fire({
             icon: 'success',
             title: 'Reflexiones guardadas',
             text: 'Tus reflexiones han sido guardadas exitosamente',
             confirmButtonColor: '#4a9fc7'
         });
     }
     
     // ===== FUNCIONES PARA EJERCICIOS DEL MÓDULO =====
     
     function addGoalRow() {
         const tableBody = document.getElementById('goalsTableBody');
         const currentRows = tableBody.children.length;
         
         // Máximo 5 filas (3 iniciales + 2 adicionales)
         if (currentRows >= 5) {
             Swal.fire({
                 icon: 'warning',
                 title: 'Límite alcanzado',
                 text: 'Máximo 5 metas permitidas',
                 confirmButtonColor: '#4a9fc7'
             });
             return;
         }
         
         const newRowIndex = currentRows;
         const newRow = document.createElement('tr');
         newRow.innerHTML = `
             <td class="border border-gray-300 p-3 text-center font-medium">${newRowIndex + 1}</td>
             <td class="border border-gray-300 p-2">
                 <textarea class="w-full p-2 border-0 resize-none focus:outline-none goal-meta" 
                           rows="2" placeholder="Describe tu meta..." data-index="${newRowIndex}"></textarea>
             </td>
             <td class="border border-gray-300 p-2 text-center">
                 <input type="date" class="w-full p-2 border-0 focus:outline-none goal-fecha" 
                        value="" data-index="${newRowIndex}">
             </td>
         `;
         
         tableBody.appendChild(newRow);
         
         // Ocultar botón si llegamos al máximo
         if (currentRows + 1 >= 5) {
             document.getElementById('addGoalBtn').style.display = 'none';
         }
     }
     
     function saveModuleExercise(moduleId) {
         if (moduleId === 1) {
             // Recopilar datos de las 3 áreas
             const exerciseData = {
                 profesional: document.getElementById('exercise_1_profesional').value.trim(),
                 personal: document.getElementById('exercise_1_personal').value.trim(),
                 familiar: document.getElementById('exercise_1_familiar').value.trim(),
                 goals: [],
                 date: new Date().toISOString()
             };
             
             // Recopilar datos de la tabla de metas
             const goalMetas = document.querySelectorAll('.goal-meta');
             const goalFechas = document.querySelectorAll('.goal-fecha');
             
             for (let i = 0; i < goalMetas.length; i++) {
                 const meta = goalMetas[i].value.trim();
                 const fecha = goalFechas[i].value;
                 
                 exerciseData.goals.push({
                     meta: meta,
                     fecha: fecha
                 });
             }
             
             // Validar que al menos una área tenga contenido
             const hasAreaContent = exerciseData.profesional || exerciseData.personal || exerciseData.familiar;
             
             // Validar que al menos una meta tenga contenido
             const hasGoalContent = exerciseData.goals.some(goal => goal.meta.length > 0);
             
             if (!hasAreaContent && !hasGoalContent) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Ejercicio vacío',
                     text: 'Por favor completa al menos una área o una meta antes de guardar',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Guardar en localStorage
             localStorage.setItem(getUserKey(`exercise_${moduleId}`), JSON.stringify(exerciseData));
             
             // Verificar si completó el módulo
             const isModuleComplete = checkModuleCompletion(moduleId);
             
             if (!isModuleComplete) {
                 Swal.fire({
                     icon: 'success',
                     title: '¡Ejercicio Guardado!',
                     html: `
                         <div class="text-center">
                             <div class="text-4xl mb-3">📚</div>
                             <p class="text-gray-600">Tu ejercicio ha sido guardado exitosamente.</p>
                             ${getMissingRequirementsHTML(moduleId)}
                         </div>
                     `,
                     confirmButtonText: 'Continuar',
                     confirmButtonColor: '#4a9fc7'
                 });
             }
         } else if (moduleId === 2) {
             // Recopilar datos del Módulo 2: La Visión
             const exerciseData = {
                 vision_temporal: document.getElementById('exercise_2_vision_temporal').value.trim(),
                 entorno_deseado: document.getElementById('exercise_2_entorno_deseado').value.trim(),
                 foda: {},
                 date: new Date().toISOString()
             };
             
             // Recopilar datos FODA
             const categories = ['fortalezas', 'debilidades', 'amenazas', 'oportunidades'];
             categories.forEach(category => {
                 const items = document.querySelectorAll(`[data-category="${category}"]`);
                 exerciseData.foda[category] = [];
                 
                 items.forEach(item => {
                     const text = item.querySelector('.foda-text').value.trim();
                     const value = parseInt(item.querySelector('.foda-value').value) || 0;
                     
                     if (text !== '') {
                         exerciseData.foda[category].push({ text, value });
                     }
                 });
             });
             
             // Validar que al menos los ejercicios básicos tengan contenido
             if (!exerciseData.vision_temporal && !exerciseData.entorno_deseado) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Ejercicio vacío',
                     text: 'Por favor completa al menos uno de los ejercicios de visión antes de guardar',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Guardar en localStorage
             localStorage.setItem(getUserKey(`exercise_${moduleId}`), JSON.stringify(exerciseData));
             
            // Verificar si completó el módulo
            const isModuleComplete = checkModuleCompletion(moduleId);

            if (!isModuleComplete) {
                Swal.fire({
                    icon: 'success',
                    title: '¡Ejercicio Guardado!',
                    html: `
                        <div class="text-center">
                            <div class="text-4xl mb-3">📚</div>
                            <p class="text-gray-600">Tu ejercicio ha sido guardado exitosamente.</p>
                            ${getMissingRequirementsHTML(moduleId)}
                        </div>
                    `,
                    confirmButtonText: 'Continuar',
                    confirmButtonColor: '#4a9fc7'
                });
            }

            // Actualizar contadores siempre  
            syncUserProgress();
        } else if (moduleId === 3) {
            // Recopilar datos del Módulo 3: En Mi Relación con Dios
            const exerciseData = {
                defectos_dominantes: document.getElementById('exercise_3_defectos').value.trim(),
                placeres_regulares: document.getElementById('exercise_3_placeres').value.trim(),
                placer_regla_oro: document.getElementById('exercise_3_placer_regla').value.trim(),
                atractivo_placer: document.getElementById('exercise_3_atractivo').value.trim(),
                placeres_comprometen: document.getElementById('exercise_3_comprometen').value.trim(),
                necesidad_llenar: document.getElementById('exercise_3_necesidad').value.trim(),
                brujula_moral: document.getElementById('exercise_3_brujula').value.trim(),
                decisiones_difusas: document.getElementById('exercise_3_difusas').value.trim(),
                situaciones_guia: {
                    perdidos: document.getElementById('exercise_3_perdidos').value.trim(),
                    confundidos: document.getElementById('exercise_3_confundidos').value.trim(),
                    estancados: document.getElementById('exercise_3_estancados').value.trim(),
                    distraidos: document.getElementById('exercise_3_distraidos').value.trim(),
                    verdadero: document.getElementById('exercise_3_verdadero').value.trim()
                },
                navegacion_viaje: document.getElementById('exercise_3_navegacion').value.trim(),
                regla_oro_decision: document.getElementById('exercise_3_regla_decision').value.trim(),
                date: new Date().toISOString()
            };
            
            // Validar que al menos algunos ejercicios tengan contenido
            const hasContent = exerciseData.defectos_dominantes || exerciseData.placeres_regulares || 
                             exerciseData.placer_regla_oro || exerciseData.brujula_moral || 
                             exerciseData.navegacion_viaje || exerciseData.regla_oro_decision;
            
            if (!hasContent) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Ejercicio vacío',
                    text: 'Por favor completa al menos uno de los ejercicios antes de guardar',
                    confirmButtonColor: '#4a9fc7'
                });
                return;
            }
            
            // Guardar en localStorage
            localStorage.setItem(getUserKey(`exercise_${moduleId}`), JSON.stringify(exerciseData));
            
            // Verificar si completó el módulo
            const isModuleComplete = checkModuleCompletion(moduleId);

            if (!isModuleComplete) {
                Swal.fire({
                    icon: 'success',
                    title: '¡Ejercicio Guardado!',
                    html: `
                        <div class="text-center">
                            <div class="text-4xl mb-3">📚</div>
                            <p class="text-gray-600">Tu ejercicio ha sido guardado exitosamente.</p>
                            ${getMissingRequirementsHTML(moduleId)}
                        </div>
                    `,
                    confirmButtonText: 'Continuar',
                    confirmButtonColor: '#4a9fc7'
                });
            }

            // Actualizar contadores siempre  
            syncUserProgress();
         } else if (moduleId === 4) {
             // Recopilar datos del Módulo 4: El Rol de Hijo
             const exerciseData = {
                 relacion_actual: document.getElementById('exercise_4_relacion_actual').value.trim(),
                 relacion_deseada: document.getElementById('exercise_4_relacion_deseada').value.trim(),
                 vision_futuro: document.getElementById('exercise_4_vision_futuro').value.trim(),
                 acciones_plan: document.getElementById('exercise_4_acciones_plan').value.trim(),
                 date: new Date().toISOString()
             };
             
             // Validar que al menos algunos ejercicios tengan contenido
             const hasContent = exerciseData.relacion_actual || exerciseData.relacion_deseada || 
                              exerciseData.vision_futuro || exerciseData.acciones_plan;
             
             if (!hasContent) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Ejercicio vacío',
                     text: 'Por favor completa al menos una de las preguntas antes de guardar',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Guardar en localStorage
             localStorage.setItem(getUserKey(`exercise_${moduleId}`), JSON.stringify(exerciseData));
             
             // Verificar si completó el módulo
             const isModuleComplete = checkModuleCompletion(moduleId);
             
             if (!isModuleComplete) {
                 Swal.fire({
                     icon: 'success',
                     title: '¡Ejercicio Guardado!',
                     html: `
                         <div class="text-center">
                             <div class="text-4xl mb-3">📚</div>
                             <p class="text-gray-600">Tu ejercicio ha sido guardado exitosamente.</p>
                             ${getMissingRequirementsHTML(moduleId)}
                         </div>
                     `,
                     confirmButtonText: 'Continuar',
                     confirmButtonColor: '#4a9fc7'
                 });
             }
         } else if (moduleId === 5) {
             // Recopilar datos del Módulo 5: El Rol de Padre
             const exerciseData = {
                 relacion_actual: document.getElementById('exercise_5_relacion_actual').value.trim(),
                 relacion_deseada: document.getElementById('exercise_5_relacion_deseada').value.trim(),
                 vision_futuro: document.getElementById('exercise_5_vision_futuro').value.trim(),
                 acciones_plan: document.getElementById('exercise_5_acciones_plan').value.trim(),
                 date: new Date().toISOString()
             };
             
             // Validar que al menos algunos ejercicios tengan contenido
             const hasContent = exerciseData.relacion_actual || exerciseData.relacion_deseada || 
                              exerciseData.vision_futuro || exerciseData.acciones_plan;
             
             if (!hasContent) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Ejercicio vacío',
                     text: 'Por favor completa al menos una de las preguntas antes de guardar',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Guardar en localStorage
             localStorage.setItem(getUserKey(`exercise_${moduleId}`), JSON.stringify(exerciseData));
             
             // Verificar si completó el módulo
             const isModuleComplete = checkModuleCompletion(moduleId);
             
             if (!isModuleComplete) {
                 Swal.fire({
                     icon: 'success',
                     title: '¡Ejercicio Guardado!',
                     html: `
                         <div class="text-center">
                             <div class="text-4xl mb-3">📚</div>
                             <p class="text-gray-600">Tu ejercicio del Módulo 5 ha sido guardado exitosamente.</p>
                             ${getMissingRequirementsHTML(moduleId)}
                         </div>
                     `,
                     confirmButtonText: 'Continuar',
                     confirmButtonColor: '#4a9fc7'
                 });
             }
             
             // Actualizar contadores
             syncUserProgress();
         } else if (moduleId === 6) {
             // Recopilar datos del Módulo 6: El Rol de Pareja
             const exerciseData = {
                 relacion_actual: document.getElementById('exercise_6_relacion_actual').value.trim(),
                 relacion_deseada: document.getElementById('exercise_6_relacion_deseada').value.trim(),
                 vision_futuro: document.getElementById('exercise_6_vision_futuro').value.trim(),
                 acciones_plan: document.getElementById('exercise_6_acciones_plan').value.trim(),
                 date: new Date().toISOString()
             };
             
             // Validar que al menos algunos ejercicios tengan contenido
             const hasContent = exerciseData.relacion_actual || exerciseData.relacion_deseada || 
                              exerciseData.vision_futuro || exerciseData.acciones_plan;
             
             if (!hasContent) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Ejercicio vacío',
                     text: 'Por favor completa al menos una de las preguntas antes de guardar',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Guardar en localStorage
             localStorage.setItem(getUserKey(`exercise_${moduleId}`), JSON.stringify(exerciseData));
             
             // Verificar si completó el módulo
             const isModuleComplete = checkModuleCompletion(moduleId);
             
             if (!isModuleComplete) {
                 Swal.fire({
                     icon: 'success',
                     title: '¡Ejercicio Guardado!',
                     html: `
                         <div class="text-center">
                             <div class="text-4xl mb-3">📚</div>
                             <p class="text-gray-600">Tu ejercicio del Módulo 6 ha sido guardado exitosamente.</p>
                             ${getMissingRequirementsHTML(moduleId)}
                         </div>
                     `,
                     confirmButtonText: 'Continuar',
                     confirmButtonColor: '#4a9fc7'
                 });
             }
             
             // Actualizar contadores
             syncUserProgress();
         } else if (moduleId === 7) {
             // Recopilar datos del Módulo 7: El Rol de Amigo
             const exerciseData = {
                 relacion_actual: document.getElementById('exercise_7_relacion_actual').value.trim(),
                 relacion_deseada: document.getElementById('exercise_7_relacion_deseada').value.trim(),
                 vision_futuro: document.getElementById('exercise_7_vision_futuro').value.trim(),
                 acciones_plan: document.getElementById('exercise_7_acciones_plan').value.trim(),
                 date: new Date().toISOString()
             };
             
             // Validar que al menos algunos ejercicios tengan contenido
             const hasContent = exerciseData.relacion_actual || exerciseData.relacion_deseada || 
                              exerciseData.vision_futuro || exerciseData.acciones_plan;
             
             if (!hasContent) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Ejercicio vacío',
                     text: 'Por favor completa al menos una de las preguntas antes de guardar',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Guardar en localStorage
             localStorage.setItem(getUserKey(`exercise_${moduleId}`), JSON.stringify(exerciseData));
             
             // Verificar si completó el módulo
             const isModuleComplete = checkModuleCompletion(moduleId);
             
             if (!isModuleComplete) {
                 Swal.fire({
                     icon: 'success',
                     title: '¡Ejercicio Guardado!',
                     html: `
                         <div class="text-center">
                             <div class="text-4xl mb-3">📚</div>
                             <p class="text-gray-600">Tu ejercicio del Módulo 7 ha sido guardado exitosamente.</p>
                             ${getMissingRequirementsHTML(moduleId)}
                         </div>
                     `,
                     confirmButtonText: 'Continuar',
                     confirmButtonColor: '#4a9fc7'
                 });
             }
             
             // Actualizar contadores
             syncUserProgress();
         } else if (moduleId === 8) {
             // Recopilar datos del Módulo 8: El Rol Profesional
             const exerciseData = {
                 sentimiento_actual: document.getElementById('exercise_8_sentimiento_actual').value.trim(),
                 rol_deseado: document.getElementById('exercise_8_rol_deseado').value.trim(),
                 vision_profesional: document.getElementById('exercise_8_vision_profesional').value.trim(),
                 acciones_vision: document.getElementById('exercise_8_acciones_vision').value.trim(),
                 situaciones_mejorar: document.getElementById('exercise_8_situaciones_mejorar').value.trim(),
                 desarrollo_necesario: document.getElementById('exercise_8_desarrollo_necesario').value.trim(),
                 factores_vitales: document.getElementById('exercise_8_factores_vitales').value.trim(),
                 obstaculos: document.getElementById('exercise_8_obstaculos').value.trim(),
                 date: new Date().toISOString()
             };
             
             // Validar que al menos algunos ejercicios tengan contenido
             const hasContent = exerciseData.sentimiento_actual || exerciseData.rol_deseado || 
                              exerciseData.vision_profesional || exerciseData.acciones_vision ||
                              exerciseData.situaciones_mejorar || exerciseData.desarrollo_necesario ||
                              exerciseData.factores_vitales || exerciseData.obstaculos;
             
             if (!hasContent) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Ejercicio vacío',
                     text: 'Por favor completa al menos una de las preguntas antes de guardar',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Guardar en localStorage
             localStorage.setItem(getUserKey(`exercise_${moduleId}`), JSON.stringify(exerciseData));
             
             // Verificar si completó el módulo
             const isModuleComplete = checkModuleCompletion(moduleId);
             
             if (!isModuleComplete) {
                 Swal.fire({
                     icon: 'success',
                     title: '¡Ejercicio Guardado!',
                     html: `
                         <div class="text-center">
                             <div class="text-4xl mb-3">📚</div>
                             <p class="text-gray-600">Tu ejercicio del Módulo 8 ha sido guardado exitosamente.</p>
                             ${getMissingRequirementsHTML(moduleId)}
                         </div>
                     `,
                     confirmButtonText: 'Continuar',
                     confirmButtonColor: '#4a9fc7'
                 });
             }
             
             // Actualizar contadores
             syncUserProgress();
         } else if (moduleId === 9) {
             // Recopilar datos del Módulo 9: Conmigo Mismo
             const exerciseData = {
                 // Preguntas de ciudadanía
                 ciudadano_actual: document.getElementById('exercise_9_ciudadano_actual').value.trim(),
                 ciudadano_deseado: document.getElementById('exercise_9_ciudadano_deseado').value.trim(),
                 vision_ciudadano: document.getElementById('exercise_9_vision_ciudadano').value.trim(),
                 acciones_vision: document.getElementById('exercise_9_acciones_vision').value.trim(),
                 situaciones_mejorar: document.getElementById('exercise_9_situaciones_mejorar').value.trim(),
                 // Rueda de la vida - valores de barras deslizantes
                 salud: document.getElementById('salud_slider').value,
                 dinero: document.getElementById('dinero_slider').value,
                 amor: document.getElementById('amor_slider').value,
                 familia: document.getElementById('familia_slider').value,
                 profesion: document.getElementById('profesion_slider').value,
                 desarrollo: document.getElementById('desarrollo_slider').value,
                 ocio: document.getElementById('ocio_slider').value,
                 amigos: document.getElementById('amigos_slider').value,
                 // Preguntas adicionales de la rueda de la vida
                 areas_prioridad: document.getElementById('exercise_9_areas_prioridad').value.trim(),
                 obstaculos: document.getElementById('exercise_9_obstaculos').value.trim(),
                 inhibiciones: document.getElementById('exercise_9_inhibiciones').value.trim(),
                 date: new Date().toISOString()
             };
             
             // Validar que al menos algunos ejercicios tengan contenido
             const hasContent = exerciseData.ciudadano_actual || exerciseData.ciudadano_deseado || 
                              exerciseData.vision_ciudadano || exerciseData.acciones_vision ||
                              exerciseData.situaciones_mejorar || exerciseData.areas_prioridad ||
                              exerciseData.obstaculos || exerciseData.inhibiciones;
             
             if (!hasContent) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Ejercicio vacío',
                     text: 'Por favor completa al menos una de las preguntas antes de guardar',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Guardar en localStorage
             localStorage.setItem(getUserKey(`exercise_${moduleId}`), JSON.stringify(exerciseData));
             
             // Verificar si completó el módulo
             const isModuleComplete = checkModuleCompletion(moduleId);
             
             if (!isModuleComplete) {
                 Swal.fire({
                     icon: 'success',
                     title: '¡Ejercicio Guardado!',
                     html: `
                         <div class="text-center">
                             <div class="text-4xl mb-3">📚</div>
                             <p class="text-gray-600">Tu ejercicio del Módulo 9 ha sido guardado exitosamente.</p>
                             ${getMissingRequirementsHTML(moduleId)}
                         </div>
                     `,
                     confirmButtonText: 'Continuar',
                     confirmButtonColor: '#4a9fc7'
                 });
             }
             
             // Actualizar contadores
             syncUserProgress();
         } else if (moduleId === 10) {
             // Recopilar datos del Módulo 10: Conclusiones
             const exerciseData = {
                 vision_integral: document.getElementById('exercise_10_vision_integral').value.trim(),
                 cualidades_emprendedor: document.getElementById('exercise_10_cualidades_emprendedor').value.trim(),
                 situaciones_cambiar: document.getElementById('exercise_10_situaciones_cambiar').value.trim(),
                 proyectos_mente: document.getElementById('exercise_10_proyectos_mente').value.trim(),
                 emprender_personal: document.getElementById('exercise_10_emprender_personal').value.trim(),
                 date: new Date().toISOString()
             };
             
             // Validar que al menos algunos ejercicios tengan contenido
             const hasContent = exerciseData.vision_integral || exerciseData.cualidades_emprendedor || 
                              exerciseData.situaciones_cambiar || exerciseData.proyectos_mente ||
                              exerciseData.emprender_personal;
             
             if (!hasContent) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Ejercicio vacío',
                     text: 'Por favor completa al menos una de las preguntas antes de guardar',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Guardar en localStorage
             localStorage.setItem(getUserKey(`exercise_${moduleId}`), JSON.stringify(exerciseData));
             
             // Verificar si completó el módulo
             const isModuleComplete = checkModuleCompletion(moduleId);
             
             if (!isModuleComplete) {
                 Swal.fire({
                     icon: 'success',
                     title: '¡Ejercicio Guardado!',
                     html: `
                         <div class="text-center">
                             <div class="text-4xl mb-3">📚</div>
                             <p class="text-gray-600">Tu ejercicio del Módulo 10 ha sido guardado exitosamente.</p>
                             ${getMissingRequirementsHTML(moduleId)}
                         </div>
                     `,
                     confirmButtonText: 'Continuar',
                     confirmButtonColor: '#4a9fc7'
                 });
             }
             
             // Actualizar contadores
             syncUserProgress();
         }
     }
     
     // ===== FUNCIONES PARA COMPROMISOS DEL MÓDULO =====
     
     function saveModuleCommitment(moduleId) {
         if (moduleId === 1) {
             // Recopilar datos de los 3 aspectos
             const commitmentData = {
                 profesional: document.getElementById('commitment_1_profesional').value.trim(),
                 personal: document.getElementById('commitment_1_personal').value.trim(),
                 familiar: document.getElementById('commitment_1_familiar').value.trim(),
                 date: new Date().toISOString()
             };
             
             // Validar que al menos un aspecto tenga contenido
             const hasContent = commitmentData.profesional || commitmentData.personal || commitmentData.familiar;
             
             if (!hasContent) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Compromisos vacíos',
                     text: 'Por favor escribe al menos un compromiso antes de guardar',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Guardar en localStorage
             localStorage.setItem(getUserKey(`commitment_${moduleId}`), JSON.stringify(commitmentData));
            
           // Verificar si completó el módulo
            const isModuleComplete = checkModuleCompletion(moduleId);
            
            if (!isModuleComplete) {
                Swal.fire({
                    icon: 'success',
                    title: '¡Compromiso Guardado!',
                    html: `
                        <div class="text-center">
                            <div class="text-4xl mb-3">📝</div>
                            <p class="text-gray-600">Tu compromiso ha sido guardado exitosamente.</p>
                            ${getMissingRequirementsHTML(moduleId)}
                        </div>
                    `,
                    confirmButtonText: 'Continuar',
                    confirmButtonColor: '#4a9fc7'
                });
            }
            
            // Actualizar contadores siempre
            syncUserProgress();
         } else if (moduleId === 2) {
             // Recopilar datos del Módulo 2: La Visión
             const commitmentData = {
                 vision: document.getElementById('commitment_2_vision').value.trim(),
                 autocontrol: document.getElementById('commitment_2_autocontrol').value.trim(),
                 revision: document.getElementById('commitment_2_revision').value.trim(),
                 date: new Date().toISOString()
             };
             
             // Validar que al menos un compromiso tenga contenido
             const hasContent = commitmentData.vision || commitmentData.autocontrol || commitmentData.revision;
             
             if (!hasContent) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Compromisos vacíos',
                     text: 'Por favor escribe al menos un compromiso antes de guardar',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Guardar en localStorage
             localStorage.setItem(getUserKey(`commitment_${moduleId}`), JSON.stringify(commitmentData));
             
            // Verificar si completó el módulo
            const isModuleComplete = checkModuleCompletion(moduleId);
            
            if (!isModuleComplete) {
                Swal.fire({
                    icon: 'success',
                    title: '¡Compromiso Guardado!',
                    html: `
                        <div class="text-center">
                            <div class="text-4xl mb-3">📝</div>
                            <p class="text-gray-600">Tu compromiso ha sido guardado exitosamente.</p>
                            ${getMissingRequirementsHTML(moduleId)}
                        </div>
                    `,
                    confirmButtonText: 'Continuar',
                    confirmButtonColor: '#4a9fc7'
                });
            }
            
            // Actualizar contadores siempre
            syncUserProgress();
         } else if (moduleId === 3) {
             // Recopilar datos del Módulo 3: En Mi Relación con Dios
             const commitmentData = {
                 defecto_virtud: document.getElementById('commitment_3_defecto').value.trim(),
                 regla_oro: document.getElementById('commitment_3_regla').value.trim(),
                 brujula_moral: document.getElementById('commitment_3_brujula').value.trim(),
                 date: new Date().toISOString()
             };
             
             // Validar que al menos un compromiso tenga contenido
             const hasContent = commitmentData.defecto_virtud || commitmentData.regla_oro || commitmentData.brujula_moral;
             
             if (!hasContent) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Compromisos vacíos',
                     text: 'Por favor escribe al menos un compromiso antes de guardar',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Guardar en localStorage
             localStorage.setItem(getUserKey(`commitment_${moduleId}`), JSON.stringify(commitmentData));
             
             // Verificar si completó el módulo
             const isModuleComplete = checkModuleCompletion(moduleId);
             
             if (!isModuleComplete) {
                 Swal.fire({
                     icon: 'success',
                     title: '¡Compromiso Guardado!',
                     html: `
                         <div class="text-center">
                             <div class="text-4xl mb-3">📝</div>
                             <p class="text-gray-600">Tu compromiso ha sido guardado exitosamente.</p>
                             ${getMissingRequirementsHTML(moduleId)}
                         </div>
                     `,
                     confirmButtonText: 'Continuar',
                     confirmButtonColor: '#4a9fc7'
                 });
             }
             
             // Actualizar contadores siempre
             syncUserProgress();
         } else if (moduleId === 4) {
             // Recopilar datos del Módulo 4: El Rol de Hijo
             const commitmentData = {
                 accion: document.getElementById('commitment_4_accion').value.trim(),
                 date: new Date().toISOString()
             };
             
             // Validar que el compromiso tenga contenido
             if (!commitmentData.accion) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Compromiso vacío',
                     text: 'Por favor escribe tu compromiso antes de guardar',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Guardar en localStorage
             localStorage.setItem(getUserKey(`commitment_${moduleId}`), JSON.stringify(commitmentData));
             
             // Verificar si completó el módulo
             const isModuleComplete = checkModuleCompletion(moduleId);
             
             if (!isModuleComplete) {
                 const hasExercise = localStorage.getItem(getUserKey(`exercise_${moduleId}`)) !== null;
                 
                 Swal.fire({
                     icon: 'success',
                     title: '¡Compromiso Guardado!',
                     html: `
                         <div class="text-center">
                             <div class="text-4xl mb-3">📝</div>
                             <p class="text-gray-600">Tu compromiso ha sido guardado exitosamente.</p>
                             ${getMissingRequirementsHTML(moduleId)}
                             <p class="mt-2 text-sm text-gray-500">Completa todo para finalizar el módulo</p>
                         </div>
                     `,
                     confirmButtonText: 'Continuar',
                     confirmButtonColor: '#4a9fc7'
                 });
             } else {
                 // Módulo completado - La pantalla de celebración ya se mostró en completeChapter()
             Swal.fire({
                 icon: 'success',
                 title: 'Compromiso guardado',
                 text: 'Tu compromiso ha sido guardado exitosamente',
                 confirmButtonColor: '#4a9fc7'
             });
             }
             
             // Actualizar contadores siempre
             syncUserProgress();
         } else if (moduleId === 5) {
             // Recopilar datos del Módulo 5: El Rol de Padre
             const commitmentData = {
                 tiempo_padres: document.getElementById('commitment_5_tiempo_padres').value.trim(),
                 acciones_involucrarme: document.getElementById('commitment_5_acciones_involucrarme').value.trim(),
                 plan_recuerdos: document.getElementById('commitment_5_plan_recuerdos').value.trim(),
                 date: new Date().toISOString()
             };
             
             // Validar que al menos un compromiso tenga contenido
             const hasContent = commitmentData.tiempo_padres || commitmentData.acciones_involucrarme || commitmentData.plan_recuerdos;
             
             if (!hasContent) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Compromiso vacío',
                     text: 'Por favor completa al menos uno de los compromisos antes de guardar',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Guardar en localStorage
             localStorage.setItem(getUserKey(`commitment_${moduleId}`), JSON.stringify(commitmentData));
             
             // Verificar si completó el módulo
             const isModuleComplete = checkModuleCompletion(moduleId);
             
             if (!isModuleComplete) {
                 const hasExercise = localStorage.getItem(getUserKey(`exercise_${moduleId}`)) !== null;
                 
                 Swal.fire({
                     icon: 'success',
                     title: '¡Compromiso Guardado!',
                     html: `
                         <div class="text-center">
                             <div class="text-4xl mb-3">📝</div>
                             <p class="text-gray-600">Tu compromiso ha sido guardado exitosamente.</p>
                             ${getMissingRequirementsHTML(moduleId)}
                             <p class="mt-2 text-sm text-gray-500">Completa todo para finalizar el módulo</p>
                         </div>
                     `,
                     confirmButtonText: 'Continuar',
                     confirmButtonColor: '#4a9fc7'
                 });
             } else {
                 // Módulo completado - La pantalla de celebración ya se mostró en completeChapter()
             Swal.fire({
                 icon: 'success',
                 title: 'Compromiso guardado',
                 text: 'Tu compromiso del Módulo 5: El Rol de Padre ha sido guardado exitosamente',
                 confirmButtonColor: '#4a9fc7'
             });
             }
             
             // Actualizar contadores siempre
             syncUserProgress();
         } else if (moduleId === 6) {
             // Recopilar datos del Módulo 6: El Rol de Pareja
             const commitmentData = {
                 plan_mejorar: document.getElementById('commitment_6_plan_mejorar').value.trim(),
                 tiempo_semanal: document.getElementById('commitment_6_tiempo_semanal').value.trim(),
                 acciones_conjunto: document.getElementById('commitment_6_acciones_conjunto').value.trim(),
                 date: new Date().toISOString()
             };
             
             // Validar que al menos un compromiso tenga contenido
             const hasContent = commitmentData.plan_mejorar || commitmentData.tiempo_semanal || commitmentData.acciones_conjunto;
             
             if (!hasContent) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Compromiso vacío',
                     text: 'Por favor completa al menos uno de los compromisos antes de guardar',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Guardar en localStorage
             localStorage.setItem(getUserKey(`commitment_${moduleId}`), JSON.stringify(commitmentData));
             
             // Verificar si completó el módulo
             const isModuleComplete = checkModuleCompletion(moduleId);
             
             if (!isModuleComplete) {
                 const hasExercise = localStorage.getItem(getUserKey(`exercise_${moduleId}`)) !== null;
                 
                 Swal.fire({
                     icon: 'success',
                     title: '¡Compromiso Guardado!',
                     html: `
                         <div class="text-center">
                             <div class="text-4xl mb-3">📝</div>
                             <p class="text-gray-600">Tu compromiso ha sido guardado exitosamente.</p>
                             ${getMissingRequirementsHTML(moduleId)}
                             <p class="mt-2 text-sm text-gray-500">Completa todo para finalizar el módulo</p>
                         </div>
                     `,
                     confirmButtonText: 'Continuar',
                     confirmButtonColor: '#4a9fc7'
                 });
             } else {
                 // Módulo completado - La pantalla de celebración ya se mostró en completeChapter()
             Swal.fire({
                 icon: 'success',
                 title: 'Compromiso guardado',
                 text: 'Tu compromiso del Módulo 6: El Rol de Pareja ha sido guardado exitosamente',
                 confirmButtonColor: '#4a9fc7'
             });
             }
             
             // Actualizar contadores siempre
             syncUserProgress();
         } else if (moduleId === 7) {
             // Recopilar datos del Módulo 7: El Rol de Amigo
             const commitmentData = {
                 plan_amistades: document.getElementById('commitment_7_plan_amistades').value.trim(),
                 date: new Date().toISOString()
             };
             
             // Validar que el compromiso tenga contenido
             if (!commitmentData.plan_amistades) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Compromiso vacío',
                     text: 'Por favor completa tu plan específico para mantener y fortalecer tus amistades antes de guardar',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Guardar en localStorage
             localStorage.setItem(getUserKey(`commitment_${moduleId}`), JSON.stringify(commitmentData));
             
             // Verificar si completó el módulo
             const isModuleComplete = checkModuleCompletion(moduleId);
             
             if (!isModuleComplete) {
                 const hasExercise = localStorage.getItem(getUserKey(`exercise_${moduleId}`)) !== null;
                 
                 Swal.fire({
                     icon: 'success',
                     title: '¡Compromiso Guardado!',
                     html: `
                         <div class="text-center">
                             <div class="text-4xl mb-3">📝</div>
                             <p class="text-gray-600">Tu compromiso ha sido guardado exitosamente.</p>
                             ${getMissingRequirementsHTML(moduleId)}
                             <p class="mt-2 text-sm text-gray-500">Completa todo para finalizar el módulo</p>
                         </div>
                     `,
                     confirmButtonText: 'Continuar',
                     confirmButtonColor: '#4a9fc7'
                 });
             } else {
                 // Módulo completado - La pantalla de celebración ya se mostró en completeChapter()
             Swal.fire({
                 icon: 'success',
                 title: 'Compromiso guardado',
                 text: 'Tu compromiso del Módulo 7: El Rol de Amigo ha sido guardado exitosamente',
                 confirmButtonColor: '#4a9fc7'
             });
             }
             
             // Actualizar contadores siempre
             syncUserProgress();
         } else if (moduleId === 8) {
             // Recopilar datos del Módulo 8: El Rol Profesional
             const commitmentData = {
                 meta_profesional: document.getElementById('commitment_8_meta_profesional').value.trim(),
                 plan_accion: document.getElementById('commitment_8_plan_accion').value.trim(),
                 estrategia: document.getElementById('commitment_8_estrategia').value.trim(),
                 date: new Date().toISOString()
             };
             
             // Validar que al menos un compromiso tenga contenido
             const hasContent = commitmentData.meta_profesional || commitmentData.plan_accion || commitmentData.estrategia;
             
             if (!hasContent) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Compromiso vacío',
                     text: 'Por favor completa al menos uno de los compromisos antes de guardar',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Guardar en localStorage
             localStorage.setItem(getUserKey(`commitment_${moduleId}`), JSON.stringify(commitmentData));
             
             // Verificar si completó el módulo
             const isModuleComplete = checkModuleCompletion(moduleId);
             
             if (!isModuleComplete) {
                 const hasExercise = localStorage.getItem(getUserKey(`exercise_${moduleId}`)) !== null;
                 
                 Swal.fire({
                     icon: 'success',
                     title: '¡Compromiso Guardado!',
                     html: `
                         <div class="text-center">
                             <div class="text-4xl mb-3">📝</div>
                             <p class="text-gray-600">Tu compromiso ha sido guardado exitosamente.</p>
                             ${getMissingRequirementsHTML(moduleId)}
                             <p class="mt-2 text-sm text-gray-500">Completa todo para finalizar el módulo</p>
                         </div>
                     `,
                     confirmButtonText: 'Continuar',
                     confirmButtonColor: '#4a9fc7'
                 });
             } else {
                 // Módulo completado - La pantalla de celebración ya se mostró en completeChapter()
             Swal.fire({
                 icon: 'success',
                 title: 'Compromiso guardado',
                 text: 'Tu compromiso del Módulo 8: El Rol Profesional ha sido guardado exitosamente',
                 confirmButtonColor: '#4a9fc7'
             });
             }
             
             // Actualizar contadores siempre
             syncUserProgress();
         } else if (moduleId === 9) {
             // Recopilar datos del Módulo 9: Conmigo Mismo
             const commitmentData = {
                 contribucion_ciudadana: document.getElementById('commitment_9_contribucion_ciudadana').value.trim(),
                 plan_ciudadano: document.getElementById('commitment_9_plan_ciudadano').value.trim(),
                 mejora_areas: document.getElementById('commitment_9_mejora_areas').value.trim(),
                 date: new Date().toISOString()
             };
             
             // Validar que al menos un compromiso tenga contenido
             const hasContent = commitmentData.contribucion_ciudadana || commitmentData.plan_ciudadano || commitmentData.mejora_areas;
             
             if (!hasContent) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Compromiso vacío',
                     text: 'Por favor completa al menos uno de los compromisos antes de guardar',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Guardar en localStorage
             localStorage.setItem(getUserKey(`commitment_${moduleId}`), JSON.stringify(commitmentData));
             
             // Verificar si completó el módulo
             const isModuleComplete = checkModuleCompletion(moduleId);
             
             if (!isModuleComplete) {
                 const hasExercise = localStorage.getItem(getUserKey(`exercise_${moduleId}`)) !== null;
                 
                 Swal.fire({
                     icon: 'success',
                     title: '¡Compromiso Guardado!',
                     html: `
                         <div class="text-center">
                             <div class="text-4xl mb-3">📝</div>
                             <p class="text-gray-600">Tu compromiso ha sido guardado exitosamente.</p>
                             ${getMissingRequirementsHTML(moduleId)}
                             <p class="mt-2 text-sm text-gray-500">Completa todo para finalizar el módulo</p>
                         </div>
                     `,
                     confirmButtonText: 'Continuar',
                     confirmButtonColor: '#4a9fc7'
                 });
             } else {
                 // Módulo completado - La pantalla de celebración ya se mostró en completeChapter()
             Swal.fire({
                 icon: 'success',
                 title: 'Compromiso guardado',
                 text: 'Tu compromiso del Módulo 9: Conmigo Mismo ha sido guardado exitosamente',
                 confirmButtonColor: '#4a9fc7'
             });
             }
             
             // Actualizar contadores siempre
             syncUserProgress();
         } else if (moduleId === 10) {
             // Recopilar datos del Módulo 10: Conclusiones
             const commitmentData = {
                 salud_objetivos: document.getElementById('commitment_10_salud_objetivos').value.trim(),
                 date: new Date().toISOString()
             };
             
             // Validar que el compromiso tenga contenido
             const hasContent = commitmentData.salud_objetivos;
             
             if (!hasContent) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Compromiso vacío',
                     text: 'Por favor completa al menos uno de los compromisos antes de guardar',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Guardar en localStorage
             localStorage.setItem(getUserKey(`commitment_${moduleId}`), JSON.stringify(commitmentData));
             
             // Verificar si completó el módulo
             const isModuleComplete = checkModuleCompletion(moduleId);
             
             if (!isModuleComplete) {
                 const hasExercise = localStorage.getItem(getUserKey(`exercise_${moduleId}`)) !== null;
                 
                 Swal.fire({
                     icon: 'success',
                     title: '¡Compromiso Guardado!',
                     html: `
                         <div class="text-center">
                             <div class="text-4xl mb-3">📝</div>
                             <p class="text-gray-600">Tu compromiso ha sido guardado exitosamente.</p>
                             ${getMissingRequirementsHTML(moduleId)}
                             <p class="mt-2 text-sm text-gray-500">Completa todo para finalizar el módulo</p>
                         </div>
                     `,
                     confirmButtonText: 'Continuar',
                     confirmButtonColor: '#4a9fc7'
                 });
             } else {
                 // Módulo completado - La pantalla de celebración ya se mostró en completeChapter()
             Swal.fire({
                 icon: 'success',
                 title: 'Compromiso guardado',
                 text: 'Tu compromiso del Módulo 10: Conclusiones ha sido guardado exitosamente',
                 confirmButtonColor: '#4a9fc7'
             });
             }
         }
     }
     
     function addCommitmentToCalendar(moduleId) {
         if (moduleId === 1) {
             // Obtener datos guardados
             const savedCommitments = JSON.parse(localStorage.getItem(getUserKey(`commitment_${moduleId}`)) || '{}');
             
             if (!savedCommitments.profesional && !savedCommitments.personal && !savedCommitments.familiar) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Sin compromisos',
                     text: 'Primero debes crear y guardar tus compromisos antes de agregarlos al calendario',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Preparar datos en la estructura que espera el modal existente
             const moduleElements = {};
             let elementIndex = 1;
             
             if (savedCommitments.profesional) {
                 moduleElements[`element${elementIndex}`] = {
                     question: "Aspectos que mejoraré en lo profesional (qué, cuándo, cómo):",
                     answer: savedCommitments.profesional
                 };
                 elementIndex++;
             }
             
             if (savedCommitments.personal) {
                 moduleElements[`element${elementIndex}`] = {
                     question: "Aspectos que mejoraré en lo personal, involucra aspectos tanto físicos como espirituales, (qué, cuándo, cómo):",
                     answer: savedCommitments.personal
                 };
                 elementIndex++;
             }
             
             if (savedCommitments.familiar) {
                 moduleElements[`element${elementIndex}`] = {
                     question: "Aspectos que mejoraré en lo familiar, (qué, cuándo, cómo):",
                     answer: savedCommitments.familiar
                 };
                 elementIndex++;
             }
             
             // Usar la variable global que espera el modal existente
             currentCommitmentData = {
                 chapterId: moduleId,
                 moduleTitle: "El Emprendedor",
                 moduleElements: moduleElements,
                 when: "Según compromisos establecidos",
                 measure: "Evaluación personal continua",
                 date: new Date().toISOString()
             };
             
             // Abrir el modal de calendario existente
             showCalendarModal();
         } else if (moduleId === 2) {
             // Obtener datos guardados del Módulo 2
             const savedCommitments = JSON.parse(localStorage.getItem(getUserKey(`commitment_${moduleId}`)) || '{}');
             
             if (!savedCommitments.vision && !savedCommitments.autocontrol && !savedCommitments.revision) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Sin compromisos',
                     text: 'Primero debes crear y guardar tus compromisos antes de agregarlos al calendario',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Preparar datos en la estructura que espera el modal existente
             const moduleElements = {};
             let elementIndex = 1;
             
             if (savedCommitments.vision) {
                 moduleElements[`element${elementIndex}`] = {
                     question: "Mi visión específica escrita con fechas concretas:",
                     answer: savedCommitments.vision
                 };
                 elementIndex++;
             }
             
             if (savedCommitments.autocontrol) {
                 moduleElements[`element${elementIndex}`] = {
                     question: "Plan para desarrollar autocontrol y libertad interior:",
                     answer: savedCommitments.autocontrol
                 };
                 elementIndex++;
             }
             
             if (savedCommitments.revision) {
                 moduleElements[`element${elementIndex}`] = {
                     question: "Compromiso de revisar y ajustar mi visión regularmente:",
                     answer: savedCommitments.revision
                 };
                 elementIndex++;
             }
             
             // Usar la variable global que espera el modal existente
             currentCommitmentData = {
                 chapterId: moduleId,
                 moduleTitle: "La Visión",
                 moduleElements: moduleElements,
                 when: "Según compromisos de visión establecidos",
                 measure: "Revisión y ajuste continuo de la visión",
                 date: new Date().toISOString()
             };
             
             // Abrir el modal de calendario existente
             showCalendarModal();
         } else if (moduleId === 3) {
             // Obtener datos guardados del Módulo 3
             const savedCommitments = JSON.parse(localStorage.getItem(getUserKey(`commitment_${moduleId}`)) || '{}');
             
             if (!savedCommitments.defecto_virtud && !savedCommitments.regla_oro && !savedCommitments.brujula_moral) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Sin compromisos',
                     text: 'Primero debes crear y guardar tus compromisos antes de agregarlos al calendario',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Preparar datos en la estructura que espera el modal existente
             const moduleElements = {};
             let elementIndex = 1;
             
             if (savedCommitments.defecto_virtud) {
                 moduleElements[`element${elementIndex}`] = {
                     question: "Un defecto específico que transformaré en virtud:",
                     answer: savedCommitments.defecto_virtud
                 };
                 elementIndex++;
             }
             
             if (savedCommitments.regla_oro) {
                 moduleElements[`element${elementIndex}`] = {
                     question: "¿De qué forma practicaré la regla de oro?",
                     answer: savedCommitments.regla_oro
                 };
                 elementIndex++;
             }
             
             if (savedCommitments.brujula_moral) {
                 moduleElements[`element${elementIndex}`] = {
                     question: "Aspectos que mejoraré para mantener mi brújula y hacer lo correcto siempre (qué, cuándo, cómo):",
                     answer: savedCommitments.brujula_moral
                 };
                 elementIndex++;
             }
             
             // Usar la variable global que espera el modal existente
             currentCommitmentData = {
                 chapterId: moduleId,
                 moduleTitle: "En Mi Relación con Dios",
                 moduleElements: moduleElements,
                 when: "Según compromisos espirituales establecidos",
                 measure: "Transformación continua y aplicación de la regla de oro",
                 date: new Date().toISOString()
             };
             
             // Abrir el modal de calendario existente
             showCalendarModal();
         } else if (moduleId === 4) {
             // Obtener datos guardados del Módulo 4
             const savedCommitments = JSON.parse(localStorage.getItem(getUserKey(`commitment_${moduleId}`)) || '{}');
             
             if (!savedCommitments.accion) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Sin compromiso',
                     text: 'Primero debes crear y guardar tu compromiso antes de agregarlo al calendario',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Preparar datos en la estructura que espera el modal existente
             const moduleElements = {
                 element1: {
                     question: "¿Qué me comprometo a hacer como hijo?",
                     answer: savedCommitments.accion
                 }
             };
             
             // Usar la variable global que espera el modal existente
             currentCommitmentData = {
                 chapterId: moduleId,
                 moduleTitle: "El Rol de Hijo",
                 moduleElements: moduleElements,
                 when: "Según compromiso establecido",
                 measure: "Mejora en la relación con mis padres",
                 date: new Date().toISOString()
             };
             
             // Abrir el modal de calendario existente
             showCalendarModal();
         } else if (moduleId === 5) {
             // Obtener datos guardados del Módulo 5
             const savedCommitments = JSON.parse(localStorage.getItem(getUserKey(`commitment_${moduleId}`)) || '{}');
             
             if (!savedCommitments.tiempo_padres && !savedCommitments.acciones_involucrarme && !savedCommitments.plan_recuerdos) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Sin compromiso',
                     text: 'Primero debes crear y guardar tu compromiso antes de agregarlo al calendario',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Preparar datos en la estructura que espera el modal existente
             const moduleElements = {};
             if (savedCommitments.tiempo_padres) {
                 moduleElements.element1 = {
                     question: "Tiempo específico semanal que dedicaré a mis padres:",
                     answer: savedCommitments.tiempo_padres
                 };
             }
             if (savedCommitments.acciones_involucrarme) {
                 moduleElements.element2 = {
                     question: "Acciones concretas para involucrarme más con ellos:",
                     answer: savedCommitments.acciones_involucrarme
                 };
             }
             if (savedCommitments.plan_recuerdos) {
                 moduleElements.element3 = {
                     question: "Plan para crear nuevos recuerdos y tradiciones familiares:",
                     answer: savedCommitments.plan_recuerdos
                 };
             }
             
             // Usar la variable global que espera el modal existente
             currentCommitmentData = {
                 chapterId: moduleId,
                 moduleTitle: "El Rol de Padre",
                 moduleElements: moduleElements,
                 when: "Según compromiso establecido",
                 measure: "Mejora en la relación con mis padres y creación de nuevos recuerdos familiares",
                 date: new Date().toISOString()
             };
             
             // Abrir el modal de calendario existente
             showCalendarModal();
         } else if (moduleId === 6) {
             // Obtener datos guardados del Módulo 6
             const savedCommitments = JSON.parse(localStorage.getItem(getUserKey(`commitment_${moduleId}`)) || '{}');
             
             if (!savedCommitments.plan_mejorar && !savedCommitments.tiempo_semanal && !savedCommitments.acciones_conjunto) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Sin compromiso',
                     text: 'Primero debes crear y guardar tu compromiso antes de agregarlo al calendario',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Preparar datos en la estructura que espera el modal existente
             const moduleElements = {};
             if (savedCommitments.plan_mejorar) {
                 moduleElements.element1 = {
                     question: "Plan específico para mejorar la relación con mi pareja (qué, cuándo, dónde):",
                     answer: savedCommitments.plan_mejorar
                 };
             }
             if (savedCommitments.tiempo_semanal) {
                 moduleElements.element2 = {
                     question: "Tiempo semanal dedicado exclusivamente a la pareja:",
                     answer: savedCommitments.tiempo_semanal
                 };
             }
             if (savedCommitments.acciones_conjunto) {
                 moduleElements.element3 = {
                     question: "Acciones en conjunto que fortalezca la relación conyugal:",
                     answer: savedCommitments.acciones_conjunto
                 };
             }
             
             // Usar la variable global que espera el modal existente
             currentCommitmentData = {
                 chapterId: moduleId,
                 moduleTitle: "El Rol de Pareja",
                 moduleElements: moduleElements,
                 when: "Según compromiso establecido",
                 measure: "Fortalecimiento de la relación de pareja y mejora en la comunicación",
                 date: new Date().toISOString()
             };
             
             // Abrir el modal de calendario existente
             showCalendarModal();
         } else if (moduleId === 7) {
             // Obtener datos guardados del Módulo 7
             const savedCommitments = JSON.parse(localStorage.getItem(getUserKey(`commitment_${moduleId}`)) || '{}');
             
             if (!savedCommitments.plan_amistades) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Sin compromiso',
                     text: 'Primero debes crear un compromiso antes de agregarlo al calendario',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Estructurar datos para el calendario
             let moduleElements = [];
             
             if (savedCommitments.plan_amistades) {
                 moduleElements.push({
                     question: "Plan específico para mantener y fortalecer mis amistades más importantes (qué, cuándo, dónde)",
                     answer: savedCommitments.plan_amistades
                 });
             }
             
             currentCommitmentData = {
                 moduleTitle: "El Rol de Amigo",
                 moduleElements: moduleElements,
                 when: "Según compromiso establecido",
                 measure: "Fortalecimiento y mantenimiento de amistades importantes",
                 date: new Date().toISOString()
             };
             
             // Abrir el modal de calendario existente
             showCalendarModal();
         } else if (moduleId === 8) {
             // Obtener datos guardados del Módulo 8
             const savedCommitments = JSON.parse(localStorage.getItem(getUserKey(`commitment_${moduleId}`)) || '{}');
             
             if (!savedCommitments.meta_profesional && !savedCommitments.plan_accion && !savedCommitments.estrategia) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Sin compromiso',
                     text: 'Primero debes crear un compromiso antes de agregarlo al calendario',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Estructurar datos para el calendario
             let moduleElements = [];
             
             if (savedCommitments.meta_profesional) {
                 moduleElements.push({
                     question: "Considerando lo analizado hasta el momento, ¿Cuál sería tu meta profesional en específico?",
                     answer: savedCommitments.meta_profesional
                 });
             }
             
             if (savedCommitments.plan_accion) {
                 moduleElements.push({
                     question: "Detalla tu plan de acción para lograr la meta que deseas en lo profesional (qué, cuándo, dónde)",
                     answer: savedCommitments.plan_accion
                 });
             }
             
             if (savedCommitments.estrategia) {
                 moduleElements.push({
                     question: "Describe cuál sería tu estrategia para lograr tu objetivo profesional",
                     answer: savedCommitments.estrategia
                 });
             }
             
             currentCommitmentData = {
                 moduleTitle: "El Rol Profesional",
                 moduleElements: moduleElements,
                 when: "Según compromiso establecido",
                 measure: "Logro de metas y objetivos profesionales",
                 date: new Date().toISOString()
             };
             
             // Abrir el modal de calendario existente
             showCalendarModal();
         } else if (moduleId === 9) {
             // Obtener datos guardados del Módulo 9
             const savedCommitments = JSON.parse(localStorage.getItem(getUserKey(`commitment_${moduleId}`)) || '{}');
             
             if (!savedCommitments.contribucion_ciudadana && !savedCommitments.plan_ciudadano && !savedCommitments.mejora_areas) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Sin compromiso',
                     text: 'Primero debes crear un compromiso antes de agregarlo al calendario',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Estructurar datos para el calendario
             let moduleElements = [];
             
             if (savedCommitments.contribucion_ciudadana) {
                 moduleElements.push({
                     question: "Acción específica de contribución ciudadana:",
                     answer: savedCommitments.contribucion_ciudadana
                 });
             }
             
             if (savedCommitments.plan_ciudadano) {
                 moduleElements.push({
                     question: "Plan para involucrarme como ciudadano (qué, cómo, dónde):",
                     answer: savedCommitments.plan_ciudadano
                 });
             }
             
             if (savedCommitments.mejora_areas) {
                 moduleElements.push({
                     question: "Plan de mejora en las 2 áreas más bajas del Círculo de Vida (qué, cuándo, dónde):",
                     answer: savedCommitments.mejora_areas
                 });
             }
             
             currentCommitmentData = {
                 moduleTitle: "Conmigo Mismo",
                 moduleElements: moduleElements,
                 when: "Según compromiso establecido",
                 measure: "Mejora en contribución ciudadana y áreas personales prioritarias",
                 date: new Date().toISOString()
             };
             
             // Abrir el modal de calendario existente
             showCalendarModal();
         } else if (moduleId === 10) {
             // Obtener datos guardados del Módulo 10
             const savedCommitments = JSON.parse(localStorage.getItem(getUserKey(`commitment_${moduleId}`)) || '{}');
             
             if (!savedCommitments.salud_objetivos) {
                 Swal.fire({
                     icon: 'warning',
                     title: 'Sin compromiso',
                     text: 'Primero debes crear un compromiso antes de agregarlo al calendario',
                     confirmButtonColor: '#4a9fc7'
                 });
                 return;
             }
             
             // Estructurar datos para el calendario
             let moduleElements = [];
             
             if (savedCommitments.salud_objetivos) {
                 moduleElements.push({
                     question: "Una vez que tomes conciencia de qué realmente necesitas para cuidar de tu salud integral, puedes comenzar a hacerle frente a las áreas de tu vida que no están en consonancia con tu verdad. Ahora toma acción y crea 5 objetivos pequeños y razonables para que, cada semana, te muevas en la dirección en la que deseas ir para tu salud física, emocional y mental",
                     answer: savedCommitments.salud_objetivos
                 });
             }
             
             currentCommitmentData = {
                 moduleTitle: "Conclusiones",
                 moduleElements: moduleElements,
                 when: "Según compromiso establecido",
                 measure: "Mejora en salud integral y cumplimiento de objetivos semanales",
                 date: new Date().toISOString()
             };
             
             // Abrir el modal de calendario existente
             showCalendarModal();
         }
     }

     // ===== FUNCIONES PARA EL TEST DE CONFIANZA =====
     
     const confidenceTestQuestions = [
         "Mis palabras tienen un efecto notorio sobre los demás.",
         "Cuando hablo, las demás personas me prestan atención casi de inmediato.",
         "Soy conciente de mi lenguaje corporal y mi imagen.",
         "Aunque me cueste trabajo, no me presto a acciones indebidas.",
         "Comprendo la importancia que tiene el dominio de mí mismo y lo practico.",
         "Ejerzo control sobre lo que digo, incluso después de beber algunas copas.",
         "No practico la mentira.",
         "Creo que puedo hacer las cosas mejor.",
         "En mi escala de valores, la honradez tiene un lugar importante.",
         "Si me equivoco, lo reconozco y me disculpo.",
         "La responsabilidad guía cada aspecto de mi vida.",
         "No busco el halago, busco la congruencia.",
         "Coloco el dinero en el lugar adecuado: es útil, pero no lo es todo.",
         "Me esfuerzo cada día y hago mi trabajo con ímpetu.",
         "Conozco mis limitaciones como líder y trato de superarme constantemente."
     ];
     
     let confidenceTestAnswers = {};
     
     function showConfidenceTest() {
         // Cargar respuestas guardadas
         const savedAnswers = JSON.parse(localStorage.getItem(getUserKey('confidenceTest')) || '{}');
         confidenceTestAnswers = { ...savedAnswers };
         
         openModal('Test de Confianza', `
             <div class="max-w-4xl mx-auto">
                 <div class="mb-6">
                     <p class="font-bold text-gray-800 mb-3">Información para el Test para la confianza en sí mismo:</p>
                     <p class="text-gray-600 mb-4">Este test sólo ofrece orientación y carece de valor diagnóstico. Este ejercicio te ayudará a conocer mejor tus capacidades como líder y a identificar los puntos en los que es necesario poner más énfasis, para trabajar en aspectos determinantes de la persona íntegra y de la confianza en sí mismo.</p>
                     <p class="text-gray-600 mb-6"><strong>INSTRUCCIONES:</strong> De cada afirmación, selecciona la opción con la cual te identificas más. Al finalizar contabiliza el total de tu puntuación y ve a la retroalimentación que te corresponda según su resultado.</p>
                 </div>
                 
                 <!-- Tabla de preguntas -->
                 <div class="overflow-x-auto mb-6">
                     <table class="w-full border-collapse border border-gray-300">
                         <thead>
                             <tr class="bg-gray-100">
                                 <th class="border border-gray-300 p-3 text-left font-semibold">Afirmación</th>
                                 <th class="border border-gray-300 p-3 text-center font-semibold w-24">Nunca<br/>(1)</th>
                                 <th class="border border-gray-300 p-3 text-center font-semibold w-24">A veces<br/>(2)</th>
                                 <th class="border border-gray-300 p-3 text-center font-semibold w-24">Siempre<br/>(3)</th>
                             </tr>
                         </thead>
                         <tbody>
                             ${confidenceTestQuestions.map((question, index) => `
                                 <tr class="${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'}">
                                     <td class="border border-gray-300 p-3 text-sm">${question}</td>
                                     <td class="border border-gray-300 p-3 text-center">
                                         <input type="radio" name="question_${index}" value="1" 
                                                onchange="updateConfidenceAnswer(${index}, 1)"
                                                ${confidenceTestAnswers[index] === 1 ? 'checked' : ''}>
                                     </td>
                                     <td class="border border-gray-300 p-3 text-center">
                                         <input type="radio" name="question_${index}" value="2" 
                                                onchange="updateConfidenceAnswer(${index}, 2)"
                                                ${confidenceTestAnswers[index] === 2 ? 'checked' : ''}>
                                     </td>
                                     <td class="border border-gray-300 p-3 text-center">
                                         <input type="radio" name="question_${index}" value="3" 
                                                onchange="updateConfidenceAnswer(${index}, 3)"
                                                ${confidenceTestAnswers[index] === 3 ? 'checked' : ''}>
                                     </td>
                                 </tr>
                             `).join('')}
                         </tbody>
                     </table>
                 </div>
                 
                 <!-- Botón para ver resultados -->
                 <button id="showConfidenceResults" onclick="showConfidenceTestResults()" 
                         class="w-full py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-colors mb-4" 
                         disabled>
                     <i class="fas fa-chart-line mr-2"></i>Ver Resultados del Test
                 </button>
                 
                 <!-- Contenedor para resultados -->
                 <div id="confidenceResultsContainer" class="hidden">
                     <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                         <h3 class="text-xl font-bold text-blue-800 mb-4">Resultados de tu Test de Confianza</h3>
                         <div id="confidenceResultsContent"></div>
                     </div>
                 </div>
             </div>
         `);
         
         // Verificar si puede mostrar resultados
         setTimeout(() => {
             checkConfidenceTestCompletion();
         }, 100);
     }
     
     function updateConfidenceAnswer(questionIndex, value) {
         confidenceTestAnswers[questionIndex] = parseInt(value);
         checkConfidenceTestCompletion();
         
         // Guardar automáticamente
         localStorage.setItem(getUserKey('confidenceTest'), JSON.stringify(confidenceTestAnswers));
     }
     
     function checkConfidenceTestCompletion() {
         const totalQuestions = confidenceTestQuestions.length;
         const answeredQuestions = Object.keys(confidenceTestAnswers).length;
         const showResultsBtn = document.getElementById('showConfidenceResults');
         
         if (showResultsBtn) {
             const isComplete = answeredQuestions === totalQuestions;
             showResultsBtn.disabled = !isComplete;
             showResultsBtn.className = isComplete
                 ? 'w-full py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-colors mb-4'
                 : 'w-full py-3 bg-gray-400 text-gray-600 font-semibold rounded-lg cursor-not-allowed mb-4';
         }
     }
     
     function showConfidenceTestResults() {
         // Calcular puntuación total
         const totalScore = Object.values(confidenceTestAnswers).reduce((sum, value) => sum + value, 0);
         
         // Determinar nivel y mensaje
         let level, title, message;
         
         if (totalScore >= 0 && totalScore <= 15) {
             level = 1;
             title = "NIVEL 1 (0-15) BAJA AUTOESTIMA";
             message = `Aquellas personas que tienen una baja autoestima suelen ser personas que, aunque no se creen inferiores al resto, sí consideran a los demás en una posición más elevada a la suya. Esto supone que, inconscientemente, te sientes en una posición retrasada en relación a los que te rodean a la hora de iniciar o realizar alguna acción.

Tu escala de valores refleja que las conductas esperadas de la personalidad íntegra, que lleva a los otros a confiar en ti, es poco importante, por lo que te recomendamos reconsiderarlas. Lee nuevamente con detenimiento el texto que te hemos ofrecido, revisa tu escala de valores y practica las conductas necesarias para reforzar tu confianza en ti mismo.`;
         } else if (totalScore >= 16 && totalScore <= 30) {
             level = 2;
             title = "NIVEL 2 (16-30) AUTOESTIMA MEDIA";
             message = `Este tipo de personas tienen una buena confianza en sí mismas, pero en ocasiones ésta puede llegar a ceder. Son personas que intentan mantenerse fuertes con respecto a los demás, aunque en su interior están sufriendo. Aquellos que posean esta forma de ser viven de una forma relativamente dependientes de los demás, es decir, si ven que el resto les apoyan en alguna acción su autoestima crecerá, pero, por el contrario, cualquier error que alguien le eche en cara servirá para que su confianza caiga un poco.

Lee nuevamente con detenimiento el texto que te hemos ofrecido, revisa tu escala de valores y practica las conductas necesarias para reforzar tu confianza en ti mismo.`;
         } else if (totalScore >= 31 && totalScore <= 45) {
             level = 3;
             title = "NIVEL 3 (31-45) ALTA AUTOESTIMA";
             message = `Las personas de gran autoestima han nacido para triunfar en todos los aspectos de su vida. Se creen seres poderosos y en posesión de la verdad en todo momento. Son personas a las que resulta muy difícil hacerlas venir en razón y también hundirlas. Su fortaleza mental les convierte en auténticos tanques de difícil destrucción. Todos sus movimientos están calculados previamente con un único objetivo: el éxito.

Aunque, por otro lado, esta forma de actuar no les ayude sus relaciones sociales puesto que dan una imagen de superioridad que producirá en algunas personas un sentimiento de rechazo, por lo que no deben confiarse demasiado, deben cuidar actitudes déspotas y evitar subestimar a los demás.`;
         }
         
         // Mostrar resultados
         const resultsContainer = document.getElementById('confidenceResultsContainer');
         const resultsContent = document.getElementById('confidenceResultsContent');
         
         if (resultsContainer && resultsContent) {
             resultsContent.innerHTML = `
                 <div class="mb-4">
                     <p class="text-lg font-semibold text-gray-800">Tu puntuación total: <span class="text-blue-600">${totalScore} puntos</span></p>
                 </div>
                 <div class="mb-4">
                     <h4 class="text-lg font-bold text-blue-800 mb-2">${title}</h4>
                     <p class="text-gray-700 leading-relaxed">${message.replace(/\n\s*/g, '</p><p class="text-gray-700 leading-relaxed mt-4">')}</p>
                 </div>
             `;
             
             resultsContainer.classList.remove('hidden');
             resultsContainer.scrollIntoView({ behavior: 'smooth' });
         }
         
         // Guardar resultado
         const testResult = {
             score: totalScore,
             level: level,
             answers: confidenceTestAnswers,
             date: new Date().toISOString()
         };
         localStorage.setItem(getUserKey('confidenceTestResult'), JSON.stringify(testResult));
     }

     // ===== FUNCIONES PARA LA RUEDA MOTIVACIONAL =====
     
     function initializeMotivationalWheel() {
         currentSection = 0;
         
         // Cargar datos guardados y sincronizar con motivationalData
         const savedData = JSON.parse(localStorage.getItem(getUserKey('ruedaMotivacional')) || '{}');
         motivationalData = { ...motivationalData, ...savedData };
         
         loadSectionContent();
         updateNavigationButtons();
         updateProgressDots();
         checkGenerateButtonState();
     }
     
     function loadSectionContent() {
         const section = motivationalSections[currentSection];
         const sectionContent = document.getElementById('sectionContent');
         
         const sectionData = motivationalData[section.key] || {};
         
         sectionContent.innerHTML = `
             <div>
                 <h3 class="text-2xl font-bold text-arquitecto-navy mb-6 text-center">${section.name}</h3>
                 <div class="space-y-4">
                     ${section.questions.map((question, index) => `
                         <div class="bg-white p-4 rounded-lg border">
                             <p class="text-gray-800 mb-3">${question}</p>
                             <div class="flex items-center space-x-4">
                                 <label class="text-sm font-medium text-gray-600">Calificación:</label>
                                 <select class="question-rating border-2 border-gray-200 rounded px-3 py-1 focus:border-arquitecto-navy focus:outline-none" 
                                         data-section="${section.key}" data-question="${index}" 
                                         onchange="updateQuestionRating('${section.key}', ${index}, this.value)">
                                     <option value="">Selecciona</option>
                                     ${Array.from({length: 10}, (_, i) => `
                                         <option value="${i+1}" ${(sectionData[index] == i+1) ? 'selected' : ''}>${i+1}</option>
                                     `).join('')}
                                 </select>
                                 <span class="text-sm text-gray-500">(1 = Muy bajo, 10 = Excelente)</span>
                             </div>
                         </div>
                     `).join('')}
                 </div>
             </div>
         `;
     }
     
     function updateQuestionRating(sectionKey, questionIndex, value) {
         if (!motivationalData[sectionKey]) {
             motivationalData[sectionKey] = {};
         }
         motivationalData[sectionKey][questionIndex] = parseInt(value);
         
         updateNavigationButtons();
         checkGenerateButtonState();
     }
     
     function navigateCarousel(direction) {
         const newSection = currentSection + direction;
         
         if (newSection < 0 || newSection >= motivationalSections.length) {
             return;
         }
         
         // Validar que la sección actual esté completa antes de avanzar
         if (direction > 0 && !isSectionComplete(currentSection)) {
             Swal.fire({
                 icon: 'warning',
                 title: 'Sección incompleta',
                 text: 'Por favor completa todas las calificaciones antes de continuar',
                 confirmButtonColor: '#4a9fc7'
             });
             return;
         }
         
         currentSection = newSection;
         loadSectionContent();
         updateNavigationButtons();
         updateProgressDots();
         checkGenerateButtonState();
     }
     
     function isSectionComplete(sectionIndex) {
         const section = motivationalSections[sectionIndex];
         const sectionData = motivationalData[section.key] || {};
         
         for (let i = 0; i < section.questions.length; i++) {
             if (!sectionData[i] || sectionData[i] === '') {
                 return false;
             }
         }
         return true;
     }
     
     function updateNavigationButtons() {
         const prevBtn = document.getElementById('prevBtn');
         const nextBtn = document.getElementById('nextBtn');
         
         prevBtn.disabled = currentSection === 0;
         prevBtn.className = currentSection === 0 
             ? 'px-4 py-2 bg-gray-300 text-gray-500 rounded-lg cursor-not-allowed' 
             : 'px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors';
         
         nextBtn.disabled = currentSection === motivationalSections.length - 1;
         nextBtn.className = currentSection === motivationalSections.length - 1
             ? 'px-4 py-2 bg-gray-300 text-gray-500 rounded-lg cursor-not-allowed'
             : 'px-4 py-2 bg-arquitecto-navy text-white rounded-lg hover:bg-arquitecto-navy-dark transition-colors';
     }
     
     function updateProgressDots() {
         for (let i = 0; i < motivationalSections.length; i++) {
             const dot = document.getElementById(`dot-${i}`);
             if (dot) {
                 dot.className = i === currentSection 
                     ? 'w-3 h-3 rounded-full bg-arquitecto-navy' 
                     : 'w-3 h-3 rounded-full bg-gray-300';
             }
         }
     }
     
     function checkGenerateButtonState() {
         const generateBtn = document.getElementById('generateWheelBtn');
         let allComplete = true;
         
         for (let i = 0; i < motivationalSections.length; i++) {
             if (!isSectionComplete(i)) {
                 allComplete = false;
                 break;
             }
         }
         
         generateBtn.disabled = !allComplete;
         generateBtn.className = allComplete
             ? 'w-full py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-colors mb-4'
             : 'w-full py-3 bg-gray-400 text-gray-600 font-semibold rounded-lg cursor-not-allowed mb-4';
     }
     
     function generateMotivationalWheel() {
         // Calcular promedios de cada sección
         const averages = [];
         const labels = [];
         
         motivationalSections.forEach(section => {
             const sectionData = motivationalData[section.key];
             const values = Object.values(sectionData);
             const average = values.reduce((sum, val) => sum + val, 0) / values.length;
             averages.push(Math.round(average * 10) / 10);
             labels.push(section.name);
         });
         
         // Mostrar la gráfica
         const wheelContainer = document.getElementById('wheelChartContainer');
         wheelContainer.classList.remove('hidden');
         
         // Crear la gráfica
         setTimeout(() => {
             createMotivationalWheelChart(labels, averages);
         }, 100);
         
         // Scroll hacia la gráfica
         wheelContainer.scrollIntoView({ behavior: 'smooth' });
     }
     
     function createMotivationalWheelChart(labels, data) {
         const ctx = document.getElementById('motivationalWheelChart');
         if (!ctx) return;
         
         // Destruir gráfico anterior si existe
         if (motivationalWheelChart) {
             motivationalWheelChart.destroy();
         }
         
         motivationalWheelChart = new Chart(ctx, {
             type: 'radar',
             data: {
                 labels: labels,
                 datasets: [{
                     label: 'Rueda Motivacional',
                     data: data,
                     backgroundColor: 'rgba(74, 159, 199, 0.2)',
                     borderColor: 'rgba(74, 159, 199, 1)',
                     borderWidth: 2,
                     pointBackgroundColor: 'rgba(74, 159, 199, 1)',
                     pointBorderColor: '#fff',
                     pointHoverBackgroundColor: '#fff',
                     pointHoverBorderColor: 'rgba(74, 159, 199, 1)'
                 }]
             },
             options: {
                 responsive: true,
                 plugins: {
                     legend: {
                         display: false
                     }
                 },
                 scales: {
                     r: {
                         angleLines: {
                             display: true
                         },
                         suggestedMin: 0,
                         suggestedMax: 10,
                         ticks: {
                             stepSize: 2
                         }
                     }
                 }
             }
         });
     }
     
     function saveMotivationalWheel() {
         localStorage.setItem(getUserKey('ruedaMotivacional'), JSON.stringify(motivationalData));
         
         Swal.fire({
             icon: 'success',
             title: 'Rueda Motivacional guardada',
             text: 'Tu rueda motivacional ha sido guardada exitosamente',
             confirmButtonColor: '#4a9fc7'
         });
         
         closeModal();
     }
     
     function exportWheelToPDF() {
         const canvas = document.getElementById('motivationalWheelChart');
         if (!canvas || !motivationalWheelChart) {
             Swal.fire({
                 icon: 'error',
                 title: 'Error',
                 text: 'No se pudo encontrar la gráfica para exportar',
                 confirmButtonColor: '#4a9fc7'
             });
             return;
         }
         
         // Crear nuevo PDF
         const { jsPDF } = window.jspdf;
         const pdf = new jsPDF();
         
         // Título del PDF
         pdf.setFontSize(20);
         pdf.setTextColor(17, 121, 180); // Color arquitecto-navy
         pdf.text('Rueda Motivacional', 105, 20, { align: 'center' });
         
         // Información del PDF
         pdf.setFontSize(12);
         pdf.setTextColor(0, 0, 0);
         pdf.text(`Fecha: ${new Date().toLocaleDateString('es-ES')}`, 20, 35);
         
         // Convertir canvas a imagen
         const imgData = canvas.toDataURL('image/png');
         
         // Agregar la gráfica al PDF
         pdf.addImage(imgData, 'PNG', 20, 50, 170, 120);
         
         // Agregar tabla de calificaciones
         pdf.setFontSize(14);
         pdf.setTextColor(17, 121, 180);
         pdf.text('Calificaciones por Área:', 20, 185);
         
         let yPos = 195;
         pdf.setFontSize(10);
         pdf.setTextColor(0, 0, 0);
         
         motivationalSections.forEach(section => {
             const sectionData = motivationalData[section.key];
             if (sectionData) {
                 const values = Object.values(sectionData);
                 const average = values.reduce((sum, val) => sum + val, 0) / values.length;
                 
                 pdf.text(`${section.name}:`, 20, yPos);
                 pdf.text(`Promedio: ${Math.round(average * 10) / 10}/10`, 80, yPos);
                 pdf.text(`Calificaciones: [${values.join(', ')}]`, 130, yPos);
                 yPos += 8;
             }
         });
         
         // Pie de página
         pdf.setFontSize(8);
         pdf.setTextColor(128, 128, 128);
         pdf.text('Arquitecto de tu Destino 2025 - Rueda Motivacional', 105, 280, { align: 'center' });
         
         // Descargar el PDF
         pdf.save(`Rueda_Motivacional_${new Date().toISOString().split('T')[0]}.pdf`);
         
         // Mostrar confirmación
         Swal.fire({
             icon: 'success',
             title: 'PDF Generado',
             text: 'Tu Rueda Motivacional ha sido descargada como PDF',
             confirmButtonColor: '#4a9fc7'
         });
     }



     // Actualizar rueda de vida en tiempo real
     function updateLifeWheelRealTime(index, value) {
         // Actualizar el valor visual
         const valueSpan = document.getElementById(`value-${index}`);
         if (valueSpan) {
             valueSpan.textContent = value;
         }
         
         // Obtener todos los valores actuales
         const ranges = document.querySelectorAll('.life-wheel-slider');
         const values = Array.from(ranges).map(r => parseInt(r.value));
         
         // Actualizar gráfico si existe
         if (lifeWheelChart) {
             lifeWheelChart.data.datasets[0].data = values;
             lifeWheelChart.update('none'); // Actualización sin animación para suavidad
         }
         
         // Guardar automáticamente en localStorage
        localStorage.setItem(getUserKey('arquitectoLifeWheel'), JSON.stringify(values));
         
         // Guardar también con timestamp para historial
         const lifeWheelData = {
             values: values,
             lastUpdated: new Date().toISOString(),
             areas: {
                 hijo: values[0],
                 padre: values[1],
                 pareja: values[2],
                 amigo: values[3],
                 profesional: values[4],
                 ciudadano: values[5],
                 salud: values[6],
                 espiritualidad: values[7]
             }
         };
         localStorage.setItem(getUserKey('arquitectoLifeWheelData'), JSON.stringify(lifeWheelData));
     }
     
     function updateLifeWheel() {
         const ranges = document.querySelectorAll('.life-wheel-slider');
         const values = Array.from(ranges).map(r => parseInt(r.value));
         
         // Guardar valores
         localStorage.setItem('arquitectoLifeWheel', JSON.stringify(values));
         
         // Guardar datos completos
         const lifeWheelData = {
             values: values,
             lastUpdated: new Date().toISOString(),
             areas: {
                 hijo: values[0],
                 padre: values[1],
                 pareja: values[2],
                 amigo: values[3],
                 profesional: values[4],
                 ciudadano: values[5],
                 salud: values[6],
                 espiritualidad: values[7]
             }
         };
         localStorage.setItem(getUserKey('arquitectoLifeWheelData'), JSON.stringify(lifeWheelData));
         
         Swal.fire({
             icon: 'success',
             title: 'Rueda actualizada',
             text: 'Tu balance de vida ha sido actualizado y guardado',
             confirmButtonColor: '#4a9fc7',
             timer: 2000,
             timerProgressBar: true
         });
     }

    // Función auxiliar para obtener los requisitos faltantes de un módulo
    function getMissingRequirements(moduleId) {
        const chapter = chapters.find(c => c.id === moduleId);
        if (!chapter) return [];
        
        const missing = [];
        
        // Verificar videos
        const allVideosCompleted = chapter.video.videos.every(v => v.status === 'completed');
        if (!allVideosCompleted) {
            const completedCount = chapter.video.videos.filter(v => v.status === 'completed').length;
            const totalCount = chapter.video.videos.length;
            missing.push(`Ver todos los videos (${completedCount}/${totalCount} completados)`);
        }
        
        // Verificar ejercicio
        const hasExercise = localStorage.getItem(getUserKey(`exercise_${moduleId}`)) !== null;
        if (!hasExercise) {
            missing.push('Completar el ejercicio del módulo');
        }
        
        // Verificar compromiso
        const hasCommitment = localStorage.getItem(getUserKey(`commitment_${moduleId}`)) !== null;
        if (!hasCommitment) {
            missing.push('Crear compromiso del módulo');
        }
        
        return missing;
    }
    
    // Función para generar HTML de requisitos faltantes
    function getMissingRequirementsHTML(moduleId) {
        const missing = getMissingRequirements(moduleId);
        
        if (missing.length === 0) return '';
        
        return `
            <div class="mt-4 text-left bg-orange-50 border border-orange-200 rounded-lg p-3">
                <p class="font-semibold text-orange-700 mb-2">⚠️ Aún falta para completar el módulo:</p>
                <ul class="space-y-1 text-sm text-orange-600">
                    ${missing.map(item => `<li class="flex items-center"><i class="fas fa-circle text-xs mr-2"></i>${item}</li>`).join('')}
                </ul>
            </div>
        `;
    }

    // Nueva función de verificación de completado de módulos
    function checkModuleCompletion(moduleId) {
        console.log(`🔍 Verificando completado del módulo ${moduleId}`);
        
        const chapter = chapters.find(c => c.id === moduleId);
        if (!chapter) {
            console.log(`❌ Capítulo ${moduleId} no encontrado`);
            return false;
        }
        
        // ✅ Requisito 1: TODOS los videos completados
        const allVideosCompleted = chapter.video.videos.every(v => v.status === 'completed');
        console.log(`🎬 Videos módulo ${moduleId}: ${allVideosCompleted ? 'TODOS completados' : 'Faltan videos'}`);
        
        // ✅ Requisito 2: Ejercicio guardado
        const hasModuleExercise = localStorage.getItem(getUserKey(`exercise_${moduleId}`)) !== null;
        console.log(`📚 Ejercicio módulo ${moduleId}: ${hasModuleExercise ? 'SÍ' : 'NO'}`);
        
        // ✅ Requisito 3: Compromiso guardado
        const hasModuleCommitment = localStorage.getItem(getUserKey(`commitment_${moduleId}`)) !== null;
        console.log(`📝 Compromiso módulo ${moduleId}: ${hasModuleCommitment ? 'SÍ' : 'NO'}`);
        
        // CRITERIO FINAL: Los 3 requisitos deben estar completados
        if (allVideosCompleted && hasModuleExercise && hasModuleCommitment) {
            console.log(`🎉 ¡Módulo ${moduleId} COMPLETADO! Los 3 requisitos cumplidos. Llamando a completeChapter()`);
            completeChapter(moduleId);
            return true;
        }
        
        console.log(`⚠️ Módulo ${moduleId} AÚN NO completado - Faltan requisitos`);
        return false;
     }
     
     // Función auxiliar para obtener los requisitos faltantes de un módulo
     function getMissingRequirements(moduleId) {
        const chapter = chapters.find(c => c.id === moduleId);
        if (!chapter) return [];
        
        const missing = [];
        
        // Verificar videos
        const allVideosCompleted = chapter.video.videos.every(v => v.status === 'completed');
        if (!allVideosCompleted) {
            const completedCount = chapter.video.videos.filter(v => v.status === 'completed').length;
            const totalCount = chapter.video.videos.length;
            missing.push(`Ver todos los videos (${completedCount}/${totalCount} completados)`);
        }
        
        // Verificar ejercicio
        const hasExercise = localStorage.getItem(getUserKey(`exercise_${moduleId}`)) !== null;
        if (!hasExercise) {
            missing.push('Completar el ejercicio del módulo');
        }
        
        // Verificar compromiso
        const hasCommitment = localStorage.getItem(getUserKey(`commitment_${moduleId}`)) !== null;
        if (!hasCommitment) {
            missing.push('Crear compromiso del módulo');
        }
        
        return missing;
     }
     
     // Función para generar HTML de requisitos faltantes
     function getMissingRequirementsHTML(moduleId) {
        const missing = getMissingRequirements(moduleId);
        if (missing.length === 0) return '';
        
        return `
            <div class="mt-4 text-left bg-orange-50 border border-orange-200 rounded-lg p-3">
                <p class="font-semibold text-orange-700 mb-2">⚠️ Aún falta:</p>
                <ul class="space-y-1 text-sm text-orange-600">
                    ${missing.map(item => `<li>• ${item}</li>`).join('')}
                </ul>
            </div>
        `;
     }

     function checkChapterCompletion(chapterId) {
         // Verificar si se completaron todos los elementos del capítulo
         const exercises = JSON.parse(localStorage.getItem(getUserKey('arquitectoExercises')) || '[]');
         const reflections = JSON.parse(localStorage.getItem(getUserKey('arquitectoReflections')) || '[]');
         const commitments = JSON.parse(localStorage.getItem(getUserKey('arquitectoCommitments')) || '[]');
         
         const hasExercise = exercises.some(e => e.chapterId === chapterId);
         const hasReflection = reflections.some(r => r.chapterId === chapterId);
         const hasCommitment = commitments.some(c => c.chapterId === chapterId);
         
         if (hasExercise && hasReflection && hasCommitment) {
             completeChapter(chapterId);
         }
     }

     function completeChapter(chapterId) {
         const chapter = chapters.find(c => c.id === chapterId);
         if (chapter.status === 'completed') return;
         
         chapter.status = 'completed';
         currentUser.completedChapters.push(chapterId);
         
         // Actualizar currentChapter al siguiente módulo
         currentUser.currentChapter = Math.min(chapterId + 1, chapters.length);
         
                 // Desbloquear siguiente módulo
        if (chapterId < chapters.length) {
             const nextChapter = chapters.find(c => c.id === chapterId + 1);
             if (nextChapter) {
                 nextChapter.status = 'available';
             }
         }
         
         // VERIFICAR SI COMPLETÓ TODO EL CURSO
         if (currentUser.completedChapters.length === chapters.length) {
             // Mostrar pantalla de curso completado
             setTimeout(() => {
                 Swal.fire({
                     icon: 'success',
                     title: '🎓 ¡CURSO COMPLETADO!',
                     html: `
                         <div class="text-center">
                             <div class="text-8xl mb-6">🏆</div>
                             <h2 class="text-2xl font-bold text-arquitecto-navy mb-4">¡Felicidades!</h2>
                             <p class="text-gray-600 mb-4">Has completado exitosamente</p>
                             <h3 class="text-xl font-bold text-arquitecto-blue mb-6">ARQUITECTO DE TU DESTINO</h3>
                             <p class="text-sm text-gray-600">
                                 Has transformado tu vida completando los 10 módulos del programa.
                                 ¡Ahora eres el arquitecto de tu propio destino!
                             </p>
                         </div>
                     `,
                     confirmButtonText: '¡Celebrar mi logro!',
                     confirmButtonColor: '#4a9fc7',
                     allowOutsideClick: false
                 });
             }, 2000); // Mostrar después de la celebración del módulo
         }
         
         // Actualizar estadísticas con IDs correctos
         syncUserProgress();
         
         // AGREGAR DELAY PARA EVITAR CONFLICTOS CON SWEETALERT ANTERIOR
         setTimeout(() => {
                         // Mostrar celebración
                Swal.fire({
                    icon: 'success',
                    title: '¡Módulo Completado!',
                    html: `
                        <div class="text-center">
                            <div class="text-6xl mb-4">🎉</div>
                            <p class="text-gray-600">Has completado exitosamente el</p>
                            <h3 class="text-xl font-bold text-arquitecto-navy mt-2">Módulo ${chapter.id}: ${chapter.title}</h3>
                            <p class="mt-4 text-gray-600">
                                Recuerda: invierte 5 minutos en celebrar este logro antes de continuar
                            </p>
                        </div>
                    `,
                            confirmButtonText: 'Continuar mi viaje',
                   confirmButtonColor: '#4a9fc7'
               }).then(() => {
                   renderChapters();
                   // ACTUALIZAR VISUALIZACIÓN DE MÓDULOS
                   updateModulesVisualState();
               });
         }, 500); // Delay de 500ms para evitar conflictos
         
         // Guardar estado actualizado
         localStorage.setItem(getUserKey('arquitectoUser'), JSON.stringify(currentUser));
         
         // Sincronizar todos los datos
         syncUserProgress();
         
         // Sincronizar estados de capítulos
         syncChapterStates();
         
         // Actualizar próxima meta
         updateNextGoal();
     }

     // Actualizar frase del día
     function updateDailyQuote() {
         const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
         document.getElementById('dailyQuote').textContent = randomQuote;
     }

         // Atajos de teclado
    document.addEventListener('keydown', (e) => {
        // Ctrl/Cmd + V para ver la visión
         if ((e.ctrlKey || e.metaKey) && e.key === 'v') {
             e.preventDefault();
             if (document.getElementById('dashboard').style.display !== 'none') {
                 showVision();
             }
         }
         
         // ESC para cerrar modal
         if (e.key === 'Escape') {
             closeModal();
         }
     });

     // Auto-guardar progreso
     function autoSave() {
         const userData = {
             ...currentUser,
             lastAccess: new Date().toISOString()
         };
        localStorage.setItem(getUserKey('arquitectoUser'), JSON.stringify(userData));
        
        // Sincronizar todos los datos
        syncUserProgress();
    }
    
    // Función para contar TODOS los ejercicios (genéricos + específicos de módulos)
    function countAllExercises() {
        let totalExercises = 0;
        
        // Ejercicios genéricos del sistema antiguo
        const genericExercises = JSON.parse(localStorage.getItem(getUserKey('arquitectoExercises')) || '[]');
        totalExercises += genericExercises.length;
        
        // Ejercicios específicos de módulos (1-10)
        for (let i = 1; i <= 10; i++) {
            const moduleExercise = localStorage.getItem(getUserKey(`exercise_${i}`));
            if (moduleExercise) totalExercises++;
        }
        
        return totalExercises;
    }
    
    // Sincronizar todos los datos del usuario
    function syncUserProgress() {
        // Contar ejercicios reales (todos los tipos)
        const totalExercises = countAllExercises();
        currentUser.exercises = totalExercises;
        
        // Calcular progreso real basado en módulos completados (10 módulos = 100%)
        const progress = Math.round((currentUser.completedChapters.length / 10) * 100);
        
        // ACTUALIZAR IDS CORRECTOS del dashboard "Inicio de tu viaje"
        const completedModulesEl = document.getElementById('completedModulesCount');
        const exercisesCountEl = document.getElementById('exercisesCompletedCount');
        const progressPercentEl = document.getElementById('globalProgressPercent');
        const progressBarEl = document.getElementById('globalProgressBar');
        
        if (completedModulesEl) completedModulesEl.textContent = currentUser.completedChapters.length;
        if (exercisesCountEl) exercisesCountEl.textContent = totalExercises;
        if (progressPercentEl) progressPercentEl.textContent = progress + '%';
        if (progressBarEl) progressBarEl.style.width = progress + '%';
        
        // Actualizar también IDs del dashboard viejo (por compatibilidad)
        const oldCompletedEl = document.getElementById('completedChapters');
        const oldExercisesEl = document.getElementById('exercisesDone');
        const oldProgressEl = document.getElementById('progressPercent');
        const oldProgressFillEl = document.querySelector('.progress-fill');
        
        if (oldCompletedEl) oldCompletedEl.textContent = currentUser.completedChapters.length;
        if (oldExercisesEl) oldExercisesEl.textContent = totalExercises;
        if (oldProgressEl) oldProgressEl.textContent = progress + '%';
        if (oldProgressFillEl) oldProgressFillEl.style.width = progress + '%';
        
        // Guardar estado sincronizado
        localStorage.setItem(getUserKey('arquitectoUser'), JSON.stringify(currentUser));
     }

     // Guardar cada 30 segundos
     setInterval(autoSave, 30000);

     // Actualizar indicadores de rango en tiempo real
     document.addEventListener('input', (e) => {
         if (e.target.type === 'range') {
             const value = e.target.value;
             const span = e.target.nextElementSibling;
             if (span && span.tagName === 'SPAN') {
                 span.textContent = value;
             }
         }
     });

         // Función de cerrar sesión
    function logout() {
        Swal.fire({
            title: '¿Cerrar sesión?',
            text: 'Tu progreso se guardará automáticamente',
            icon: 'question',
            showCancelButton: true,
            confirmButtonColor: '#1a2f4a',
            cancelButtonColor: '#6c757d',
            confirmButtonText: 'Sí, salir',
            cancelButtonText: 'Cancelar'
        }).then((result) => {
            if (result.isConfirmed) {
                // Marcar que el usuario cerró sesión intencionalmente
                localStorage.setItem('arquitectoLoggedOut', 'true');
                
                // NUEVA FUNCIONALIDAD: Resetear todos los formularios
                resetAllForms();
                
                // Usar la función showLoginScreen para manejar correctamente todas las secciones
                showLoginScreen();
                
                // Mostrar mensaje de despedida
                Swal.fire({
                    icon: 'success',
                    title: 'Sesión cerrada',
                    text: '¡Hasta pronto! Tu progreso ha sido guardado',
                    confirmButtonColor: '#1a2f4a',
                    timer: 2000,
                    timerProgressBar: true
                });
            }
        });
    }

    // NUEVA FUNCIÓN: Resetear todos los formularios al hacer logout
    function resetAllForms() {
        // Resetear formulario de registro
        document.getElementById('userName').value = '';
        document.getElementById('userEmail').value = '';
        document.getElementById('userPassword').value = '';
        
        // Resetear radio buttons de motivación (dejar "transformacion" como default)
        const motivationRadios = document.querySelectorAll('input[name="motivation"]');
        motivationRadios.forEach(radio => {
            if (radio.value === 'transformacion') {
                radio.checked = true;
            } else {
                radio.checked = false;
            }
        });
        
        // Resetear formulario de login
        document.getElementById('loginEmail').value = '';
        document.getElementById('loginPassword').value = '';
        
        // Asegurar que se muestre el contenido de bienvenida inicial
        showWelcomeContent();
    }

    // NUEVA FUNCIÓN: Mostrar contenido de bienvenida inicial
    function showWelcomeContent() {
        const registerForm = document.getElementById('registerForm');
        const loginForm = document.getElementById('loginForm');
        const welcomeContent = document.getElementById('welcomeContent');
        
        // Ocultar formularios
        registerForm.style.display = 'none';
        registerForm.classList.add('hidden');
        loginForm.style.display = 'none';
        loginForm.classList.add('hidden');
        
        // Mostrar contenido de bienvenida
        welcomeContent.style.display = 'flex';
        welcomeContent.classList.remove('hidden');
    }

    // Verificar estado de sesión al cargar
    function checkSessionState() {
        // No podemos verificar usuario específico sin email, así que verificamos si hay algún usuario
        const loggedOut = localStorage.getItem('arquitectoLoggedOut');
        
        // Si el usuario cerró sesión intencionalmente, mostrar login
        if (loggedOut === 'true') {
            showLoginScreen();
            return false;
        }
        
        // Si no cerró sesión intencionalmente, buscar último usuario activo
        if (!loggedOut) {
            // Buscar el último usuario que hizo login (simplificado)
            const lastUserEmail = localStorage.getItem('lastActiveUser');
            if (lastUserEmail) {
                const savedUser = localStorage.getItem(getUserKey('arquitectoUser', lastUserEmail));
        if (savedUser) {
            currentUser = JSON.parse(savedUser);
                    // Actualizar datos del usuario en la interfaz
                    updateUserInterface();
                    // Cargar estado de videos
                    loadVideoState();
                    // RESETEAR ESTADOS VISUALES AL RESTAURAR SESIÓN
                    resetStatesForNewUser();
            showDashboard();
            return true;
                }
            }
        }
        
        // Si no hay datos, mostrar login
        showLoginScreen();
        return false;
    }
    
    // NUEVA FUNCIÓN: Mostrar pantalla de login
    function showLoginScreen() {
        // Ocultar todas las secciones principales usando style.display consistentemente
        const inicioSection = document.getElementById('inicioSection');
        const viajeSection = document.getElementById('viajeSection');
        const welcomeScreen = document.getElementById('welcomeScreen');
        const dashboard = document.getElementById('dashboard');
        
        // Ocultar todas las secciones
        if (inicioSection) inicioSection.style.display = 'none';
        if (viajeSection) viajeSection.style.display = 'none';
        if (dashboard) dashboard.style.display = 'none';
        
        // Mostrar solo la pantalla de login
        if (welcomeScreen) {
            welcomeScreen.style.display = 'flex';
        }
    }
    
    // NUEVA FUNCIÓN: Actualizar interfaz de usuario
    function updateUserInterface() {
        // Actualizar nombre y email en el menú desplegable (sección inicio)
        const userNameDisplay = document.getElementById('userNameDisplay');
        const userEmailDisplay = document.getElementById('userEmailDisplay');
        
        if (userNameDisplay && currentUser.name) {
            userNameDisplay.textContent = currentUser.name;
        }
        if (userEmailDisplay && currentUser.email) {
            userEmailDisplay.textContent = currentUser.email;
        }

        // Actualizar nombre y email en el menú desplegable (sección viaje)
        const userNameDisplayViaje = document.getElementById('userNameDisplayViaje');
        const userEmailDisplayViaje = document.getElementById('userEmailDisplayViaje');
        
        if (userNameDisplayViaje && currentUser.name) {
            userNameDisplayViaje.textContent = currentUser.name;
        }
        if (userEmailDisplayViaje && currentUser.email) {
            userEmailDisplayViaje.textContent = currentUser.email;
        }
        
        // Actualizar iniciales en el avatar
        const userAvatars = document.querySelectorAll('#userMenuButton, #mobileUserMenuButton, .user-avatar');
        userAvatars.forEach(avatar => {
            if (currentUser.name) {
                const initials = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
                avatar.textContent = initials;
            }
        });
    }

    // Cargar datos al iniciar
    window.addEventListener('load', () => {
        // Verificar estado de sesión primero
        if (!checkSessionState()) {
            return; // Si no hay sesión válida, no continuar
        }
        
        // Cargar estado de videos
        loadVideoState();
         
                 // Recordatorios removidos por solicitud del usuario
         
         // Mostrar tip de bienvenida
         if (!localStorage.getItem(getUserKey('arquitectoTipShown'))) {
             setTimeout(() => {
                 Swal.fire({
                     title: 'Tip del Arquitecto',
                     html: `
                         <p class="mb-4">Usa estos atajos de teclado:</p>
                         <ul class="text-left space-y-2">
                             <li><kbd class="px-2 py-1 bg-gray-200 rounded">Ctrl+J</kbd> - Abrir diario</li>
                             <li><kbd class="px-2 py-1 bg-gray-200 rounded">Ctrl+V</kbd> - Ver tu visión</li>
                             <li><kbd class="px-2 py-1 bg-gray-200 rounded">ESC</kbd> - Cerrar ventanas</li>
                         </ul>
                     `,
                     icon: 'info',
                     confirmButtonColor: '#4a9fc7'
                 });
                 localStorage.setItem(getUserKey('arquitectoTipShown'), 'true');
             }, 3000);
         }
     });

     // Exportar datos del usuario
     function exportUserData() {
         const allData = {
             user: currentUser,
             exercises: JSON.parse(localStorage.getItem(getUserKey('arquitectoExercises')) || '[]'),
             reflections: JSON.parse(localStorage.getItem(getUserKey('arquitectoReflections')) || '[]'),
             commitments: JSON.parse(localStorage.getItem(getUserKey('arquitectoCommitments')) || '[]'),
             journal: JSON.parse(localStorage.getItem(getUserKey('arquitectoJournal')) || '[]'),
             vision: JSON.parse(localStorage.getItem(getUserKey('arquitectoVision')) || '{}'),
             lifeWheel: JSON.parse(localStorage.getItem(getUserKey('arquitectoLifeWheel')) || '[]'),
             videoState: JSON.parse(localStorage.getItem(getUserKey('arquitectoVideoState')) || '{}')
         };
         
         const dataStr = JSON.stringify(allData, null, 2);
         const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
         
         const exportFileDefaultName = `arquitecto_${currentUser.name.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.json`;
         
         const linkElement = document.createElement('a');
         linkElement.setAttribute('href', dataUri);
         linkElement.setAttribute('download', exportFileDefaultName);
         linkElement.click();
     }

     // Sistema de gamificación
     function checkAchievements() {
                 const achievements = [];
                 
         if (currentUser.completedChapters.length >= 6) {
             achievements.push({ name: 'Mitad del Camino', icon: '🎯' });
         }
         if (currentUser.exercises >= 20) {
             achievements.push({ name: 'Practicante Dedicado', icon: '💪' });
         }
         
         return achievements;
     }

     // Compartir progreso
     function shareProgress() {
         const shareData = {
             title: 'Mi progreso en Arquitecto de tu Destino',
             text: `He completado ${currentUser.completedChapters.length} capítulos en mi viaje de transformación personal.`,
             url: window.location.href
         };
         
         if (navigator.share) {
             navigator.share(shareData);
         } else {
             // Fallback: copiar al portapapeles
             navigator.clipboard.writeText(shareData.text);
             Swal.fire({
                 icon: 'success',
                 title: 'Texto copiado',
                 text: 'Tu progreso ha sido copiado al portapapeles',
                 confirmButtonColor: '#4a9fc7'
             });
         }
     }

         // === FUNCIONES DE VIDEO ===
    
    // Estado global de videos
    let currentModuleVideos = {};
    
    // Obtener video actual de un módulo
    function getCurrentVideo(moduleId) {
        const chapter = chapters.find(c => c.id === moduleId);
        if (!chapter || !chapter.video.videos) return null;
        
        const currentIndex = currentModuleVideos[moduleId] || 0;
        return chapter.video.videos[currentIndex];
    }
    
    // Obtener índice del video actual
    function getCurrentVideoIndex(moduleId) {
        return currentModuleVideos[moduleId] || 0;
    }
    
    // Calcular progreso de videos del módulo
    function getModuleVideoProgress(chapter) {
        if (!chapter.video.videos) return 0;
        
        const completedVideos = chapter.video.videos.filter(v => v.status === 'completed').length;
        return Math.round((completedVideos / chapter.video.videos.length) * 100);
    }
    
    // Seleccionar un video específico
    function selectVideo(moduleId, videoIndex) {
        console.log(`🎯 Intentando seleccionar video ${videoIndex + 1} del módulo ${moduleId}`);
        
        const chapter = chapters.find(c => c.id === moduleId);
        if (!chapter || !chapter.video.videos[videoIndex]) {
            console.log('❌ Capítulo o video no encontrado');
            return;
        }
        
        const video = chapter.video.videos[videoIndex];
        console.log(`📹 Estado del video: ${video.status} - ${video.title}`);
        
        if (video.status === 'locked') {
            console.log('🔒 Video bloqueado, mostrando mensaje');
            Swal.fire({
                icon: 'info',
                title: 'Video Bloqueado',
                text: 'Debes completar el video anterior para desbloquear este contenido',
                confirmButtonColor: '#4a9fc7'
            });
            return;
        }
        
        currentModuleVideos[moduleId] = videoIndex;
        console.log(`✅ Video seleccionado: ${video.title}`);
        
        // Actualizar estado del video a "in-progress" si es "available"
        if (video.status === 'available') {
            video.status = 'in-progress';
            console.log(`🟡 Cambiando estado a "in-progress"`);
        }
        
        // Destruir player anterior si existe para este módulo
        if (window.vimeoPlayers && window.vimeoPlayers[moduleId]) {
            try {
                window.vimeoPlayers[moduleId].destroy();
                console.log('🗑️ Player Vimeo anterior destruido');
            } catch (e) {
                console.log('⚠️ Error al destruir player anterior:', e);
            }
        }
        
        // Detectar si estamos en el modal o en la vista principal
        const modalContent = document.getElementById('moduleTabContent');
        const mainTabContent = document.getElementById('tabContent');
        
        if (modalContent && !mainTabContent) {
            // Estamos en el modal
            console.log('🔄 Actualizando interfaz del modal');
            showModuleTab('video', moduleId);
        } else if (mainTabContent) {
            // Estamos en la vista principal
            console.log('🔄 Actualizando interfaz principal');
            showTab('video', moduleId);
        }
        
        // Inicializar Vimeo Player después de actualizar el DOM
        setTimeout(() => {
            initializeVimeoPlayer(moduleId, video);
        }, 100);
        
        // Guardar estado
        saveVideoState();
    }
    
    // Inicializar reproductor de Vimeo
    function initializeVimeoPlayer(moduleId, video) {
        console.log(`🎬 Inicializando Vimeo Player para módulo ${moduleId}`);
        
        // Inicializar contenedor de Vimeo Players si no existe
        if (!window.vimeoPlayers) {
            window.vimeoPlayers = {};
        }
        
        // Buscar el contenedor
        const container = document.getElementById(`vimeoPlayerContainer-${moduleId}`);
        if (!container) {
            console.log('⚠️ Contenedor de Vimeo no encontrado');
            return;
        }
        
        try {
            console.log(`🎥 Creando player con Vimeo ID: ${video.vimeoId}`);
            
            const player = new Vimeo.Player(container, {
                id: video.vimeoId,
                width: '100%',
                responsive: true
            });
            
            // Guardar referencia del player
            window.vimeoPlayers[moduleId] = player;
            
            // Escuchar cuando el video termina (CLAVE PARA DESBLOQUEO)
            player.on('ended', function() {
                console.log('🎬 Evento "ended" disparado por Vimeo');
                onVideoEnded(moduleId);
            });
            
            // Escuchar cuando carga correctamente
            player.on('loaded', function() {
                console.log('✅ Video Vimeo cargado correctamente');
                onVideoLoaded(moduleId);
            });
            
            // Manejar errores
            player.on('error', function(error) {
                console.error('❌ Error en Vimeo Player:', error);
                onVideoError(moduleId);
            });
            
            console.log('✅ Vimeo Player inicializado correctamente');
            
        } catch (error) {
            console.error('❌ Error al crear Vimeo Player:', error);
            onVideoError(moduleId);
        }
    }
    
    // Navegar entre videos
    function navigateVideo(moduleId, direction) {
        console.log(`🧭 Navegando ${direction} en módulo ${moduleId}`);
        
        const chapter = chapters.find(c => c.id === moduleId);
        if (!chapter) {
            console.log('❌ Capítulo no encontrado');
            return;
        }
        
        const currentIndex = getCurrentVideoIndex(moduleId);
        const currentVideo = chapter.video.videos[currentIndex];
        let newIndex = currentIndex;
        
        if (direction === 'prev' && currentIndex > 0) {
            newIndex = currentIndex - 1;
            console.log(`⬅️ Navegando al video anterior: ${newIndex + 1}`);
        } else if (direction === 'next' && currentIndex < chapter.video.videos.length - 1) {
            const nextVideo = chapter.video.videos[currentIndex + 1];
            
            // Solo permitir avanzar si el siguiente video no está bloqueado
            if (nextVideo && nextVideo.status !== 'locked') {
                newIndex = currentIndex + 1;
                console.log(`➡️ Navegando al siguiente video: ${newIndex + 1} - ${nextVideo.title}`);
            } else {
                console.log('⚠️ No se puede avanzar: video siguiente bloqueado');
                Swal.fire({
                    icon: 'info',
                    title: 'Video Bloqueado',
                    text: 'Debes completar el video actual para desbloquear el siguiente',
                    confirmButtonColor: '#4a9fc7'
                });
                return;
            }
        } else {
            console.log('⚠️ No se puede navegar en esa dirección');
            return;
        }
        
        if (newIndex !== currentIndex) {
            selectVideo(moduleId, newIndex);
        }
    }
    
    // Pantalla completa
    function toggleFullscreen(moduleId) {
        const player = window.vimeoPlayers && window.vimeoPlayers[moduleId];
        if (!player) {
            console.log('⚠️ Player de Vimeo no encontrado para pantalla completa');
            return;
        }
        
        player.requestFullscreen().then(function() {
            console.log('✅ Pantalla completa activada');
        }).catch(function(error) {
            console.log('❌ Error al activar pantalla completa:', error);
        });
    }
    
    // Cuando el video se carga correctamente
    function onVideoLoaded(moduleId) {
        const errorDiv = document.getElementById(`videoError-${moduleId}`);
        if (errorDiv) {
            errorDiv.classList.add('hidden');
        }
    }
    
    // Cuando el video termina
    function onVideoEnded(moduleId) {
        console.log(`🎬 Video terminado en módulo ${moduleId}`);
        
        const chapter = chapters.find(c => c.id === moduleId);
        if (!chapter) {
            console.log('❌ Capítulo no encontrado:', moduleId);
            return;
        }
        
        const currentIndex = getCurrentVideoIndex(moduleId);
        const currentVideo = chapter.video.videos[currentIndex];
        
        if (!currentVideo) {
            console.log('❌ Video actual no encontrado:', currentIndex);
            return;
        }
        
        // Evitar procesar múltiples veces el mismo video
        if (currentVideo.status === 'completed') {
            console.log('⚠️ Video ya estaba marcado como completado');
            return;
        }
        
        console.log(`✅ Marcando video como completado: ${currentVideo.title}`);
        
        // Marcar video como completado
        currentVideo.status = 'completed';
        
        // Desbloquear siguiente video si existe
        const nextVideo = chapter.video.videos[currentIndex + 1];
        if (nextVideo && nextVideo.status === 'locked') {
            nextVideo.status = 'available';
            console.log(`🔓 Desbloqueando siguiente video: ${nextVideo.title}`);
        }
        
        // GUARDAR ESTADO INMEDIATAMENTE después de cambiar estados
        saveVideoState();
        console.log('💾 Estado de videos guardado INMEDIATAMENTE');
        
        // Actualizar progreso del módulo
        updateModuleVideoProgress(moduleId);
        
        // Actualizar progreso general del usuario
        updateUserProgressFromVideos(moduleId);
        
        // Verificar si TODOS los videos del módulo están completos
        const allVideosCompleted = chapter.video.videos.every(v => v.status === 'completed');
        
        // Si todos los videos están completos, verificar si el módulo está completo (3 requisitos)
        if (allVideosCompleted) {
            console.log('🎬 Todos los videos del módulo completados, verificando requisitos...');
            const isModuleComplete = checkModuleCompletion(moduleId);
            
            if (isModuleComplete) {
                // El módulo está completo, el mensaje ya se mostró en checkModuleCompletion/completeChapter
                console.log('✅ Módulo completado desde onVideoEnded');
                return; // Salir para no mostrar mensaje duplicado
            }
        }
        
        // Mostrar mensaje de felicitación (solo si el módulo NO está completo)
        // Si es el último video, mostrar qué requisitos faltan
        const isLastVideo = !nextVideo;
        const missingHTML = isLastVideo ? getMissingRequirementsHTML(moduleId) : '';
        
        Swal.fire({
            icon: 'success',
            title: '¡Video Completado!',
            html: `
                <div class="text-center">
                    <div class="text-4xl mb-3">🎬</div>
                    <p class="text-gray-600">Has completado:</p>
                    <h3 class="text-lg font-bold text-arquitecto-navy mt-2">${currentVideo.title}</h3>
                    ${nextVideo ? '<p class="mt-3 text-sm text-gray-600"><strong>El siguiente video ya está disponible</strong></p>' : 
                                '<p class="mt-3 text-sm text-green-600">¡Has completado todos los videos del módulo!</p>'}
                    ${missingHTML}
                </div>
            `,
            confirmButtonText: nextVideo ? 'Ver siguiente video' : 'Continuar',
            confirmButtonColor: '#4a9fc7',
            timer: nextVideo ? null : undefined,
            timerProgressBar: false
        }).then((result) => {
            if (result.isConfirmed && nextVideo) {
                console.log(`▶️ Iniciando siguiente video: ${nextVideo.title}`);
                selectVideo(moduleId, currentIndex + 1);
            } else {
                // Regenerar contenido para mostrar progreso actualizado
                console.log('🔄 Regenerando contenido de video');
                
                // Detectar si estamos en el modal o en la vista principal
                const modalContent = document.getElementById('moduleTabContent');
                const mainTabContent = document.getElementById('tabContent');
                
                if (modalContent && !mainTabContent) {
                    // Estamos en el modal
                    console.log('🔄 Regenerando contenido del modal');
                    showModuleTab('video', moduleId);
                } else if (mainTabContent) {
                    // Estamos en la vista principal
                    console.log('🔄 Regenerando contenido principal');
                showTab('video', moduleId);
                }
            }
        });
        
        // Guardar estado de usuario
        localStorage.setItem(getUserKey('arquitectoUser'), JSON.stringify(currentUser));
        
        console.log('✅ Proceso de finalización de video completado');
    }
    
    // Actualizar progreso general del usuario basado en videos completados
    function updateUserProgressFromVideos(moduleId) {
        const chapter = chapters.find(c => c.id === moduleId);
        if (!chapter) return;
        
        // NO avanzar currentChapter aquí - solo se avanza cuando se completan los 3 requisitos:
        // 1. Todos los videos completados
        // 2. Ejercicio realizado
        // 3. Compromiso guardado
        // Esto se maneja en la función completeChapter()
        
        // Sincronizar progreso general
        syncUserProgress();
        
        // Sincronizar estados de capítulos
        syncChapterStates();
        
        // Actualizar próxima meta
        updateNextGoal();
    }
    
    // Cuando hay error al cargar video
    function onVideoError(moduleId) {
        const videoPlayer = document.getElementById(`videoPlayer-${moduleId}`);
        const errorDiv = document.getElementById(`videoError-${moduleId}`);
        
        if (videoPlayer) {
            videoPlayer.style.display = 'none';
        }
        
        if (errorDiv) {
            errorDiv.classList.remove('hidden');
        }
        
        // No mostrar error en consola, solo manejar visualmente
        console.log(`Video no disponible para módulo ${moduleId}`);
    }
    
    // Actualizar progreso visual del módulo
    function updateModuleVideoProgress(moduleId) {
        const chapter = chapters.find(c => c.id === moduleId);
        if (!chapter) return;
        
        const progress = getModuleVideoProgress(chapter);
        const progressElement = document.getElementById(`moduleProgress-${moduleId}`);
        const progressBar = document.querySelector(`#moduleProgress-${moduleId}`);
        
        if (progressElement) {
            progressElement.textContent = progress + '%';
        }
        
        // Actualizar también el progreso general del dashboard si es necesario
        if (progress === 100) {
            // Si todos los videos están completados, marcar módulo como completado
            updateOverallModuleProgress(moduleId);
        }
    }
    
    // Actualizar progreso general del módulo en el dashboard
    function updateOverallModuleProgress(moduleId) {
        const chapter = chapters.find(c => c.id === moduleId);
        if (!chapter) return;
        
        // Verificar si todos los videos están completados
        const allVideosCompleted = chapter.video.videos.every(v => v.status === 'completed');
        
        if (allVideosCompleted && !currentUser.completedChapters.includes(moduleId)) {
            // Marcar módulo como completado solo por videos
            // (el usuario aún necesita completar ejercicios, reflexiones, etc.)
            chapter.status = 'video-completed';
            
            // Mostrar notificación
            Swal.fire({
                icon: 'success',
                title: '¡Módulo de Videos Completado!',
                html: `
                    <div class="text-center">
                        <div class="text-5xl mb-4">🎓</div>
                        <p class="text-gray-600">Has completado todos los videos del</p>
                        <h3 class="text-xl font-bold text-arquitecto-navy mt-2">Módulo ${moduleId}: ${chapter.title}</h3>
                        <p class="mt-4 text-sm text-gray-600">
                            Ahora puedes continuar con los ejercicios, reflexiones y compromisos
                        </p>
                    </div>
                `,
                confirmButtonText: 'Continuar con el módulo',
                confirmButtonColor: '#4a9fc7'
            });
        }
    }
    
    // Guardar estado de videos en localStorage
    function saveVideoState() {
        const videoState = {
            currentModuleVideos: currentModuleVideos,
            videoStatuses: {}
        };
        
        // Guardar estados de todos los videos
        chapters.forEach(chapter => {
            if (chapter.video.videos) {
                videoState.videoStatuses[chapter.id] = chapter.video.videos.map(v => ({
                    id: v.id,
                    status: v.status
                }));
            }
        });
        
        localStorage.setItem(getUserKey('arquitectoVideoState'), JSON.stringify(videoState));
    }
    
    // Limpiar completamente el estado de videos (para testing/reset)
    function resetVideoState() {
        console.log('🔄 RESETEANDO completamente el estado de videos');
        
        // Limpiar localStorage
        localStorage.removeItem(getUserKey('arquitectoVideoState'));
        
        // Resetear estados en memoria
        chapters.forEach(chapter => {
            chapter.video.videos.forEach((video, index) => {
                if (chapter.id === 1 && index === 0) {
                    video.status = 'available'; // ✅ Solo primer video del módulo 1
                } else {
                    video.status = 'locked';     // 🔒 Todo lo demás bloqueado
                }
            });
        });
        
        // Resetear currentModuleVideos
        currentModuleVideos = { 1: 0 };
        
        // Guardar estado limpio
        saveVideoState();
        
        console.log('✅ Estado de videos completamente reseteado');
        
        // Regenerar interfaces para mostrar el estado limpio
        const modalContent = document.getElementById('moduleTabContent');
        const mainTabContent = document.getElementById('tabContent');
        
        if (modalContent && !mainTabContent) {
            showModuleTab('video', 1);
        } else if (mainTabContent) {
            showTab('video', 1);
        }
    }
    
    // FUNCIÓN TEMPORAL PARA DEBUGGING - Ejecutar desde consola: window.debugResetVideos()
    window.debugResetVideos = function() {
        console.log('🔧 DEBUG: Reseteando estado de videos...');
        resetVideoState();
        alert('Estado de videos reseteado. Solo el primer video del módulo 1 debería estar disponible.');
    };

    // Inicializar estado por defecto de videos para usuarios nuevos
    function initializeDefaultVideoState() {
        console.log('🎬 Inicializando estado por defecto de videos para usuario nuevo');
        
        // Solo primer video del módulo 1 disponible, todo lo demás bloqueado
        chapters.forEach(chapter => {
            chapter.video.videos.forEach((video, index) => {
                if (chapter.id === 1 && index === 0) {
                    video.status = 'available'; // ✅ Solo primer video del módulo 1
                } else {
                    video.status = 'locked';     // 🔒 Todo lo demás bloqueado
                }
            });
        });
        
        // Inicializar currentModuleVideos con video 0 para módulo 1
        currentModuleVideos = { 1: 0 };
        
        // Guardar estado inicial
        saveVideoState();
        
        console.log('✅ Estado inicial de videos guardado');
    }
    
    // Cargar estado de videos desde localStorage
    function loadVideoState() {
        const savedState = localStorage.getItem(getUserKey('arquitectoVideoState'));
        
        if (!savedState) {
            console.log('⚠️ No se encontró estado guardado de videos, inicializando por defecto');
            initializeDefaultVideoState();
            return;
        }
        
        try {
            const videoState = JSON.parse(savedState);
            console.log('📂 Cargando estado guardado de videos:', videoState);
            
            // Restaurar videos actuales por módulo
            currentModuleVideos = videoState.currentModuleVideos || {};
            
            // Restaurar estados de videos
            if (videoState.videoStatuses) {
                chapters.forEach(chapter => {
                    if (chapter.video.videos && videoState.videoStatuses[chapter.id]) {
                        const savedStatuses = videoState.videoStatuses[chapter.id];
                        
                        chapter.video.videos.forEach((video, index) => {
                            const savedStatus = savedStatuses.find(s => s.id === video.id);
                            if (savedStatus) {
                                video.status = savedStatus.status;
                            }
                        });
                    }
                });
            }
            
            console.log('✅ Estado de videos cargado correctamente');
        } catch (error) {
            console.log('❌ Error cargando estado de videos:', error);
            // Si hay error, inicializar por defecto
            initializeDefaultVideoState();
        }
    }

    // === FUNCIONES DE CALENDARIO ===
    
    // Variable global para almacenar datos del compromiso actual
    let currentCommitmentData = null;
    
    // Función principal para calendarizar compromiso
    function calendarizeCommitment(chapterId) {
        // Recopilar datos del compromiso actual
        const chapter = chapters.find(c => c.id === chapterId);
        if (!chapter) return;
        
        // Obtener todos los textareas y inputs del compromiso
        const textareas = document.querySelectorAll('#tabContent textarea');
        const inputs = document.querySelectorAll('#tabContent input[type="text"]');
        
        // Validar que haya datos
        if (textareas.length === 0) {
            Swal.fire({
                icon: 'warning',
                title: 'Completa el compromiso',
                text: 'Por favor completa los campos del compromiso antes de calendarizarlo',
                confirmButtonColor: '#4a9fc7'
            });
            return;
        }
        
        // Recopilar respuestas de elementos específicos
        const moduleElements = {};
        chapter.content.commitment.elements.forEach((element, index) => {
            if (textareas[index]) {
                moduleElements[`element${index + 1}`] = {
                    question: element,
                    answer: textareas[index].value || ''
                };
            }
        });
        
        // Recopilar cuándo y cómo medir
        const whenValue = inputs[0] ? inputs[0].value : '';
        const measureValue = inputs[1] ? inputs[1].value : '';
        
        // Almacenar datos del compromiso
        currentCommitmentData = {
            chapterId: chapterId,
            moduleTitle: chapter.title,
            moduleElements: moduleElements,
            when: whenValue,
            measure: measureValue,
            date: new Date().toISOString()
        };
        
        // Mostrar modal de configuración
        showCalendarModal();
    }
    
    // Mostrar modal de configuración de calendario
    function showCalendarModal() {
        if (!currentCommitmentData) return;
        
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        const tomorrowStr = tomorrow.toISOString().split('T')[0];
        
        const modalBody = document.getElementById('calendarModalBody');
        modalBody.innerHTML = `
            <div class="space-y-4">
                <!-- Título del evento -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Título del evento:</label>
                    <input type="text" id="eventTitle" 
                           class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-arquitecto-blue focus:outline-none transition-colors text-sm" 
                           value="Compromiso: ${currentCommitmentData.moduleTitle}">
                </div>
                
                <!-- Fecha y hora de inicio -->
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Fecha:</label>
                        <input type="date" id="eventDate" 
                               class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-arquitecto-blue focus:outline-none transition-colors text-sm" 
                               value="${tomorrowStr}">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Hora:</label>
                        <input type="time" id="eventTime" 
                               class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-arquitecto-blue focus:outline-none transition-colors text-sm" 
                               value="06:00">
                    </div>
                </div>
                
                <!-- Duración -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Duración:</label>
                    <select id="eventDuration" class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-arquitecto-blue focus:outline-none transition-colors text-sm">
                        <option value="15">15 minutos</option>
                        <option value="30" selected>30 minutos</option>
                        <option value="60">1 hora</option>
                        <option value="90">1.5 horas</option>
                        <option value="120">2 horas</option>
                    </select>
                </div>
                
                <!-- Frecuencia -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Frecuencia:</label>
                    <div class="space-y-1">
                        <label class="flex items-center">
                            <input type="radio" name="frequency" value="none" class="w-4 h-4 text-arquitecto-blue mr-2" checked>
                            <span class="text-gray-700 text-sm">Una sola vez</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="frequency" value="daily" class="w-4 h-4 text-arquitecto-blue mr-2">
                            <span class="text-gray-700 text-sm">Diariamente</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="frequency" value="weekly" class="w-4 h-4 text-arquitecto-blue mr-2">
                            <span class="text-gray-700 text-sm">Semanalmente</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="frequency" value="monthly" class="w-4 h-4 text-arquitecto-blue mr-2">
                            <span class="text-gray-700 text-sm">Mensualmente</span>
                        </label>
                    </div>
                </div>
                
                <!-- Recordatorio -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Recordatorio:</label>
                    <div class="space-y-1">
                        <label class="flex items-center">
                            <input type="radio" name="reminder" value="15" class="w-4 h-4 text-arquitecto-blue mr-2" checked>
                            <span class="text-gray-700 text-sm">15 minutos antes</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="reminder" value="60" class="w-4 h-4 text-arquitecto-blue mr-2">
                            <span class="text-gray-700 text-sm">1 hora antes</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="reminder" value="1440" class="w-4 h-4 text-arquitecto-blue mr-2">
                            <span class="text-gray-700 text-sm">1 día antes</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="reminder" value="none" class="w-4 h-4 text-arquitecto-blue mr-2">
                            <span class="text-gray-700 text-sm">Sin recordatorio</span>
                        </label>
                    </div>
                </div>
            </div>
        `;
        
        // Agregar botones en la sección fija
        const modalButtons = document.getElementById('calendarModalButtons');
        modalButtons.innerHTML = `
            <div class="flex flex-col sm:flex-row gap-3">
                <button onclick="generateCalendarFile()" 
                        class="flex-1 px-4 py-2 bg-arquitecto-blue text-white font-semibold rounded-lg hover:bg-arquitecto-blue-dark transition-colors text-sm">
                    <i class="fas fa-download mr-2"></i>Generar Calendario
                </button>
                <button onclick="closeCalendarModal()" 
                        class="flex-1 px-4 py-2 border-2 border-gray-300 text-gray-700 font-semibold rounded-lg hover:bg-gray-50 transition-colors text-sm">
                    <i class="fas fa-times mr-2"></i>Cancelar
                </button>
            </div>
        `;
        
        // Mostrar modal
        const modal = document.getElementById('calendarModal');
        modal.classList.remove('hidden');
        modal.classList.add('flex');
    }
    
    // Cerrar modal de calendario
    function closeCalendarModal() {
        const modal = document.getElementById('calendarModal');
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        currentCommitmentData = null;
    }
    
    // Generar y descargar archivo .ics
    function generateCalendarFile() {
        if (!currentCommitmentData) return;
        
        // Recopilar configuración del modal
        const eventTitle = document.getElementById('eventTitle').value;
        const eventDate = document.getElementById('eventDate').value;
        const eventTime = document.getElementById('eventTime').value;
        const eventDuration = parseInt(document.getElementById('eventDuration').value);
        const frequency = document.querySelector('input[name="frequency"]:checked').value;
        const reminder = document.querySelector('input[name="reminder"]:checked').value;
        
        // Validar campos requeridos
        if (!eventTitle || !eventDate || !eventTime) {
            Swal.fire({
                icon: 'warning',
                title: 'Campos incompletos',
                text: 'Por favor completa título, fecha y hora del evento',
                confirmButtonColor: '#4a9fc7'
            });
            return;
        }
        
        // Configuración del calendario
        const calendarConfig = {
            title: eventTitle,
            date: eventDate,
            time: eventTime,
            duration: eventDuration,
            frequency: frequency,
            reminder: reminder
        };
        
        // Generar contenido .ics
        const icsContent = generateICSContent(currentCommitmentData, calendarConfig);
        
        // Descargar archivo
        const filename = `compromiso_${currentCommitmentData.moduleTitle.toLowerCase().replace(/\s+/g, '_')}_${eventDate}.ics`;
        downloadICSFile(icsContent, filename);
        
        // Cerrar modal
        closeCalendarModal();
        
        // Mostrar mensaje de éxito
        Swal.fire({
            icon: 'success',
            title: '¡Calendario generado!',
            html: `
                <div class="text-center">
                    <div class="text-4xl mb-3">📅</div>
                    <p class="text-gray-600">Tu compromiso ha sido exportado al calendario</p>
                    <p class="text-sm text-gray-500 mt-2">
                        <strong>✅ Archivo descargado exitosamente</strong>
                    </p>
                    <p class="text-xs text-gray-400 mt-3">Usa el archivo descargado para importarlo en tu aplicación de calendario (Outlook, Google Calendar, etc.)</p>
                </div>
            `,
            confirmButtonText: 'Entendido',
            confirmButtonColor: '#4a9fc7'
        });
    }
    
    // Generar contenido .ics
    function generateICSContent(commitmentData, calendarConfig) {
        // Crear fecha/hora de inicio
        const startDateTime = new Date(`${calendarConfig.date}T${calendarConfig.time}`);
        const endDateTime = new Date(startDateTime.getTime() + (calendarConfig.duration * 60000));
        
        // Formatear fechas para .ics (formato: YYYYMMDDTHHMMSSZ)
        const formatICSDate = (date) => {
            return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
        };
        
        const dtStart = formatICSDate(startDateTime);
        const dtEnd = formatICSDate(endDateTime);
        
        // Generar UID único
        const uid = `compromiso-${commitmentData.chapterId}-${Date.now()}@arquitectodetudestino.com`;
        
        // Crear descripción detallada
        let description = `COMPROMISO DEL MÓDULO: ${commitmentData.moduleTitle}\\n\\n`;
        
        // Agregar elementos específicos del módulo
        Object.values(commitmentData.moduleElements).forEach((element, index) => {
            if (element.answer) {
                description += `${index + 1}. ${element.question}:\\n${element.answer}\\n\\n`;
            }
        });
        
        // Agregar cuándo y cómo medir
        if (commitmentData.when) {
            description += `CUÁNDO: ${commitmentData.when}\\n\\n`;
        }
        if (commitmentData.measure) {
            description += `CÓMO MEDIR PROGRESO: ${commitmentData.measure}\\n\\n`;
        }
        
        description += `Generado por: Arquitecto de tu Destino\\nFecha de creación: ${new Date().toLocaleDateString()}`;
        
        // Crear regla de repetición si es necesaria
        let rrule = '';
        switch (calendarConfig.frequency) {
            case 'daily':
                rrule = 'RRULE:FREQ=DAILY;INTERVAL=1\\n';
                break;
            case 'weekly':
                rrule = 'RRULE:FREQ=WEEKLY;INTERVAL=1\\n';
                break;
            case 'monthly':
                rrule = 'RRULE:FREQ=MONTHLY;INTERVAL=1\\n';
                break;
        }
        
        // Crear alarma/recordatorio si es necesaria
        let valarm = '';
        if (calendarConfig.reminder !== 'none') {
            const reminderMinutes = parseInt(calendarConfig.reminder);
            valarm = `BEGIN:VALARM\\n` +
                    `TRIGGER:-PT${reminderMinutes}M\\n` +
                    `ACTION:DISPLAY\\n` +
                    `DESCRIPTION:Recordatorio: Es hora de cumplir tu compromiso\\n` +
                    `END:VALARM\\n`;
        }
        
        // Construir contenido .ics completo
        const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Arquitecto de tu Destino//ES
CALSCALE:GREGORIAN
METHOD:PUBLISH
BEGIN:VEVENT
UID:${uid}
DTSTART:${dtStart}
DTEND:${dtEnd}
SUMMARY:${calendarConfig.title}
DESCRIPTION:${description}
LOCATION:Personal
STATUS:CONFIRMED
${rrule}${valarm}END:VEVENT
END:VCALENDAR`;
        
        return icsContent;
    }
    
    // Descargar archivo .ics
    function downloadICSFile(content, filename) {
        // Crear blob con el contenido
        const blob = new Blob([content], { type: 'text/calendar;charset=utf-8' });
        
        // Crear enlace de descarga
        const link = document.createElement('a');
        const blobUrl = window.URL.createObjectURL(blob);
        link.href = blobUrl;
        link.download = filename;
        
        // Ejecutar descarga
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        // Limpiar objeto URL después de un tiempo
        setTimeout(() => {
            window.URL.revokeObjectURL(blobUrl);
        }, 5000);
    }

    // === FUNCIONES DE VIDEO INTRODUCTORIO ===
    
    // Cuando el video introductorio se carga correctamente
    function onIntroVideoLoaded() {
        const errorDiv = document.getElementById('introVideoError');
        if (errorDiv) {
            errorDiv.classList.add('hidden');
        }
    }
    
    // Cuando hay error al cargar video introductorio
    function onIntroVideoError() {
        const videoPlayer = document.getElementById('introVideoPlayer');
        const errorDiv = document.getElementById('introVideoError');
        
        if (videoPlayer) {
            videoPlayer.style.display = 'none';
        }
        
        if (errorDiv) {
            errorDiv.classList.remove('hidden');
        }
        
        // No mostrar error en consola, solo manejar visualmente
        console.log('Video introductorio no disponible');
    }
    
    // Pantalla completa para video introductorio
    function toggleIntroVideoFullscreen() {
        const player = window.introVimeoPlayer;
        if (!player) {
            console.log('⚠️ Player de video introductorio no encontrado');
            return;
        }
        
        player.requestFullscreen().then(function() {
            console.log('✅ Pantalla completa activada en video introductorio');
        }).catch(function(error) {
            console.log('❌ Error al activar pantalla completa:', error);
        });
    }

    // === FUNCIONES DE VIDEO DE FONDO PRINCIPAL ===
    
    // Cuando el video de fondo se carga correctamente
    function onArchitectVideoLoaded() {
        console.log('🎬 Video de fondo cargado correctamente');
        const fallbackDiv = document.getElementById('architectImageFallback');
        if (fallbackDiv) {
            fallbackDiv.style.display = 'none';
        }
    }
    
    // Cuando hay error al cargar video de fondo
    function onArchitectVideoError() {
        console.log('⚠️ Error al cargar video de fondo, usando imagen de fallback');
        const videoPlayer = document.getElementById('architectVideoPlayer');
        const fallbackDiv = document.getElementById('architectImageFallback');
        
        if (videoPlayer) {
            videoPlayer.style.display = 'none';
        }
        
        if (fallbackDiv) {
            fallbackDiv.style.display = 'block';
        }
    }

    // === FUNCIONES PARA MODALES DE OBJETIVO Y FILOSOFÍA ===
    
    function showObjetivoModal() {
        document.getElementById('objetivoModal').classList.remove('hidden');
        document.getElementById('objetivoModal').classList.add('flex');
    }
    
    function closeObjetivoModal() {
        document.getElementById('objetivoModal').classList.add('hidden');
        document.getElementById('objetivoModal').classList.remove('flex');
    }
    
    function showFilosofiaModal() {
        document.getElementById('filosofiaModal').classList.remove('hidden');
        document.getElementById('filosofiaModal').classList.add('flex');
    }
    
    function closeFilosofiaModal() {
        document.getElementById('filosofiaModal').classList.add('hidden');
        document.getElementById('filosofiaModal').classList.remove('flex');
    }

    // === FUNCIONES DE NAVEGACIÓN ENTRE SECCIONES ===
    
    function showSection(section) {
        // Guardar la sección actual en localStorage
        localStorage.setItem(getUserKey('currentSection'), section);
        
        // Ocultar todas las secciones usando style.display para consistencia
        const inicioSection = document.getElementById('inicioSection');
        const viajeSection = document.getElementById('viajeSection');
        const welcomeScreen = document.getElementById('welcomeScreen');
        
        if (inicioSection) inicioSection.style.display = 'none';
        if (viajeSection) viajeSection.style.display = 'none';
        if (welcomeScreen) welcomeScreen.style.display = 'none';
        
        // Mostrar la sección seleccionada
        if (section === 'inicio') {
            if (inicioSection) inicioSection.style.display = 'block';
        } else if (section === 'viaje') {
            if (viajeSection) viajeSection.style.display = 'block';
            // Generar módulos dinámicamente si no existen
            generateModules();
        }
    }

    // === FUNCIÓN PARA MENÚ DESPLEGABLE DEL USUARIO ===
    
    function toggleUserMenu() {
        const dropdown = document.getElementById('userDropdown');
        if (dropdown.classList.contains('hidden')) {
            dropdown.classList.remove('hidden');
        } else {
            dropdown.classList.add('hidden');
        }
    }

    function toggleUserMenuViaje() {
        const dropdown = document.getElementById('userDropdownViaje');
        if (dropdown.classList.contains('hidden')) {
            dropdown.classList.remove('hidden');
        } else {
            dropdown.classList.add('hidden');
        }
    }

    // === FUNCIONES PARA MENÚ HAMBURGUESA MÓVIL ===
    
    function toggleMobileMenu() {
        const mobileMenu = document.getElementById('mobileMenu');
        if (mobileMenu.classList.contains('hidden')) {
            mobileMenu.classList.remove('hidden');
        } else {
            mobileMenu.classList.add('hidden');
        }
    }

    function closeMobileMenu() {
        const mobileMenu = document.getElementById('mobileMenu');
        mobileMenu.classList.add('hidden');
    }

    function toggleMobileMenuViaje() {
        const mobileMenu = document.getElementById('mobileMenuViaje');
        if (mobileMenu.classList.contains('hidden')) {
            mobileMenu.classList.remove('hidden');
        } else {
            mobileMenu.classList.add('hidden');
        }
    }

    function closeMobileMenuViaje() {
        const mobileMenu = document.getElementById('mobileMenuViaje');
        mobileMenu.classList.add('hidden');
    }
    
    // Cerrar menú al hacer clic fuera
    document.addEventListener('click', function(event) {
        const userMenuButton = document.getElementById('userMenuButton');
        const userDropdown = document.getElementById('userDropdown');
        
        if (userMenuButton && userDropdown && !userMenuButton.contains(event.target) && !userDropdown.contains(event.target)) {
            userDropdown.classList.add('hidden');
        }
    });

    // === FUNCIÓN PARA GENERAR MÓDULOS DINÁMICAMENTE ===
    
    function generateModules() {
        const container = document.getElementById('modulesContainer');
        if (!container || container.children.length > 0) return;
        
        chapters.forEach(chapter => {
            const moduleCard = document.createElement('div');
            moduleCard.className = 'bg-white rounded-lg p-4 shadow-md hover:shadow-lg transition-shadow cursor-pointer';
            moduleCard.onclick = () => showModuleModal(chapter.id);
            moduleCard.id = `module-${chapter.id}`; // Agregar ID para poder actualizar
            
            moduleCard.innerHTML = getModuleCardHTML(chapter);
            
            container.appendChild(moduleCard);
        });
    }
    
    // Función para generar HTML de tarjeta de módulo basado en su estado
    function getModuleCardHTML(chapter) {
        let iconHTML = '';
        let progressWidth = '0%';
        
        if (chapter.status === 'completed') {
            iconHTML = '<i class="fas fa-check-circle text-green-500"></i>';
            progressWidth = '100%';
        } else if (chapter.status === 'available') {
            iconHTML = '<i class="fas fa-play text-arquitecto-blue"></i>';
            progressWidth = '10%'; // Pequeño progreso para mostrar que está disponible
        } else {
            iconHTML = '<i class="fas fa-lock text-gray-400"></i>';
            progressWidth = '0%';
        }
        
        return `
                <div class="flex items-center justify-between mb-3">
                    <div class="w-12 h-12 bg-arquitecto-navy rounded-lg flex items-center justify-center text-white font-bold text-lg">
                        ${chapter.id}
                    </div>
                ${iconHTML}
                </div>
                <h3 class="font-bold text-gray-800 mb-2">${chapter.title}</h3>
                <p class="text-sm text-gray-600">${chapter.description}</p>
                <div class="w-full bg-gray-200 rounded-full h-2 mt-3">
                <div class="bg-arquitecto-blue h-2 rounded-full transition-all duration-500" style="width: ${progressWidth}"></div>
                </div>
            `;
    }
    
    // Función para actualizar la visualización de módulos después de completar uno
    function updateModulesVisualState() {
        chapters.forEach(chapter => {
            const moduleCard = document.getElementById(`module-${chapter.id}`);
            if (moduleCard) {
                moduleCard.innerHTML = getModuleCardHTML(chapter);
            }
        });
    }
    
    // Función para resetear completamente los estados para usuario nuevo
    function resetStatesForNewUser() {
        console.log('🔄 Reseteando estados para usuario nuevo');
        
        // PRIMERO: Recalcular currentChapter basándose en módulos realmente completados
        if (currentUser.completedChapters && currentUser.completedChapters.length > 0) {
            const maxCompleted = Math.max(...currentUser.completedChapters);
            currentUser.currentChapter = Math.min(maxCompleted + 1, chapters.length);
        } else {
            currentUser.currentChapter = 1;
        }
        
        // Resetear estados de chapters
        chapters.forEach(chapter => {
            if (currentUser.completedChapters.includes(chapter.id)) {
                chapter.status = "completed";
            } else if (chapter.id <= currentUser.currentChapter) {
                chapter.status = "available";
            } else {
                chapter.status = "locked";
            }
        });
        
        // Actualizar UI
        updateModulesVisualState();
        
        console.log('✅ Estados reseteados para usuario nuevo');
    }

    // === FUNCIONES PARA MODAL DE MÓDULOS ===
    
    function showModuleModal(chapterId) {
        const chapter = chapters.find(c => c.id === chapterId);
        if (!chapter) return;
        
        // VALIDAR SI EL MÓDULO ESTÁ BLOQUEADO
        if (chapter.status === 'locked') {
            Swal.fire({
                icon: 'info',
                title: 'Módulo bloqueado',
                text: 'Completa los módulos anteriores para desbloquear este contenido',
                confirmButtonColor: '#4a9fc7'
            });
            return;
        }
        
        // Asegurar que el primer video del módulo esté disponible
        if (chapter.video && chapter.video.videos && chapter.video.videos.length > 0) {
            if (chapter.video.videos[0].status === 'locked') {
                chapter.video.videos[0].status = 'available';
                saveVideoState();
                console.log(`✅ Primer video del módulo ${chapterId} ahora disponible`);
            }
        }
        
        // Actualizar título del modal
        document.getElementById('moduleModalTitle').textContent = `Módulo ${chapter.id}: ${chapter.title}`;
        
        // Generar contenido completo del módulo
        const modalContent = document.getElementById('moduleModalContent');
        modalContent.innerHTML = generateChapterContent(chapter);
        
        // Mostrar modal
        document.getElementById('moduleModal').classList.remove('hidden');
        document.getElementById('moduleModal').classList.add('flex');
        
        // Inicializar funcionalidades del módulo
        initializeModuleContent(chapter);
    }
    
    function closeModuleModal() {
        // Pausar y resetear todos los videos HTML5 del modal
        const videos = document.querySelectorAll('#moduleModal video');
        videos.forEach(video => {
            video.pause();
            video.currentTime = 0;
        });
        
        // Pausar y destruir todos los players de Vimeo de los módulos
        if (window.vimeoPlayers) {
            Object.keys(window.vimeoPlayers).forEach(moduleId => {
                try {
                    if (window.vimeoPlayers[moduleId]) {
                        window.vimeoPlayers[moduleId].pause();
                        window.vimeoPlayers[moduleId].destroy();
                        console.log(`🗑️ Player Vimeo del módulo ${moduleId} destruido`);
                    }
                } catch (e) {
                    console.log(`⚠️ Error al destruir player del módulo ${moduleId}:`, e);
                }
            });
            window.vimeoPlayers = {};
        }
        
        // Detener síntesis de voz si está reproduciéndose
        if (window.speechSynthesis && (window.speechSynthesis.speaking || window.speechSynthesis.paused)) {
            window.speechSynthesis.cancel();
        }
        
        // Cerrar modal
        document.getElementById('moduleModal').classList.add('hidden');
        document.getElementById('moduleModal').classList.remove('flex');
    }

    function toggleModuleVideoFullscreen() {
        // Buscar el video activo en el modal
        const activeVideo = document.querySelector('#moduleModal video');
        if (activeVideo) {
            if (activeVideo.requestFullscreen) {
                activeVideo.requestFullscreen();
            } else if (activeVideo.webkitRequestFullscreen) {
                activeVideo.webkitRequestFullscreen();
            } else if (activeVideo.mozRequestFullScreen) {
                activeVideo.mozRequestFullScreen();
            } else if (activeVideo.msRequestFullscreen) {
                activeVideo.msRequestFullscreen();
            }
        }
    }

    // Event listener para cerrar modal al hacer clic fuera
    document.addEventListener('click', function(event) {
        const moduleModal = document.getElementById('moduleModal');
        const modalContent = moduleModal?.querySelector('.bg-white');
        
        if (moduleModal && !moduleModal.classList.contains('hidden')) {
            if (event.target === moduleModal && !modalContent?.contains(event.target)) {
                closeModuleModal();
            }
        }
    });
    
    function generateChapterContent(chapter) {
        return `
            <div class="p-6">
                <p class="text-gray-700 text-lg mb-6">${chapter.description}</p>
                
                <!-- Pestañas del módulo -->
                <div class="border-b border-gray-200 mb-6">
                    <nav class="flex space-x-8">
                        <button onclick="showModuleTab('video', ${chapter.id})" class="module-tab-btn py-2 px-1 border-b-2 border-transparent font-medium text-sm hover:text-arquitecto-navy hover:border-gray-300 transition-colors" data-tab="video">
                            <i class="fas fa-play mr-2"></i>Video
                        </button>
                        <button onclick="showModuleTab('lectura', ${chapter.id})" class="module-tab-btn py-2 px-1 border-b-2 border-transparent font-medium text-sm hover:text-arquitecto-navy hover:border-gray-300 transition-colors" data-tab="lectura">
                            <i class="fas fa-book mr-2"></i>Lectura
                        </button>
                        <button onclick="showModuleTab('reflexion', ${chapter.id})" class="module-tab-btn py-2 px-1 border-b-2 border-transparent font-medium text-sm hover:text-arquitecto-navy hover:border-gray-300 transition-colors" data-tab="reflexion">
                            <i class="fas fa-lightbulb mr-2"></i>Reflexión
                        </button>
                        <button onclick="showModuleTab('ejercicio', ${chapter.id})" class="module-tab-btn py-2 px-1 border-b-2 border-transparent font-medium text-sm hover:text-arquitecto-navy hover:border-gray-300 transition-colors" data-tab="ejercicio">
                            <i class="fas fa-dumbbell mr-2"></i>Ejercicio
                        </button>
                        <button onclick="showModuleTab('compromiso', ${chapter.id})" class="module-tab-btn py-2 px-1 border-b-2 border-transparent font-medium text-sm hover:text-arquitecto-navy hover:border-gray-300 transition-colors" data-tab="compromiso">
                            <i class="fas fa-handshake mr-2"></i>Compromiso
                        </button>
                    </nav>
                </div>
                
                <!-- Contenido de las pestañas -->
                <div id="moduleTabContent">
                    <!-- El contenido se cargará dinámicamente -->
                </div>
            </div>
        `;
    }
    
    function initializeModuleContent(chapter) {
        // Activar la primera pestaña por defecto
        showModuleTab('video', chapter.id);
    }
    
    function showModuleTab(tabName, chapterId) {
        // Actualizar botones de pestañas
        document.querySelectorAll('.module-tab-btn').forEach(btn => {
            btn.classList.remove('border-arquitecto-navy', 'text-arquitecto-navy');
            btn.classList.add('border-transparent');
        });
        
        const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
        if (activeBtn) {
            activeBtn.classList.add('border-arquitecto-navy', 'text-arquitecto-navy');
            activeBtn.classList.remove('border-transparent');
        }
        
        // Cargar contenido de la pestaña
        const tabContent = document.getElementById('moduleTabContent');
        const chapter = chapters.find(c => c.id === chapterId);
        
        switch(tabName) {
            case 'video':
                tabContent.innerHTML = generateVideoContent(chapter);
                // Inicializar Vimeo Player después de renderizar
                setTimeout(() => {
                    const currentIndex = getCurrentVideoIndex(chapter.id);
                    const currentVideo = chapter.video.videos[currentIndex];
                    if (currentVideo) {
                        initializeVimeoPlayer(chapter.id, currentVideo);
                    }
                }, 100);
                break;
            case 'lectura':
                tabContent.innerHTML = generateLecturaContent(chapter);
                break;
            case 'reflexion':
                tabContent.innerHTML = generateReflexionContent(chapter);
                break;
            case 'ejercicio':
                tabContent.innerHTML = generateEjercicioContent(chapter);
                // Inicializar la rueda de la vida para el módulo 9
                if (chapterId === 9) {
                    initializeLifeWheel();
                }
                break;
            case 'compromiso':
                tabContent.innerHTML = generateCompromisoContent(chapter);
                break;
        }
    }
    
    // === FUNCIONES PARA GENERAR CONTENIDO DE PESTAÑAS ===
    
    function generateVideoContent(chapter) {
        // Usar la función existente showChapterVideo pero adaptada para modal
        if (!chapter.video || !chapter.video.videos) {
            return '<p class="text-gray-500 text-center py-8">No hay videos disponibles para este módulo.</p>';
        }
        
        return `
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Lista de Videos -->
                <div class="lg:col-span-1">
                    <h3 class="text-lg font-semibold mb-4">Videos del Módulo</h3>
                    <div class="space-y-3">
                        ${chapter.video.videos.map((video, index) => `
                            <div class="p-3 border rounded-lg transition-colors
                                 ${video.status === 'locked' ? 'opacity-50 cursor-not-allowed bg-gray-100' : 'cursor-pointer hover:bg-gray-50'}"
                                 onclick="${video.status !== 'locked' ? `selectVideo(${chapter.id}, ${index})` : ''}"
                                 title="${video.status === 'locked' ? 'Completa el video anterior para desbloquear' : 'Clic para reproducir'}">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold
                                         ${video.status === 'completed' ? 'bg-green-500 text-white' : 
                                           video.status === 'in-progress' ? 'bg-arquitecto-navy text-white' :
                                           video.status === 'available' ? 'bg-arquitecto-blue text-white' : 'bg-gray-300 text-gray-600'}">
                                        ${video.status === 'completed' ? '✓' : 
                                          video.status === 'locked' ? '🔒' : index + 1}
                                    </div>
                                    <div>
                                        <div class="font-medium text-sm">${video.title}</div>
                                        <div class="text-xs text-gray-500">Video ${video.id}</div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- Reproductor Principal -->
                <div class="lg:col-span-2">
                    <div class="bg-black rounded-lg overflow-hidden" style="aspect-ratio: 16/9;">
                        <div id="vimeoPlayerContainer-${chapter.id}" style="width: 100%; height: 100%;"></div>
                    </div>
                    
                    <div class="mt-4">
                        <h4 class="font-bold text-lg mb-2" id="currentModuleVideoTitle">${getCurrentVideo(chapter.id)?.title || chapter.video.videos[0].title}</h4>
                        <div class="flex justify-between items-center">
                            <button onclick="navigateVideo(${chapter.id}, 'prev')" 
                                    class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                                <i class="fas fa-chevron-left mr-2"></i>Anterior
                            </button>
                            <button onclick="toggleFullscreen(${chapter.id})" 
                                    class="px-4 py-2 bg-arquitecto-blue text-white rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                                <i class="fas fa-expand mr-2"></i>Pantalla Completa
                            </button>
                            <button onclick="navigateVideo(${chapter.id}, 'next')" 
                                    class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                                Siguiente<i class="fas fa-chevron-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            ${chapter.id === 1 ? `
            <!-- Elementos para recordar del emprendedor -->
            <div class="mt-8 bg-blue-50 rounded-lg p-6">
                <h3 class="text-lg font-semibold text-arquitecto-navy mb-4">
                    <i class="fas fa-lightbulb mr-2"></i>Elementos para recordar del emprendedor
                </h3>
                <div class="space-y-3">
                    <div class="flex items-start space-x-3">
                        <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                        <span class="text-gray-700">Un emprendedor es una persona que ¡está dispuesta a cambiar!</span>
                    </div>
                    <div class="flex items-start space-x-3">
                        <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                        <span class="text-gray-700">Un emprendedor no necesariamente es aquel que emprende un negocio.</span>
                    </div>
                    <div class="flex items-start space-x-3">
                        <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                        <span class="text-gray-700">El emprendedor tiene retos, metas y se enfrenta a los obstáculos.</span>
                    </div>
                    <div class="flex items-start space-x-3">
                        <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                        <span class="text-gray-700">El emprendedor ya está listo para la siguiente meta y se toma cinco minutos para saborear el éxito.</span>
                    </div>
                    <div class="flex items-start space-x-3">
                        <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                        <span class="text-gray-700">Para un emprendedor y para un arquitecto de su propio destino, este reto ¡es la aventura de la vida.</span>
                    </div>
                    <div class="flex items-start space-x-3">
                        <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                        <span class="text-gray-700">Un emprendedor es un diseñador nato, un creador de él mismo.</span>
                    </div>
                </div>
            </div>
            ` : ''}
            
            ${chapter.id === 2 ? `
            <!-- Elementos para recordar de la visión -->
            <div class="mt-8 bg-blue-50 rounded-lg p-6">
                <h3 class="text-lg font-semibold text-arquitecto-navy mb-4">
                    <i class="fas fa-lightbulb mr-2"></i>Elementos para recordar de la visión
                </h3>
                <div class="space-y-3">
                    <div class="flex items-start space-x-3">
                        <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                        <span class="text-gray-700">La visión es la acción mental de visualizar nuestro futuro deseado.</span>
                    </div>
                    <div class="flex items-start space-x-3">
                        <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                        <span class="text-gray-700">La visión es un poderoso instrumento que nos orienta hacia metas u objetivos que hemos elegido, da sentido a nuestras vidas, se convierte en una brújula interior que permanentemente nos muestra el camino.</span>
                    </div>
                    <div class="flex items-start space-x-3">
                        <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                        <span class="text-gray-700">Cuando tenemos una visión clara del futuro, tenemos un sentido de vida muy definido que nos permite recorrer cada día con la libertad que nos da la fortaleza de ser quienes queremos ser.</span>
                    </div>
                    <div class="flex items-start space-x-3">
                        <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                        <span class="text-gray-700">La visión nos proporciona libertad, independencia y seguridad.</span>
                    </div>
                    <div class="flex items-start space-x-3">
                        <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                        <span class="text-gray-700">La visión La libertad se experimenta en nuestro interior cuando sabemos lo que queremos y sentimos la fortaleza de poder decidir de acuerdo a nuestras convicciones, y no con base en lo que manda el entorno.</span>
                    </div>
                    <div class="flex items-start space-x-3">
                        <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                        <span class="text-gray-700">La seguridad proviene de nuestro interior y no de nuestro exterior, se orienta más al ser que al tener.</span>
                    </div>
                </div>
             </div>
             ` : ''}
             
             ${chapter.id === 3 ? `
             <!-- Elementos para recordar en mi relación espiritual -->
             <div class="mt-8 bg-blue-50 rounded-lg p-6">
                 <h3 class="text-lg font-semibold text-arquitecto-navy mb-4">
                     <i class="fas fa-lightbulb mr-2"></i>Elementos para recordar en mi relación espiritual
                 </h3>
                 <div class="space-y-3">
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Esta parte está orientada hacia poder generar los cambios que hemos pensado.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">La gente que cree en Dios, tiene siempre la oportunidad de delegar o buscar a alguien que les ayude a resolver los problemas que se les presentan, con los cuales no se puede encontrar una solución directa.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">La comunicación que tenemos con Él, es una comunicación muy clara, transparente y sincera, se da en todas partes y en cualquier circunstancia.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Esta comunicación, es una brújula interior que nos hace ver nuestros sentimientos, debilidades, fortalezas e intenciones.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">En el diálogo interno no podemos mentir.</span>
                     </div>
                 </div>
             </div>
             
             <!-- Elementos para recordar de la regla de oro -->
             <div class="mt-6 bg-blue-50 rounded-lg p-6">
                 <h3 class="text-lg font-semibold text-arquitecto-navy mb-4">
                     <i class="fas fa-lightbulb mr-2"></i>Elementos para recordar de la regla de oro
                 </h3>
                 <div class="space-y-3">
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">"La regla de oro" y el principio consiste en "tratar a los demás como quisiéramos que nos trataran a nosotros".</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Tres preguntas para medir: ¿Es correcto?, ¿Es bueno?, ¿Es verdadero?</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">La regla de oro puede usarse por todos y puede aplicarse a todos.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Cada persona desea respeto, confianza y entendimiento.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">No hay alguien tan pequeño o tan sucio para recibir bondad y amabilidad de nuestra parte.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Tratar con diferentes tipos de personalidad parece llevar consigo un reto para practicar la regla de oro.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">El costal en el cual hemos ido acumulando al cabo del tiempo lo bueno y lo malo que hemos hecho, lo llevamos al mundo de la "Dinámica de las Relaciones", que moldea la forma en que tratamos, respetamos y nos acercamos a otros, en general, nuestra empatía con los demás.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">En ocasiones es más difícil practicar la regla de oro con las personas más cercanas.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">No permitas que el éxito o el fracaso endurezcan tu corazón o cieguen la perspectiva que tienes de otros.</span>
                     </div>
                 </div>
             </div>
             ` : ''}
             
             ${chapter.id === 4 ? `
             <!-- Elementos para recordar mi rol de hijo -->
             <div class="mt-8 bg-blue-50 rounded-lg p-6">
                 <h3 class="text-lg font-semibold text-arquitecto-navy mb-4">
                     <i class="fas fa-lightbulb mr-2"></i>Elementos para recordar mi rol de hijo
                 </h3>
                 <div class="space-y-3">
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">El de los padres es el único amor incondicional, todo a cambio de nada.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">No pierdas la maravilla de ser hijo y ellos de ser Padres.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Es necesario abrir un espacio de tiempo para ellos, recuerda que el tiempo es perecedero y que posiblemente el que te quede con ellos sea poco.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Hablar con la verdad, es la forma más sencilla y clara de comunicarse con los padres, es la llave del corazón.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Mantén comunicación con ellos: comunícales tus planes y objetivos.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Ten detalles frecuentes para tus padres. Recuerda con ellos anécdotas o vivencias de cuando eras pequeño.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Plática con tus padres de sus antepasados.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Plática con ellos de su familia y conoce de dónde vienes.</span>
                     </div>
                 </div>
             </div>
             ` : ''}
             
             ${chapter.id === 5 ? `
             <!-- Elementos para recordar en mi rol de padre -->
             <div class="mt-8 bg-blue-50 rounded-lg p-6">
                 <h3 class="text-lg font-semibold text-arquitecto-navy mb-4">
                     <i class="fas fa-lightbulb mr-2"></i>Elementos para recordar en mi rol de padre
                 </h3>
                 <div class="space-y-3">
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">El tiempo dedicado a los hijos es la mejor inversión, especialmente durante el tiempo en el que ellos tienen una dependencia muy fuerte con los Padres.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">El mejor legado que puedes hacer a tus hijos es buscar que desarrollen una visión de sí mismos y que vayan ejerciendo más y más el libre albedrío.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Construye con tus hijos de manera permanente una relación de confianza, con mucha comunicación, rodeada de amor, aceptación y una inquebrantable amistad.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">El mejor modelo de formación para ellos es el ejemplo y la congruencia. El verdadero reto como Padres es hacer que tus hijos sean mejores que tú.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Los Padres están para ayudar a los hijos a que logren sus objetivos en la vida.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Los hijos son como un jabón, si los aprietas mucho se van volando y si le aflojas de más se te caen.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Mantén comunicación con ellos, escucha sus planes y objetivos y comunícales los tuyos.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Conoce bien a los amigos de tus hijos.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Escucha sus problemas empáticamente.</span>
                     </div>
                 </div>
             </div>
             ` : ''}
             
             ${chapter.id === 6 ? `
             <!-- Elementos para recordar en mi rol de pareja -->
             <div class="mt-8 bg-blue-50 rounded-lg p-6">
                 <h3 class="text-lg font-semibold text-arquitecto-navy mb-4">
                     <i class="fas fa-lightbulb mr-2"></i>Elementos para recordar en mi rol de pareja
                 </h3>
                 <div class="space-y-3">
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Las personas cambian, tu pareja ya no es la misma que conociste hace años, ha evolucionado, tú también.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Debes cuidar a tu pareja siempre, ya que al final del camino volverán a estar como al principio: solos, uno con el otro. Lo más cercano a ti mismo, es tu familia.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Es claro que somos diferentes, pero también complementarios.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">El matrimonio es la sociedad más importante, porque de esa relación vendrán los hijos.</span>
                     </div>
                 </div>
             </div>
             ` : ''}
             
             ${chapter.id === 7 ? `
             <!-- Elementos para recordar mi rol de amigo -->
             <div class="mt-8 bg-blue-50 rounded-lg p-6">
                 <h3 class="text-lg font-semibold text-arquitecto-navy mb-4">
                     <i class="fas fa-lightbulb mr-2"></i>Elementos para recordar mi rol de amigo
                 </h3>
                 <div class="space-y-3">
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Si no mantienes una relación constante con tus amigos, pronto perderán las afinidades.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Cultiva tus amistades, -probablemente no son muchas-, pero seguramente concuerdan con tu forma de pensar.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Los hermanos tienen un papel especial.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Para que se mantenga la amistad, debe cultivarse, requiere que se le dedique tiempo.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Debe ser afín a ti, tener una visión parecida a la tuya.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Busca siempre amigos con perfil ganador.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Un ganador, es el que se parece a la visión que tú tienes de la vida, el que se parece a los principios y los valores que tú tienes.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Escoge a tus amigos igual que escoges a tu pareja.</span>
                     </div>
                 </div>
             </div>
             ` : ''}
             
             ${chapter.id === 8 ? `
             <!-- Elementos para recordar en mi rol de profesional -->
             <div class="mt-8 bg-blue-50 rounded-lg p-6">
                 <h3 class="text-lg font-semibold text-arquitecto-navy mb-4">
                     <i class="fas fa-lightbulb mr-2"></i>Elementos para recordar en mi rol de profesional
                 </h3>
                 <div class="space-y-3">
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">En el rol profesional se encierran muchos de los retos, logros, satisfacciones y motivación personal.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Una decisión muy importante en tu vida es ¿A qué me voy a dedicar una buena parte de mi vida?</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">A este rol le dedicas casi una tercera parte de tu vida productiva, de él emana el bienestar económico, porque permite generar los recursos y los satisfactores económicos.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">El rol profesional te debe conducir a dar lo mejor de ti mismo, que permanentemente te mantenga actualizado, que no te vuelva obsoleto, que te genere retos profesionales.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Busca el equilibrio en todos los cuadrantes entre lo importante y lo urgente.</span>
                     </div>
                 </div>
             </div>
             ` : ''}
             
             ${chapter.id === 9 ? `
             <!-- Elementos para recordar en mi rol ciudadano -->
             <div class="mt-8 bg-blue-50 rounded-lg p-6">
                 <h3 class="text-lg font-semibold text-arquitecto-navy mb-4">
                     <i class="fas fa-lightbulb mr-2"></i>Elementos para recordar en mi rol ciudadano
                 </h3>
                 <div class="space-y-3">
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">En este rol es en donde se puede realmente trascender.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Como ciudadano debes combatir la corrupción, la impunidad, la injusticia.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Como ciudadano debes vivir con valores y principios.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Ser ciudadano se manifiesta además en la ayuda a la gente que no tiene facilidades económicas, el apoyo a las personas que están marginadas y que requieren apoyo.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Fundamentalmente el líder es quien lo es de sí mismo.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">El líder tiene la vocación de ser justo. Vive el idealismo y el realismo simultáneamente.</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Su deseo y visión es velar por sus semejantes.</span>
                     </div>
                 </div>
             </div>
             ` : ''}
             
             ${chapter.id === 10 ? `
             <!-- Elementos para recordar en mi relación conmigo mismo -->
             <div class="mt-8 bg-blue-50 rounded-lg p-6">
                 <h3 class="text-lg font-semibold text-arquitecto-navy mb-4">
                     <i class="fas fa-lightbulb mr-2"></i>Elementos para recordar en mi relación conmigo mismo
                 </h3>
                 <div class="space-y-3">
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Agenda como herramienta que une visión con acción diaria</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Compromiso diario para ser lo que queremos llegar a ser</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">La mayor limitante somos nosotros mismos</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">"Imposible" no cabe en vocabulario de triunfador</span>
                     </div>
                     <div class="flex items-start space-x-3">
                         <i class="fas fa-check-circle text-arquitecto-blue mt-1"></i>
                         <span class="text-gray-700">Ejercicio del libre albedrío para planear, desarrollar y ejecutar visión</span>
                     </div>
                 </div>
             </div>
             ` : ''}
         `;
     }
    
    function generateLecturaContent(chapter) {
        if (chapter.id === 1) {
            // Contenido específico para el Módulo 1: El Emprendedor
            const fullText = `El emprendedor es alguien que se crece con la emoción, la tensión, el riesgo, la lucha de cada reto y, una vez superados, invierte cinco minutos en saborear su éxito antes de iniciar su próximo gran proyecto. Así, un emprendedor es un diseñador nato, un creador, es alguien que todos los días se tiene que probar a sí mismo, es aquel que entiende que cada día es un nuevo día, y que el único lugar donde el éxito viene primero que el trabajo, es en el diccionario.

¿Qué quiere decir esto?, un emprendedor es una persona que ¡está dispuesta a cambiar!, no necesariamente un emprendedor es aquel que emprende un negocio; aquí me refiero a la persona que se crece con la emoción, con la tensión, con el riesgo, con la lucha de cada reto; y ustedes se preguntarán, ¿por qué se crece con la emoción?

Porque cada vez que tenemos la oportunidad de iniciar un cambio, ya sea en lo profesional, lo personal, lo familiar, de emprender un desafío, escalar una montaña, adquirir un conocimiento, los cambios que generamos implican dejar atrás lo que hemos sido para convertirnos en lo que buscamos ser, esto definitivamente aumenta la emoción de haber encontrado un nuevo reto, la tensión y el riesgo de enfrentarlo, la lucha por dominarlo y, una vez superado, invertir cinco minutos para saborear el éxito, porque el emprendedor siempre está en constante búsqueda de nuevos retos que con los que se va diseñando a sí mismo.

Definitivamente el emprendedor siempre está buscando probarse a sí mismo, busca el límite de su capacidad y, al enfrentar estos retos, tiene claro que todos los días son un nuevo día, en donde si no se alcanzan los objetivos o si se pierde en la batalla, sabe que deberá retomar la lucha, bastándole 60 segundos a cada minuto de combate bravío.`;
            
            const words = fullText.split(' ');
            const previewText = words.slice(0, 100).join(' ');
            const remainingText = words.slice(100).join(' ');
            
            return `
                <div class="prose max-w-none">
                    <h3 class="text-xl font-bold mb-4">Lectura del Módulo</h3>
                    <div class="text-gray-700 leading-relaxed">
                        <div id="previewText"><p class="mb-4">${previewText.replace(/\n\n/g, '</p><p class="mb-4">')}</p>...</div>
                        <div id="fullText" class="hidden"><p class="mb-4">${fullText.replace(/\n\n/g, '</p><p class="mb-4">')}</p></div>
                        <button id="readMoreBtn" onclick="toggleReadMore()" class="mt-4 px-4 py-2 bg-arquitecto-blue text-white rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                            <i class="fas fa-book-open mr-2"></i>Seguir leyendo
                        </button>
                        <div class="flex space-x-3">
                            <button id="readLessBtn" onclick="toggleReadMore()" class="mt-4 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors hidden">
                                <i class="fas fa-book mr-2"></i>Leer menos
                            </button>
                            <button id="playAudioBtn" onclick="toggleAudio()" class="mt-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors hidden">
                                <i class="fas fa-play mr-2"></i>Reproducir lectura
                            </button>
                            <button id="stopAudioBtn" onclick="stopAudio()" class="mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors hidden">
                                <i class="fas fa-stop mr-2"></i>Detener lectura
                            </button>
                        </div>
                    </div>
                </div>
            `;
        } else if (chapter.id === 2) {
            // Contenido específico para el Módulo 2: La Visión
            const fullText = `La visión es un poderoso instrumento que nos orienta hacia metas u objetivos que hemos elegido, da sentido a nuestras vidas, se convierte en una brújula interior que permanentemente nos muestra el camino, guía nuestras decisiones y nos permite transitar por el camino de la vida, haciendo lo que deseamos y disfrutándola a cada momento.

Cuando tenemos una visión clara del futuro, tenemos un sentido de vida muy definido que nos permite recorrer cada día con la libertad que nos da la fortaleza de ser quienes queremos ser, dado que nos hemos facultado para tomar las decisiones que más nos convienen y que más nos acercan a nuestra visión de futuro, crecemos en la fortaleza y seguridad de nuestras acciones diarias y cuando tomamos decisiones nos preguntamos ¿Esto que voy a hacer o a decidir, me acerca a lo que yo verdaderamente deseo? En ese momento es cuando realmente experimentamos lo que es la independencia, el que nuestra vida y nuestras acciones están alineadas, y el que estamos viviendo la vida intensamente.

La visión nos proporciona libertad, independencia y seguridad, por eso una manera de ser independiente es preguntándonos ¿Cómo quiero ser?, ¿Cómo me veo? Hay que utilizar la vida de la manera en que realmente deseamos, así de este modo soy consciente de quién soy y de quién quiero ser. En ese momento declaro mi independencia de los elementos que conforman mi entorno y decido tomar lo que realmente me conduce a mi futuro deseado, a través de la visión que tengo de mí mismo.

La LIBERTAD se experimenta en nuestro interior cuando sabemos lo que queremos y sentimos la fortaleza de poder decidir de acuerdo a nuestras convicciones, y no con base en lo que manda el entorno. La libertad es la última de las condiciones humanas. Eventualmente podremos llegar a perder todo, pero siempre estará con nosotros la libertad de elegir nuestra conducta, pensamiento o acción fundamentándonos en nuestro deseo, sin importar las condiciones en que nos encontremos. La base de esta libertad es el autocontrol, hacer lo que digo que quiero ser.

La SEGURIDAD proviene de nuestro interior y no de nuestro exterior, se orienta más al ser que al tener, forma parte de una grandeza interior o primaria y está sustentada en tres elementos fundamentales: Una visión clara de futuro de quién quiero ser, cómo quiero ser y qué deseo hacer con mi vida. La libertad de elegir bajo un fuerte enfoque de autocontrol (Libre albedrío). Un fuerte desarrollo personal, profesional y económico`;
            
            const words = fullText.split(' ');
            const previewText = words.slice(0, 100).join(' ');
            const remainingText = words.slice(100).join(' ');
            
            return `
                <div class="prose max-w-none">
                    <h3 class="text-xl font-bold mb-4">Lectura del Módulo</h3>
                    <div class="text-gray-700 leading-relaxed">
                        <div id="previewText"><p class="mb-4">${previewText.replace(/\n\n/g, '</p><p class="mb-4">')}</p>...</div>
                        <div id="fullText" class="hidden"><p class="mb-4">${fullText.replace(/\n\n/g, '</p><p class="mb-4">')}</p></div>
                        <button id="readMoreBtn" onclick="toggleReadMore()" class="mt-4 px-4 py-2 bg-arquitecto-blue text-white rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                            <i class="fas fa-book-open mr-2"></i>Seguir leyendo
                        </button>
                        <div class="flex space-x-3">
                            <button id="readLessBtn" onclick="toggleReadMore()" class="mt-4 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors hidden">
                                <i class="fas fa-book mr-2"></i>Leer menos
                            </button>
                            <button id="playAudioBtn" onclick="toggleAudio()" class="mt-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors hidden">
                                <i class="fas fa-play mr-2"></i>Reproducir lectura
                            </button>
                            <button id="stopAudioBtn" onclick="stopAudio()" class="mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors hidden">
                                <i class="fas fa-stop mr-2"></i>Detener lectura
                            </button>
                        </div>
                    </div>
                </div>
            `;
        } else if (chapter.id === 3) {
            // Contenido específico para el Módulo 3: En Mi Relación con Dios
            const fullText = `En mi relación con Dios, he de verme acudiendo a Él, en el éxito y en el fracaso, ya que en Él encontraré el apoyo para transformar mis defectos en virtudes, para mejorar mi capacidad de comprensión de mí mismo y de los demás.

Dentro de la filosofía del "Arquitecto de tu Destino", tu relación con una fuerza superior o tu diálogo interno es la fuente fundamental de tu fortaleza y sabiduría. Esta es una comunicación totalmente transparente, donde es imposible mentir. Como lo ilustra el poema "El Hombre del Espejo", la persona más importante a la que debes rendir cuentas es a quien te mira de frente cada día; tu verdadera paz y satisfacción provienen de la amistad y el respeto de esa persona en el espejo.

Esa honestidad radical es la que se requiere para confrontar las poderosas fuerzas que limitan tu potencial. Estas a menudo se manifiestan en los siete defectos principales: avaricia, envidia, gula, ira, lujuria, pereza y soberbia. Estos hábitos, si no se controlan, crecen hasta tomar las riendas de tu voluntad y acabar con tus iniciativas.

Esta fortaleza interior es la que te impulsa a cambiar los hábitos que te limitan. El taller te guiará para identificar tu "Defecto Dominante": aquel mal hábito persistente que se asoma día a día y que, sin darte cuenta, puede tomar las riendas de tu voluntad.

Lejos de ser una condena, descubrir este defecto es un acto de madurez y el paso más estratégico para tu crecimiento. Aprenderás a verlo como un reto que te ofrece la oportunidad diaria de practicar la virtud contraria, permitiéndote diseñar un plan de vida mucho más efectivo para convertirte en la persona que deseas ser.

**La Regla de Oro: Tu Brújula Ética**

En la filosofía del "Arquitecto de tu Destino", la Regla de Oro es el principio universal que moldea cómo piensas y actúas. Es una guía ética que trasciende culturas y que puede ser aplicada por todos y para todos, convirtiéndose en la base para construir un comportamiento íntegro en tu vida y tu trabajo.

**Una Guía para Moldear tu Carácter**

Esta regla se convierte en la máxima para guiar tus hábitos y patrones, ayudándote a ser consciente de tus acciones para elegir deliberadamente las correctas. Para ponerla en práctica, te enfocarás en acciones concretas y poderosas:

• **Cumplir tu palabra:** Entender que tu palabra es una garantía y que cumplir tus promesas es una forma silenciosa y potente de vivir con integridad.

• **Hacer preguntas:** Aprenderás a usar el poder de las preguntas para transformar cualquier situación. Antes de actuar o comprometerte, entrenarás a tu conciencia para analizar: ¿Es bueno? ¿Es correcto? ¿Es verdadero? Tres respuestas afirmativas son la luz verde para proceder con la certeza de que estás en el camino correcto.

**Tu Brújula en Momentos Difíciles**

Cuando te sientas perdido, estancado en una "zanja" o distraído de tu plan original, la Regla de Oro actuará como tu brújula interna. Te ofrecerá una perspectiva objetiva, te apuntará de nuevo hacia tu "verdadero norte" y te ayudará a reajustar el rumbo para escalar, salir adelante y culminar la visión que has trazado para tu vida.`;
            
            const words = fullText.split(' ');
            const previewText = words.slice(0, 100).join(' ');
            const remainingText = words.slice(100).join(' ');
            
            return `
                <div class="prose max-w-none">
                    <h3 class="text-xl font-bold mb-4">Lectura del Módulo</h3>
                    <div class="text-gray-700 leading-relaxed">
                        <div id="previewText"><p class="mb-4">${previewText.replace(/\n\n/g, '</p><p class="mb-4">').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}</p>...</div>
                        <div id="fullText" class="hidden"><p class="mb-4">${fullText.replace(/\n\n/g, '</p><p class="mb-4">').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}</p></div>
                        <button id="readMoreBtn" onclick="toggleReadMore()" class="mt-4 px-4 py-2 bg-arquitecto-blue text-white rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                            <i class="fas fa-book-open mr-2"></i>Seguir leyendo
                        </button>
                        <div class="flex space-x-3">
                            <button id="readLessBtn" onclick="toggleReadMore()" class="mt-4 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors hidden">
                                <i class="fas fa-book mr-2"></i>Leer menos
                            </button>
                            <button id="playAudioBtn" onclick="toggleAudio()" class="mt-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors hidden">
                                <i class="fas fa-play mr-2"></i>Reproducir lectura
                            </button>
                            <button id="stopAudioBtn" onclick="stopAudio()" class="mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors hidden">
                                <i class="fas fa-stop mr-2"></i>Detener lectura
                            </button>
                        </div>
                    </div>
                </div>
            `;
        } else if (chapter.id === 4) {
            // Contenido específico para el Módulo 4: El Rol de Hijo
            const fullText = `Como hijo, debo ser consciente que el tiempo es lo más perecedero que existe en la vida, por lo tanto, debo convivir, disfrutar y amar al máximo a mis padres.

¿Por qué es importante convivir, amar y disfrutar al máximo a nuestros padres?

Porque no debemos perdernos la maravilla de ser hijo, porque el tiempo camina demasiado aprisa. Hay que darles la oportunidad a nuestros Padres de ser Papás y a nosotros de ser hijos, porque sólo existe una oportunidad para disfrutarnos al máximo.

Los que no tienen la dicha de tener a sus padres o solo tienen a uno de ellos, de igual manera deben buscar disfrutarlos; en todo caso, tal vez todavía tenemos abuelos o algún tío que nos trató especialmente bien, que siempre nos quiso y con quien no hemos vuelto a platicar porque envejeció.

Piensa: ¿Qué crees que te dio alguien mayor para que sientas una afinidad con él o ella?, sin dudarlo te dio lo que menos tenia, ¡te dio tiempo! Qué paradoja, si vas ahora, sí tienen tiempo, hoy incluso les sobra, pero tú ya no lo tienes. Por eso ¡es muy importante convivir, amar y disfrutar al máximo a nuestros Padres!

El amor de los Padres es el único incondicional, es el único que se entrega a cambio de nada.

Los Padres siempre estarán ahí para ayudar, escuchar, comprender, amar incondicionalmente a sus hijos; hablar con la verdad, es la forma más sencilla y clara de comunicación con ellos, es la llave de su corazón, ¡Hónralos!

Platica abiertamente con tus padres sobre lo que les pasa, porque conversar con ellos no es comunicarse con cualquiera, ahí están los mejores consejos, la experiencia y la verdad irrefutable. La verdad te lleva a mucho más que a recibir apoyo, te lleva a construir confianza, base poderosa de toda relación.`;
            
            const words = fullText.split(' ');
            const previewText = words.slice(0, 100).join(' ');
            const remainingText = words.slice(100).join(' ');
            
            return `
                <div class="prose max-w-none">
                    <h3 class="text-xl font-bold mb-4">Lectura del Módulo</h3>
                    <div class="text-gray-700 leading-relaxed">
                        <div id="previewText"><p class="mb-4">${previewText.replace(/\n\n/g, '</p><p class="mb-4">')}</p>...</div>
                        <div id="fullText" class="hidden"><p class="mb-4">${fullText.replace(/\n\n/g, '</p><p class="mb-4">')}</p></div>
                        <button id="readMoreBtn" onclick="toggleReadMore()" class="mt-4 px-4 py-2 bg-arquitecto-blue text-white rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                            <i class="fas fa-book-open mr-2"></i>Seguir leyendo
                        </button>
                        <div class="flex space-x-3">
                            <button id="readLessBtn" onclick="toggleReadMore()" class="mt-4 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors hidden">
                                <i class="fas fa-book mr-2"></i>Leer menos
                            </button>
                            <button id="playAudioBtn" onclick="toggleAudio()" class="mt-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors hidden">
                                <i class="fas fa-play mr-2"></i>Reproducir lectura
                            </button>
                            <button id="stopAudioBtn" onclick="stopAudio()" class="mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors hidden">
                                <i class="fas fa-stop mr-2"></i>Detener lectura
                            </button>
                        </div>
                    </div>
                </div>
            `;
        } else if (chapter.id === 5) {
            // Contenido específico para el Módulo 5: El Rol de Padre
            const fullText = `Como padre, debo aceptar que el ejemplo es la mejor educación para los hijos, y que el tiempo dedicado a ellos será mi mejor inversión.

El tiempo que dedicas a tus hijos es la inversión más valiosa, especialmente durante los años en que dependen de ti para formar sus creencias, hábitos y valores. Más que la cantidad de tiempo, lo que realmente importa es la calidad: momentos de atención plena y sin distracciones donde ellos sientan que son tu única prioridad.

El Poder del Ejemplo y la Congruencia

El modelo de formación por excelencia es el ejemplo. Tus hijos aprenden de lo que ven en ti; la congruencia entre lo que dices y haces es la base sobre la que construyen su carácter. Una relación cimentada en la confianza, la comunicación, el amor y la aceptación es clave para su desarrollo.

El Mejor Legado: Enseñarles a Construir su Propia Vida

El verdadero reto como padre es ayudar a tus hijos a ser mejores que tú, y el mejor legado que puedes dejarles es enseñarles la filosofía de ser los "Arquitectos de su propio destino". Tu rol es inspirarlos a que tracen su propia visión como si fuera el plano de una casa:

•	Los cimientos deben ser fuertes y sólidos.
•	Cada ladrillo simboliza una decisión que tomarán usando su libre albedrío.
•	Si las decisiones son bien tomadas, construirán una vida firme; de lo contrario, la estructura podría caer.

A medida que buscan su independencia, tu papel se transforma de proveedor a guía, apoyándolos para que logren sus propios objetivos. La relación requiere un equilibrio constante, como sostener un jabón: "si los aprietas mucho se van volando y si lo aflojas de más se te caen".`;
            
            const words = fullText.split(' ');
            const previewText = words.slice(0, 100).join(' ');
            const remainingText = words.slice(100).join(' ');
            
            return `
                <div class="prose max-w-none">
                    <h3 class="text-xl font-bold mb-4">Lectura del Módulo</h3>
                    <div class="text-gray-700 leading-relaxed">
                        <div id="previewText"><p class="mb-4">${previewText.replace(/\n\n/g, '</p><p class="mb-4">')}</p>...</div>
                        <div id="fullText" class="hidden"><p class="mb-4">${fullText.replace(/\n\n/g, '</p><p class="mb-4">')}</p></div>
                        <button id="readMoreBtn" onclick="toggleReadMore()" class="mt-4 px-4 py-2 bg-arquitecto-blue text-white rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                            <i class="fas fa-book-open mr-2"></i>Seguir leyendo
                        </button>
                        <div class="flex space-x-3">
                            <button id="readLessBtn" onclick="toggleReadMore()" class="mt-4 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors hidden">
                                <i class="fas fa-book mr-2"></i>Leer menos
                            </button>
                            <button id="playAudioBtn" onclick="toggleAudio()" class="mt-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors hidden">
                                <i class="fas fa-play mr-2"></i>Reproducir lectura
                            </button>
                            <button id="stopAudioBtn" onclick="stopAudio()" class="mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors hidden">
                                <i class="fas fa-stop mr-2"></i>Detener lectura
                            </button>
                        </div>
                    </div>
                </div>
            `;
        } else if (chapter.id === 6) {
            // Contenido específico para el Módulo 6: El Rol de Pareja
            const fullText = `Como esposo-a, debo buscar a la persona que me complemente y yo complementarla, para así, ser uno, con quien formaré la sociedad más importante de mi vida.

La filosofía del "Arquitecto de tu Destino" te invita a transformar tu enfoque en las relaciones: en lugar de buscar a la persona adecuada, concéntrate en ser tú la persona adecuada. Una relación de pareja sana se visualiza como dos líneas paralelas: dos individuos completos y libres que avanzan juntos, se apoyan y se complementan, pero nunca se entrelazan al punto de perder su propia identidad. El objetivo es crecer juntos, basados en la confianza, la libertad y la comunicación para realizarse mutuamente.

El Reto del balance y la complementariedad constante

Tanto tú como tu pareja están en constante evolución; por eso, la relación exige un esfuerzo consciente y permanente por complementarse. La pareja es la sociedad más importante que formamos, pero es fácil perder el balance, priorizando otros roles como el de padres o el profesional. Si se descuida la relación, esas líneas paralelas pueden separarse hasta que ambos se conviertan en extraños, buscando en otros lados (excesos, pasatiempos, etc.) lo que han perdido.

Tu Visión y el poder de elegir

Incluso en las decisiones más difíciles, como una separación, se ejerce el libre albedrío, un pilar de esta filosofía. La clave es la actitud con la que enfrentas cada etapa; no siempre puedes elegir lo que vives, pero sí puedes elegir cómo lo vives, eliminando el ego y reconociendo lo aprendido. Para quienes aún no tienen pareja, el primer paso es trazar su propia visión de vida, y a partir de ahí, buscar a alguien que sea empático y complementario a ese futuro que desean construir.`;
            
            const words = fullText.split(' ');
            const previewText = words.slice(0, 100).join(' ');
            const remainingText = words.slice(100).join(' ');
            
            return `
                <div class="prose max-w-none">
                    <h3 class="text-xl font-bold mb-4">Lectura del Módulo</h3>
                    <div class="text-gray-700 leading-relaxed">
                        <div id="previewText"><p class="mb-4">${previewText.replace(/\n\n/g, '</p><p class="mb-4">')}</p>...</div>
                        <div id="fullText" class="hidden"><p class="mb-4">${fullText.replace(/\n\n/g, '</p><p class="mb-4">')}</p></div>
                        <button id="readMoreBtn" onclick="toggleReadMore()" class="mt-4 px-4 py-2 bg-arquitecto-blue text-white rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                            <i class="fas fa-book-open mr-2"></i>Seguir leyendo
                        </button>
                        <div class="flex space-x-3">
                            <button id="readLessBtn" onclick="toggleReadMore()" class="mt-4 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors hidden">
                                <i class="fas fa-book mr-2"></i>Leer menos
                            </button>
                            <button id="playAudioBtn" onclick="toggleAudio()" class="mt-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors hidden">
                                <i class="fas fa-play mr-2"></i>Reproducir lectura
                            </button>
                            <button id="stopAudioBtn" onclick="stopAudio()" class="mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors hidden">
                                <i class="fas fa-stop mr-2"></i>Detener lectura
                            </button>
                        </div>
                    </div>
                </div>
            `;
        } else if (chapter.id === 7) {
            // Contenido específico para el Módulo 7: El Rol de Amigo
            const fullText = `Como amigo, debo recordar que la amistad es uno de los mayores tesoros de la vida y se debe cultivar.

Las personas cambian

En el capítulo anterior de "Arquitecto de tu destino" comentamos que las personas cambian. Con los amigos la situación es igual, si no se mantiene una relación constante, pronto se perderán las afinidades y, tal vez, sólo se compartirán algunas anécdotas del pasado. Eso tomará algunos minutos, a lo sumo un par de horas de risas y alegría por los buenos recuerdos y luego... ¿de qué hablamos...¡Ah!...de lo que estoy haciendo ahora, de cómo me ha ido y posiblemente de qué planes futuros tengo, pero lo más probable es que la conversación llegue hasta ahí, la despedida y hasta la próxima vez.

Sin duda fue una agradable convivencia, pero claramente los lazos de amistad se han relajado.

Las amistades deben cultivase, probablemente no son muchas, pero seguramente concuerdan con tu forma de pensar. Además, es necesario ser cuidadosos y no equivocarse, un error puede acarrear enormes problemas.

Un amigo es el que tiene una visión similar a la tuya, es el que se parece a lo que TÚ quieres de la vida, el que aprecia los principios y valores que tú prácticas, el que los refuerza, el que te apoya para salir adelante.

Los verdaderos amigos requieren tiempo, necesitan cultivarse, que te acuerdes de ellos para ir a la fiesta, al bautizo, de pesca, al boliche, reunirse con los hijos, requieren tu presencia en el éxito, el dolor, el fracaso y la dicha; llegarán a tu funeral y se irán hasta el final, cuando caiga la última carretada de tierra. Están contigo en las buenas y en las malas.

Trátalos con cariño, cuidado, respeto, convive con ellos en diferentes ámbitos: en lo profesional y en lo familiar. Cuando algún amigo te pida un consejo, medítalo a profundidad, siente la responsabilidad de la respuesta que le darás porque, asentado en la confianza que siente hacia ti, probablemente te haga caso.`;
            
            const words = fullText.split(' ');
            const previewText = words.slice(0, 100).join(' ');
            const remainingText = words.slice(100).join(' ');
            
            return `
                <div class="prose max-w-none">
                    <h3 class="text-xl font-bold mb-4">Lectura del Módulo</h3>
                    <div class="text-gray-700 leading-relaxed">
                        <div id="previewText"><p class="mb-4">${previewText.replace(/\n\n/g, '</p><p class="mb-4">')}</p>...</div>
                        <div id="fullText" class="hidden"><p class="mb-4">${fullText.replace(/\n\n/g, '</p><p class="mb-4">')}</p></div>
                        <button id="readMoreBtn" onclick="toggleReadMore()" class="mt-4 px-4 py-2 bg-arquitecto-blue text-white rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                            <i class="fas fa-book-open mr-2"></i>Seguir leyendo
                        </button>
                        <div class="flex space-x-3">
                            <button id="readLessBtn" onclick="toggleReadMore()" class="mt-4 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors hidden">
                                <i class="fas fa-book mr-2"></i>Leer menos
                            </button>
                            <button id="playAudioBtn" onclick="toggleAudio()" class="mt-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors hidden">
                                <i class="fas fa-play mr-2"></i>Reproducir lectura
                            </button>
                            <button id="stopAudioBtn" onclick="stopAudio()" class="mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors hidden">
                                <i class="fas fa-stop mr-2"></i>Detener lectura
                            </button>
                        </div>
                    </div>
                </div>
            `;
        } else if (chapter.id === 8) {
            // Contenido específico para el Módulo 8: El Rol Profesional
            const fullText = `Como profesional ¿Cuál será el campo en el que quiero desarrollarme? El que me genere los suficientes retos para mantenerme motivado, con el cual sienta que puedo desarrollarme plenamente y dar lo mejor de mí.

Tu rol profesional es uno de los pilares de tu vida. Le dedicas casi un tercio de tu tiempo productivo, y de él emana tu bienestar económico y el de tu familia. Por ello, elegir a qué te vas a dedicar es una de las decisiones más fundamentales que tomarás como Arquitecto de tu Destino.

Una Visión Clara y el Reto Constante

Para desarrollarte plenamente, necesitas una visión profesional que te permita analizar constantemente: ¿Siento agrado por lo que hago? ¿Estoy dando lo mejor de mí? ¿A dónde quiero llegar?. Tu carrera debe ser un reto constante que te motive y te mantenga en formación continua para no volverte obsoleto. Aunque adquirir nuevas herramientas es importante, lo que realmente define el éxito son los resultados.

La Fórmula del Éxito y el Equilibrio

El éxito profesional sostenible se basa en entender una fórmula clara: el trabajo diario conduce al desarrollo profesional; este a su vez genera estabilidad económica, y esta fortalece la solidez personal y familiar. Para evitar la frustración y el desequilibrio que llevan al estrés y la sensación de crisis permanente, es crucial mantener un balance entre el carácter y la competencia: ser una persona de valores y principios, y al mismo tiempo, ser competente, con los conocimientos y habilidades para generar resultados positivos.`;
            
            const words = fullText.split(' ');
            const previewText = words.slice(0, 100).join(' ');
            const remainingText = words.slice(100).join(' ');
            
            return `
                <div class="prose max-w-none">
                    <h3 class="text-xl font-bold mb-4">Lectura del Módulo</h3>
                    <div class="text-gray-700 leading-relaxed">
                        <div id="previewText"><p class="mb-4">${previewText.replace(/\n\n/g, '</p><p class="mb-4">')}</p>...</div>
                        <div id="fullText" class="hidden"><p class="mb-4">${fullText.replace(/\n\n/g, '</p><p class="mb-4">')}</p></div>
                        <button id="readMoreBtn" onclick="toggleReadMore()" class="mt-4 px-4 py-2 bg-arquitecto-blue text-white rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                            <i class="fas fa-book-open mr-2"></i>Seguir leyendo
                        </button>
                        <div class="flex space-x-3">
                            <button id="readLessBtn" onclick="toggleReadMore()" class="mt-4 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors hidden">
                                <i class="fas fa-book mr-2"></i>Leer menos
                            </button>
                            <button id="playAudioBtn" onclick="toggleAudio()" class="mt-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors hidden">
                                <i class="fas fa-play mr-2"></i>Reproducir lectura
                            </button>
                            <button id="stopAudioBtn" onclick="stopAudio()" class="mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors hidden">
                                <i class="fas fa-stop mr-2"></i>Detener lectura
                            </button>
                        </div>
                    </div>
                </div>
            `;
        } else if (chapter.id === 9) {
            // Contenido específico para el Módulo 9: Conmigo Mismo
            const fullText = `Como ciudadano, debo cumplir con mis obligaciones para poder exigir respeto a mis derechos.

En este rol también puedes trascender, porque en el rol de ciudadano, es posible hacer aportaciones importantes al entorno: desde acciones muy propias y personales hasta acciones de alto impacto y contenido social.

Como ciudadano debes combatir la corrupción, la impunidad y la injusticia. Una manera de hacerlo es a través de aportes en bien de tu comunidad: por medio de asociaciones de padres, de vecinos, de comerciantes, participando en eventos cívicos donde se requiera la acción ciudadana, entre otros.

Como ciudadano además debes vivir los valores y principios; si quieres un entorno más agradable, sin tanta corrupción, inseguridad y desorden, contribuye no siendo corrupto, practicando la integridad y el orden.

Ser ciudadano se manifiesta, además, en la ayuda a la gente que no tiene facilidades económicas, el apoyo a las personas que están marginadas y que requieren apoyo. Estas acciones pueden incluso impulsar tu liderazgo.

Fundamentalmente el líder es quien lo es de sí mismo, (para poder ser el "Arquitecto de tu destino" tengo que ser líder de mí mismo). Líder es aquel que se respeta y forja su carácter, es un guía que conduce hacia el bien común, porque el líder tiene la vocación de ser justo, ¿qué es lo justo? es el deber ser, escoger lo bueno sobre lo malo, es quien con su entrega y entusiasmo mueve corazones, es esa persona que verdaderamente hace lo que dice, y por eso cuando habla y se entrega, la gente le cree. Es el que, reconociendo su responsabilidad social día a día se supera. Un líder es visto por la gente y ve que lo que hace el líder está bien.

La Relación Contigo Mismo: Tu Salud, el Cimiento de tu Destino

Tu relación contigo mismo comienza con el activo más importante que posees: tu salud. Imagina que tu salud es el número "1", y todos tus demás bienes (familia, trabajo, inteligencia) son ceros a la derecha. Sin ese "1" inicial, todo lo demás pierde su valor. Tu cuerpo es la fabulosa máquina y el "carruaje" que te llevará a cumplir la visión de tu vida; no tienes un repuesto y debes darle el mantenimiento adecuado.

El Equilibrio a Través de los "Alimentos Primarios"

El objetivo no es la renuncia a lo que te gusta, sino alcanzar un equilibrio integral a través de la moderación. La verdadera salud combina el bienestar físico, emocional y mental. Para lograrlo, debes nutrirte con los "alimentos primarios": aquellas áreas no alimentarias que realmente te satisfacen a un nivel profundo, como tu profesión, tus relaciones, la actividad física y tu práctica espiritual. Si estas áreas no están en balance, es imposible mantener un bienestar sostenible.

El Poder de los Pequeños Hábitos y la Fuerza de Voluntad

El camino para mejorar tu bienestar es a través de la creación de pequeños hábitos que, juntos, forman un cambio gigante. Empieza con uno a la vez: una dieta más saludable, ejercicio regular, dormir lo suficiente, etc.. El secreto de la salud es el autocuidado, y el secreto del autocuidado es la fuerza de voluntad. No te lamentes por el pasado; dedica el 99% de tu energía a corregir y mejorar tus conductas.

Como afirmaba Erich Fromm, en el arte de vivir, eres al mismo tiempo el escultor y el mármol. Cada hábito saludable es un golpe de cincel que, aunque a veces duela, te aproxima a la figura de la persona que has visualizado ser. En tus manos está el poder de esculpir tu progreso.`;
            
            const words = fullText.split(' ');
            const previewText = words.slice(0, 100).join(' ');
            const remainingText = words.slice(100).join(' ');
            
            return `
                <div class="prose max-w-none">
                    <h3 class="text-xl font-bold mb-4">Lectura del Módulo</h3>
                    <div class="text-gray-700 leading-relaxed">
                        <div id="previewText"><p class="mb-4">${previewText.replace(/\n\n/g, '</p><p class="mb-4">')}</p>...</div>
                        <div id="fullText" class="hidden"><p class="mb-4">${fullText.replace(/\n\n/g, '</p><p class="mb-4">')}</p></div>
                        <button id="readMoreBtn" onclick="toggleReadMore()" class="mt-4 px-4 py-2 bg-arquitecto-blue text-white rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                            <i class="fas fa-book-open mr-2"></i>Seguir leyendo
                        </button>
                        <div class="flex space-x-3">
                            <button id="readLessBtn" onclick="toggleReadMore()" class="mt-4 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors hidden">
                                <i class="fas fa-book mr-2"></i>Leer menos
                            </button>
                            <button id="playAudioBtn" onclick="toggleAudio()" class="mt-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors hidden">
                                <i class="fas fa-play mr-2"></i>Reproducir lectura
                            </button>
                            <button id="stopAudioBtn" onclick="stopAudio()" class="mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors hidden">
                                <i class="fas fa-stop mr-2"></i>Detener lectura
                            </button>
                        </div>
                    </div>
                </div>
            `;
        } else if (chapter.id === 10) {
            // Contenido específico para el Módulo 10: Conclusiones
            const fullText = `La Visión que generarás de ti mismo, debe ser de la persona que quieres llegar a ser. Partiendo de hoy, debes trabajar día con día, mes con mes, año con año para poder alcanzar las metas que has planeado, es importante mencionar que la mayor limitante que podrás encontrar, serás tú mismo, cuando al enfrentar algún reto, algún problema, se te vengan a la mente las palabras "no puedo," en ese momento estarás estableciendo el límite de tu capacidad.

La palabra "imposible" no cabe en el vocabulario de un triunfador. La falacia de que el destino está escrito, es la excusa del que fracasa, en cambio el triunfador es aquel que ha sido capaz de planear, desarrollar y ejecutar su visión a través del ejercicio de uno de los dones más hermosos que Dios nos ha concedido: "El Libre Albedrío".

Con esto, tú también podrás convertirte en el "Arquitecto de tu Destino" y "ser lo que quieras llegar a ser".`;
            
            const words = fullText.split(' ');
            const previewText = words.slice(0, 100).join(' ');
            const remainingText = words.slice(100).join(' ');
            
            return `
                <div class="prose max-w-none">
                    <h3 class="text-xl font-bold mb-4">Lectura del Módulo</h3>
                    <div class="text-gray-700 leading-relaxed">
                        <div id="previewText"><p class="mb-4">${previewText.replace(/\n\n/g, '</p><p class="mb-4">')}</p>...</div>
                        <div id="fullText" class="hidden"><p class="mb-4">${fullText.replace(/\n\n/g, '</p><p class="mb-4">')}</p></div>
                        <button id="readMoreBtn" onclick="toggleReadMore()" class="mt-4 px-4 py-2 bg-arquitecto-blue text-white rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                            <i class="fas fa-book-open mr-2"></i>Seguir leyendo
                        </button>
                        <div class="flex space-x-3">
                            <button id="readLessBtn" onclick="toggleReadMore()" class="mt-4 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors hidden">
                                <i class="fas fa-book mr-2"></i>Leer menos
                            </button>
                            <button id="playAudioBtn" onclick="toggleAudio()" class="mt-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                <i class="fas fa-play mr-2"></i>Reproducción de lectura
                            </button>
                            <button id="stopAudioBtn" onclick="stopAudio()" class="mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors hidden">
                                <i class="fas fa-stop mr-2"></i>Detener lectura
                            </button>
                        </div>
                    </div>
                </div>
            `;
        } else {
            // Contenido genérico para otros módulos
            return `
                <div class="prose max-w-none">
                    <h3 class="text-xl font-bold mb-4">Lectura del Módulo</h3>
                    <p class="text-gray-700 leading-relaxed mb-6">${chapter.description}</p>
                </div>
            `;
        }
    }
    
    function generateReflexionContent(chapter) {
        // Las mismas 4 preguntas para todos los módulos
        const savedReflections = JSON.parse(localStorage.getItem(getUserKey(`reflection_${chapter.id}`)) || '{}');
        
        return `
            <div class="space-y-6">
                <h3 class="text-xl font-bold">Reflexión Personal</h3>
                
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-6 rounded-r-lg">
                    <h4 class="font-semibold mb-3">Preguntas generales de reflexión:</h4>
                    <div class="space-y-4">
                        <div>
                            <p class="font-medium text-gray-800 mb-2">¿Qué aprendizaje principal obtuve de este módulo?</p>
                            <textarea id="reflection_${chapter.id}_q1" class="w-full p-3 border border-gray-300 rounded-lg" rows="3" placeholder="Escribe tu reflexión aquí...">${savedReflections.q1 || ''}</textarea>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800 mb-2">¿Cómo puedo aplicar esto en mi vida diaria?</p>
                            <textarea id="reflection_${chapter.id}_q2" class="w-full p-3 border border-gray-300 rounded-lg" rows="3" placeholder="Escribe tu reflexión aquí...">${savedReflections.q2 || ''}</textarea>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800 mb-2">¿Qué cambio específico voy a implementar?</p>
                            <textarea id="reflection_${chapter.id}_q3" class="w-full p-3 border border-gray-300 rounded-lg" rows="3" placeholder="Escribe tu reflexión aquí...">${savedReflections.q3 || ''}</textarea>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800 mb-2">¿Qué obstáculos podría encontrar y cómo los superaré?</p>
                            <textarea id="reflection_${chapter.id}_q4" class="w-full p-3 border border-gray-300 rounded-lg" rows="3" placeholder="Escribe tu reflexión aquí...">${savedReflections.q4 || ''}</textarea>
                        </div>
                    </div>
                </div>
                
                <button onclick="saveModuleReflection(${chapter.id})" class="px-6 py-3 bg-arquitecto-blue text-white rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                    <i class="fas fa-save mr-2"></i>Guardar Reflexión
                </button>
            </div>
        `;
    }
    
    function generateEjercicioContent(chapter) {
        if (chapter.id === 1) {
            // Contenido específico para el Módulo 1: El Emprendedor
            const savedExercise = JSON.parse(localStorage.getItem(getUserKey(`exercise_${chapter.id}`)) || '{}');
            const savedGoals = savedExercise.goals || [
                { meta: '', fecha: '' },
                { meta: '', fecha: '' },
                { meta: '', fecha: '' }
            ];
            
            return `
                <div class="space-y-6">
                    <h3 class="text-xl font-bold">Ejercicios Prácticos</h3>
                    
                    <div class="bg-blue-50 border-l-4 border-blue-400 p-6 rounded-r-lg">
                        <h4 class="font-semibold mb-3">Ejercicio del Módulo:</h4>
                        <p class="text-gray-700 mb-4">Piénsalo detenidamente y escribe qué cosas cambiarías de ti en cuanto a conductas, hábitos, creencias, resultados, imagen, etc. y escríbelas en los siguientes espacios.</p>
                        <p class="text-gray-700 mb-6 font-medium">Qué cosas deseas cambiar, mejorar o fortalecer en:</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Lo profesional:</label>
                                <textarea id="exercise_1_profesional" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Escribe aquí...">${savedExercise.profesional || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">En lo personal (física, espiritual):</label>
                                <textarea id="exercise_1_personal" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Escribe aquí...">${savedExercise.personal || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">En lo familiar:</label>
                                <textarea id="exercise_1_familiar" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Escribe aquí...">${savedExercise.familiar || ''}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tabla de Metas -->
                    <div class="bg-white border border-gray-200 rounded-lg p-6">
                        <p class="font-semibold text-gray-800 mb-4">Detalla tus metas para cada ámbito y señala fecha de realización:</p>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full border-collapse border border-gray-300">
                                <thead>
                                    <tr class="bg-gray-100">
                                        <th class="border border-gray-300 p-3 text-center font-semibold w-16">No.</th>
                                        <th class="border border-gray-300 p-3 text-center font-semibold">Metas</th>
                                        <th class="border border-gray-300 p-3 text-center font-semibold w-40">Cuando</th>
                                    </tr>
                                </thead>
                                <tbody id="goalsTableBody">
                                    ${savedGoals.map((goal, index) => `
                                        <tr>
                                            <td class="border border-gray-300 p-3 text-center font-medium">${index + 1}</td>
                                            <td class="border border-gray-300 p-2">
                                                <textarea class="w-full p-2 border-0 resize-none focus:outline-none goal-meta" 
                                                          rows="2" placeholder="Describe tu meta..." data-index="${index}">${goal.meta}</textarea>
                                            </td>
                                            <td class="border border-gray-300 p-2 text-center">
                                                <input type="date" class="w-full p-2 border-0 focus:outline-none goal-fecha" 
                                                       value="${goal.fecha}" data-index="${index}">
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="mt-4 text-center">
                            <button id="addGoalBtn" onclick="addGoalRow()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                <i class="fas fa-plus mr-2"></i>Agregar Meta
                            </button>
                        </div>
                    </div>
                    
                    <button onclick="saveModuleExercise(${chapter.id})" class="px-6 py-3 bg-arquitecto-navy text-white rounded-lg hover:bg-arquitecto-navy-dark transition-colors">
                        <i class="fas fa-dumbbell mr-2"></i>Completar Ejercicio
                    </button>
                </div>
            `;
        } else if (chapter.id === 2) {
            // Contenido específico para el Módulo 2: La Visión
            const savedExercise = JSON.parse(localStorage.getItem(getUserKey(`exercise_${chapter.id}`)) || '{}');
            
            return `
                <div class="space-y-6">
                    <h3 class="text-xl font-bold">Ejercicios Prácticos</h3>
                    
                    <div class="bg-blue-50 border-l-4 border-blue-400 p-6 rounded-r-lg">
                        <h4 class="font-semibold mb-3">Ejercicio del Módulo:</h4>
                        <p class="text-gray-700 mb-4">A partir de la reflexión que nos ofrece el texto de La Visión, habrá que iniciar un proceso mucho más profundo, por lo que, a partir de lo que eres hoy, responde las siguientes cuestiones y elabora tu Visión para los siguientes periodos de tiempo.</p>
                        <p class="text-gray-700 mb-6 font-medium">Considera que tu visión de cada periodo deberá contribuir a alcanzar tu visión del siguiente:</p>
                        
                        <!-- Ejercicio 1: Visión temporal -->
                        <div class="mb-6">
                            <label class="block font-medium text-gray-800 mb-2">¿Cuál es la visión que tengo de mí mismo en los próximos 1, 3, 5 y 10 años?</label>
                            <textarea id="exercise_2_vision_temporal" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe tu visión para cada período...">${savedExercise.vision_temporal || ''}</textarea>
                        </div>
                        
                        <!-- Ejercicio 2: Entorno deseado -->
                        <div class="mb-6">
                            <div class="bg-gray-50 p-4 rounded-lg mb-3">
                                <p class="text-gray-700 text-sm mb-2"><strong>Contexto:</strong> Piensa en el entorno que desearías tener para los próximos 1, 3, 5 o 10 años, piensa en lo que tú más desearías ser o tener. Incluye diversos aspectos de tu persona, como la Pareja, Hijos, Padres, Familia, Hermanos, Trabajo, posesiones, logros personales, posiciones, aspectos sociales, etc. Lo que tú redactes, te debes llenar plenamente, debe reflejar lo que Tú eres y lo que Tú piensas, busca que tu redacción sea inspiradora y alentadora.</p>
                            </div>
                            <label class="block font-medium text-gray-800 mb-2">Responde para cada período: 1, 3, 5 y 10 años (Personal / Familiar / Profesional)</label>
                            <textarea id="exercise_2_entorno_deseado" class="w-full p-3 border border-gray-300 rounded-lg" rows="8" placeholder="Describe detalladamente tu entorno deseado para cada período...">${savedExercise.entorno_deseado || ''}</textarea>
                        </div>
                    </div>
                    
                    <!-- Ejercicio 3: Análisis FODA -->
                    <div class="bg-white border border-gray-200 rounded-lg p-6">
                        <h4 class="font-semibold mb-3">Análisis FODA Personal</h4>
                        <p class="text-gray-700 text-sm mb-4">Efectúa un profundo análisis de tu persona y escribe en el cuadro correspondiente tus calificativos, posterior a ello, a cada concepto en la parte extrema derecha dales un valor. La suma de todos por columna no debe exceder el número cien, esto sirve para que tú puedas ver con claridad cuál fortaleza o debilidad tiene más peso y desarrolles la estrategia correcta para que, apoyándote en tu fortaleza, puedas hacer frente y minimizar esa debilidad.</p>
                        
                        <div id="fodaAnalysis">
                            ${generateFODATable(savedExercise.foda || {})}
                        </div>
                        
                        <div class="mt-4 text-center">
                            <button onclick="saveModuleExercise(${chapter.id})" class="px-6 py-3 bg-arquitecto-navy text-white rounded-lg hover:bg-arquitecto-navy-dark transition-colors">
                                <i class="fas fa-dumbbell mr-2"></i>Completar Ejercicio
                            </button>
                        </div>
                    </div>
                </div>
            `;
        } else if (chapter.id === 3) {
            // Contenido específico para el Módulo 3: En Mi Relación con Dios
            const savedExercise = JSON.parse(localStorage.getItem(getUserKey(`exercise_${chapter.id}`)) || '{}');
            
            return `
                <div class="space-y-6">
                    <h3 class="text-xl font-bold">Ejercicios Prácticos</h3>
                    
                    <div class="bg-blue-50 border-l-4 border-blue-400 p-6 rounded-r-lg">
                        <h4 class="font-semibold mb-3">Ejercicios del Módulo:</h4>
                        <p class="text-gray-700 mb-6">Completa los siguientes ejercicios para profundizar en tu relación espiritual y transformación personal.</p>
                        
                        <div class="space-y-6">
                            <!-- Ejercicio 1 -->
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">1. Enlista y describe tus defectos dominantes:</label>
                                <textarea id="exercise_3_defectos" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe tus defectos dominantes...">${savedExercise.defectos_dominantes || ''}</textarea>
                            </div>
                            
                            <!-- Ejercicio 2 -->
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">2. Enlista siete placeres que las personas buscan regularmente:</label>
                                <textarea id="exercise_3_placeres" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Lista los siete placeres...">${savedExercise.placeres_regulares || ''}</textarea>
                            </div>
                            
                            <!-- Ejercicio 3 -->
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">3. ¿Cómo el buscar placer puede estropear tu habilidad de seguir La regla de oro?</label>
                                <textarea id="exercise_3_placer_regla" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Explica cómo el placer puede afectar la regla de oro...">${savedExercise.placer_regla_oro || ''}</textarea>
                            </div>
                            
                            <!-- Ejercicio 4 -->
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">4. ¿Por qué crees que el placer es tan atrayente?</label>
                                <textarea id="exercise_3_atractivo" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Reflexiona sobre el atractivo del placer...">${savedExercise.atractivo_placer || ''}</textarea>
                            </div>
                            
                            <!-- Ejercicio 5 -->
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">5. Evalúate. ¿Hay placeres en particular que te hacen comprometer la regla de oro?</label>
                                <textarea id="exercise_3_comprometen" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Identifica placeres que comprometen tus valores...">${savedExercise.placeres_comprometen || ''}</textarea>
                            </div>
                            
                            <!-- Ejercicio 6 -->
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">6. Después de identificar esos placeres, medita: ¿qué necesidad estás tratando de llenar? ¿hay alguna forma propia para llenar esta necesidad y evitar el compromiso?</label>
                                <textarea id="exercise_3_necesidad" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Reflexiona sobre las necesidades detrás de esos placeres...">${savedExercise.necesidad_llenar || ''}</textarea>
                            </div>
                            
                            <!-- Ejercicio 7 -->
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">7. ¿Tienes una brújula moral interna que pueda ayudarte cuando tu decisión tiene que venir del corazón, no sólo de la cabeza? Defínela.</label>
                                <textarea id="exercise_3_brujula" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Define tu brújula moral interna...">${savedExercise.brujula_moral || ''}</textarea>
                            </div>
                            
                            <!-- Ejercicio 8 -->
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">8. ¿Por qué las decisiones éticas a veces son un poco difusas? Reflexiona</label>
                                <textarea id="exercise_3_difusas" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Reflexiona sobre la complejidad de las decisiones éticas...">${savedExercise.decisiones_difusas || ''}</textarea>
                            </div>
                            
                            <!-- Ejercicio 9 - Con subtemas -->
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">9. ¿Alguna vez has necesitado guía y dirección por causa de una de estas situaciones?</label>
                                <div class="space-y-3 ml-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">a. Nos sentimos perdidos:</label>
                                        <input type="text" id="exercise_3_perdidos" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Describe tu experiencia..." value="${savedExercise.situaciones_guia?.perdidos || ''}">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">b. Nos confundimos y nos sentimos agobiados:</label>
                                        <input type="text" id="exercise_3_confundidos" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Describe tu experiencia..." value="${savedExercise.situaciones_guia?.confundidos || ''}">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">c. Nos quedamos estancados en la zanja:</label>
                                        <input type="text" id="exercise_3_estancados" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Describe tu experiencia..." value="${savedExercise.situaciones_guia?.estancados || ''}">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">d. Olvidamos nuestro plan original y nos distraemos:</label>
                                        <input type="text" id="exercise_3_distraidos" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Describe tu experiencia..." value="${savedExercise.situaciones_guia?.distraidos || ''}">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">e. Necesitamos saber lo que es verdadero, correcto y bueno:</label>
                                        <input type="text" id="exercise_3_verdadero" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Describe tu experiencia..." value="${savedExercise.situaciones_guia?.verdadero || ''}">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Ejercicio 10 -->
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">10. ¿Qué es lo que generalmente usas para ayudarte a navegar durante tu viaje?</label>
                                <textarea id="exercise_3_navegacion" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe tus herramientas de navegación personal...">${savedExercise.navegacion_viaje || ''}</textarea>
                            </div>
                            
                            <!-- Ejercicio 11 -->
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">11. ¿Cómo te ha ayudado la regla de oro a tomar una decisión cuando todo estaba nublado, estabas confundido, o simplemente perdido?</label>
                                <textarea id="exercise_3_regla_decision" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Comparte tu experiencia con la regla de oro...">${savedExercise.regla_oro_decision || ''}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="saveModuleExercise(${chapter.id})" class="px-6 py-3 bg-arquitecto-navy text-white rounded-lg hover:bg-arquitecto-navy-dark transition-colors">
                        <i class="fas fa-dumbbell mr-2"></i>Completar Ejercicio
                    </button>
                </div>
            `;
        } else if (chapter.id === 4) {
            // Contenido específico para el Módulo 4: El Rol de Hijo
            const savedExercise = JSON.parse(localStorage.getItem(getUserKey(`exercise_${chapter.id}`)) || '{}');
            
            return `
                <div class="space-y-6">
                    <h3 class="text-xl font-bold">Ejercicios Prácticos</h3>
                    
                    <div class="bg-blue-50 border-l-4 border-blue-400 p-6 rounded-r-lg">
                        <h4 class="font-semibold mb-3">Ejercicios del Módulo:</h4>
                        <p class="text-gray-700 mb-6">Instrucciones. - Analiza con todo cuidado las siguientes preguntas, contéstalas lo más detalladamente posible y anota qué acciones tomarás para que las cosas sucedan como tú lo deseas.</p>
                        
                        <div class="space-y-6">
                            <!-- Ejercicio 1 -->
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">¿Cómo es la relación con mis padres actualmente?</label>
                                <textarea id="exercise_4_relacion_actual" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe detalladamente cómo es tu relación actual con tus padres...">${savedExercise.relacion_actual || ''}</textarea>
                            </div>
                            
                            <!-- Ejercicio 2 -->
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">¿Cómo deseo que sea la relación con mis padres a partir de ahora?</label>
                                <textarea id="exercise_4_relacion_deseada" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe cómo deseas que sea tu relación con tus padres...">${savedExercise.relacion_deseada || ''}</textarea>
                            </div>
                            
                            <!-- Ejercicio 3 -->
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">¿Cómo me visualizo siendo hijo dentro de 3 a 5 años?</label>
                                <textarea id="exercise_4_vision_futuro" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Visualiza y describe cómo te ves siendo hijo en el futuro...">${savedExercise.vision_futuro || ''}</textarea>
                            </div>
                            
                            <!-- Ejercicio 4 -->
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">¿Qué acciones emprenderé para que se cumpla esta visión? Escribe la acción, fecha de inicio, frecuencia, fecha fin.</label>
                                <textarea id="exercise_4_acciones_plan" class="w-full p-3 border border-gray-300 rounded-lg" rows="5" placeholder="Detalla las acciones específicas con fechas, frecuencia y plazos...">${savedExercise.acciones_plan || ''}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="saveModuleExercise(${chapter.id})" class="px-6 py-3 bg-arquitecto-navy text-white rounded-lg hover:bg-arquitecto-navy-dark transition-colors">
                        <i class="fas fa-dumbbell mr-2"></i>Completar Ejercicio
                    </button>
                </div>
            `;
        } else if (chapter.id === 5) {
            // Contenido específico para el Módulo 5: El Rol de Padre
            const savedExercise = JSON.parse(localStorage.getItem(getUserKey(`exercise_${chapter.id}`)) || '{}');
            
            return `
                <div class="space-y-6">
                    <h3 class="text-xl font-bold">Ejercicios Prácticos</h3>
                    
                    <div class="bg-blue-50 border-l-4 border-blue-400 p-6 rounded-r-lg">
                        <h4 class="font-semibold mb-3">Ejercicio del Módulo:</h4>
                        <p class="text-gray-700 mb-4">Instrucciones. - Analiza con todo cuidado las siguientes preguntas, contéstalas y anota qué acciones tomarás para que las cosas sucedan como tú lo deseas. Tómate tiempo, reflexiona a profundidad y diseña acciones concretas, medibles y realizables.</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">1. ¿Cómo es la relación con mis hijos actualmente? Defínela reflexionando sobre lo que te gusta de ella y lo que no te gusta.</label>
                                <textarea id="exercise_5_relacion_actual" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe cómo es actualmente tu relación con tus hijos...">${savedExercise.relacion_actual || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">2. ¿Cómo deseo que sea la relación con mis hijos?</label>
                                <textarea id="exercise_5_relacion_deseada" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe cómo deseas que sea la relación con tus hijos...">${savedExercise.relacion_deseada || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">3. ¿Cómo los visualizo dentro de 3 o 5 años?</label>
                                <textarea id="exercise_5_vision_futuro" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Visualiza cómo quieres que sean tus hijos en el futuro...">${savedExercise.vision_futuro || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">4. ¿Qué acciones emprenderé para que se cumpla esta visión?</label>
                                <textarea id="exercise_5_acciones_plan" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Define las acciones específicas que tomarás...">${savedExercise.acciones_plan || ''}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="saveModuleExercise(${chapter.id})" class="px-6 py-3 bg-arquitecto-navy text-white rounded-lg hover:bg-arquitecto-navy-dark transition-colors">
                        <i class="fas fa-dumbbell mr-2"></i>Completar Ejercicio
                    </button>
                </div>
            `;
        } else if (chapter.id === 6) {
            // Contenido específico para el Módulo 6: El Rol de Pareja
            const savedExercise = JSON.parse(localStorage.getItem(getUserKey(`exercise_${chapter.id}`)) || '{}');
            
            return `
                <div class="space-y-6">
                    <h3 class="text-xl font-bold">Ejercicios Prácticos</h3>
                    
                    <div class="bg-blue-50 border-l-4 border-blue-400 p-6 rounded-r-lg">
                        <h4 class="font-semibold mb-3">Ejercicio del Módulo:</h4>
                        <p class="text-gray-700 mb-4">Instrucciones. - Analiza con todo cuidado las siguientes preguntas, contéstalas y anota qué acciones tomarás para que las cosas sucedan como tú lo deseas.</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">1. ¿Cómo es la relación con mi pareja actualmente?</label>
                                <textarea id="exercise_6_relacion_actual" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe cómo es actualmente tu relación de pareja...">${savedExercise.relacion_actual || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">2. ¿Cómo deseo que sea la relación con mi pareja?</label>
                                <textarea id="exercise_6_relacion_deseada" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe cómo deseas que sea tu relación de pareja...">${savedExercise.relacion_deseada || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">3. ¿Cómo visualizo la relación dentro de 3 o 5 años?</label>
                                <textarea id="exercise_6_vision_futuro" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Visualiza cómo quieres que sea tu relación en el futuro...">${savedExercise.vision_futuro || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">4. ¿Qué acciones emprenderé para que se cumpla esta visión?</label>
                                <textarea id="exercise_6_acciones_plan" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Define las acciones específicas que tomarás...">${savedExercise.acciones_plan || ''}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="saveModuleExercise(${chapter.id})" class="px-6 py-3 bg-arquitecto-navy text-white rounded-lg hover:bg-arquitecto-navy-dark transition-colors">
                        <i class="fas fa-dumbbell mr-2"></i>Completar Ejercicio
                    </button>
                </div>
            `;
        } else if (chapter.id === 7) {
            // Contenido específico para el Módulo 7: El Rol de Amigo
            const savedExercise = JSON.parse(localStorage.getItem(getUserKey(`exercise_${chapter.id}`)) || '{}');
            
            return `
                <div class="space-y-6">
                    <h3 class="text-xl font-bold">Ejercicios Prácticos</h3>
                    
                    <div class="bg-blue-50 border-l-4 border-blue-400 p-6 rounded-r-lg">
                        <h4 class="font-semibold mb-3">Ejercicio del Módulo:</h4>
                        <p class="text-gray-700 mb-4">Instrucciones. - Analiza con todo cuidado las siguientes preguntas, contéstalas y anota qué acciones tomarás para que las cosas sucedan como tú lo deseas.</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">1. ¿Cómo es la relación con mis amigos actualmente?</label>
                                <textarea id="exercise_7_relacion_actual" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe cómo es actualmente tu relación con tus amigos...">${savedExercise.relacion_actual || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">2. ¿Cómo deseo que sea la relación con mis amigos?</label>
                                <textarea id="exercise_7_relacion_deseada" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe cómo deseas que sea tu relación con tus amigos...">${savedExercise.relacion_deseada || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">3. ¿Cómo los visualizo dentro de 3 o 5 años?</label>
                                <textarea id="exercise_7_vision_futuro" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Visualiza cómo quieres que sean tus amistades en el futuro...">${savedExercise.vision_futuro || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">4. ¿Qué acciones emprenderé para que se cumpla esta visión?</label>
                                <textarea id="exercise_7_acciones_plan" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Define las acciones específicas que tomarás...">${savedExercise.acciones_plan || ''}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="saveModuleExercise(${chapter.id})" class="px-6 py-3 bg-arquitecto-navy text-white rounded-lg hover:bg-arquitecto-navy-dark transition-colors">
                        <i class="fas fa-dumbbell mr-2"></i>Completar Ejercicio
                    </button>
                </div>
            `;
        } else if (chapter.id === 8) {
            // Contenido específico para el Módulo 8: El Rol Profesional
            const savedExercise = JSON.parse(localStorage.getItem(getUserKey(`exercise_${chapter.id}`)) || '{}');
            
            return `
                <div class="space-y-6">
                    <h3 class="text-xl font-bold">Ejercicios Prácticos</h3>
                    
                    <div class="bg-blue-50 border-l-4 border-blue-400 p-6 rounded-r-lg">
                        <h4 class="font-semibold mb-3">Ejercicio del Módulo:</h4>
                        <p class="text-gray-700 mb-4">Instrucciones. - Analiza con todo cuidado las siguientes preguntas, contéstalas y anota qué acciones tomarás para que las cosas sucedan como tú lo deseas.</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">1. ¿Cómo me siento en este rol actualmente?</label>
                                <textarea id="exercise_8_sentimiento_actual" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe cómo te sientes en tu rol profesional actual...">${savedExercise.sentimiento_actual || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">2. ¿Cómo deseo que sea mi rol profesional?</label>
                                <textarea id="exercise_8_rol_deseado" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe cómo deseas que sea tu rol profesional...">${savedExercise.rol_deseado || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">3. ¿Cómo me visualizo dentro de 3 o 5 años en el plano profesional?</label>
                                <textarea id="exercise_8_vision_profesional" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Visualiza tu desarrollo profesional en 3-5 años...">${savedExercise.vision_profesional || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">4. ¿Qué acciones emprenderé para que se cumpla esta visión?</label>
                                <textarea id="exercise_8_acciones_vision" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Define las acciones específicas para lograr tu visión...">${savedExercise.acciones_vision || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">5. ¿Qué situaciones puedo mejorar?</label>
                                <textarea id="exercise_8_situaciones_mejorar" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Identifica situaciones profesionales que puedes mejorar...">${savedExercise.situaciones_mejorar || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">6. ¿Qué conocimientos, habilidades, actitudes o acciones necesito adquirir, mejorar, cambiar, o hacer que mejoren substancialmente mi desempeño?</label>
                                <textarea id="exercise_8_desarrollo_necesario" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Lista conocimientos, habilidades y actitudes a desarrollar...">${savedExercise.desarrollo_necesario || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">7. ¿Cuáles son los factores más vitales que tengo que cumplir?</label>
                                <textarea id="exercise_8_factores_vitales" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Identifica los factores más importantes para tu éxito profesional...">${savedExercise.factores_vitales || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">8. ¿Qué obstáculos veo que me impiden lograr esas metas?</label>
                                <textarea id="exercise_8_obstaculos" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Identifica los obstáculos que enfrentas para lograr tus metas...">${savedExercise.obstaculos || ''}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="saveModuleExercise(${chapter.id})" class="px-6 py-3 bg-arquitecto-navy text-white rounded-lg hover:bg-arquitecto-navy-dark transition-colors">
                        <i class="fas fa-dumbbell mr-2"></i>Completar Ejercicio
                    </button>
                </div>
            `;
        } else if (chapter.id === 9) {
            // Contenido específico para el Módulo 9: Conmigo Mismo
            const savedExercise = JSON.parse(localStorage.getItem(getUserKey(`exercise_${chapter.id}`)) || '{}');
            
            return `
                <div class="space-y-6">
                    <h3 class="text-xl font-bold">Ejercicios Prácticos</h3>
                    
                    <!-- Ejercicios de Ciudadanía -->
                    <div class="bg-blue-50 border-l-4 border-blue-400 p-6 rounded-r-lg">
                        <h4 class="font-semibold mb-3">Ejercicios del Módulo:</h4>
                        <p class="text-gray-700 mb-4">Instrucciones. - Analiza con todo cuidado las siguientes preguntas, contéstalas y anota qué acciones tomarás para que las cosas sucedan como tú lo deseas.</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">1. ¿Cómo me siento en mi rol de ciudadano actualmente?</label>
                                <textarea id="exercise_9_ciudadano_actual" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe cómo te sientes en tu rol de ciudadano actualmente...">${savedExercise.ciudadano_actual || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">2. ¿Cómo deseo que sea mi rol como ciudadano?</label>
                                <textarea id="exercise_9_ciudadano_deseado" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe cómo deseas que sea tu rol como ciudadano...">${savedExercise.ciudadano_deseado || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">3. ¿Cómo me visualizo dentro de 3 o 5 años en este rol ciudadano?</label>
                                <textarea id="exercise_9_vision_ciudadano" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Visualiza tu rol ciudadano en 3-5 años...">${savedExercise.vision_ciudadano || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">4. ¿Qué acciones emprenderé para que se cumpla esta visión?</label>
                                <textarea id="exercise_9_acciones_vision" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Define las acciones específicas para tu visión ciudadana...">${savedExercise.acciones_vision || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">5. ¿Qué situaciones considero que deseo y puedo mejorar?</label>
                                <textarea id="exercise_9_situaciones_mejorar" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Identifica situaciones que puedes mejorar...">${savedExercise.situaciones_mejorar || ''}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ejercicio Rueda de la Vida -->
                    <div class="bg-green-50 border-l-4 border-green-400 p-6 rounded-r-lg">
                        <h4 class="font-semibold mb-3">Ejercicio Especial: La Rueda de la Vida</h4>
                        <p class="text-gray-700 mb-4">A continuación, encontrarás el círculo de la vida, tiene el propósito de ayudarte a elaborar un diagnóstico de tu situación actual, valorando 8 aspectos que son relevantes en la vida. Cada aspecto deberá calificarse con un mínimo de 1 y un máximo de 10 puntos, partiendo de que el 1 se encuentra en el centro del círculo y 10 en la circunferencia.</p>
                        
                        <!-- Calificaciones con barras deslizantes -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">SALUD: <span id="salud_value" class="text-blue-600 font-bold">${savedExercise.salud || 5}</span></label>
                                <input type="range" id="salud_slider" min="1" max="10" value="${savedExercise.salud || 5}" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" onchange="updateLifeWheel()">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">DINERO: <span id="dinero_value" class="text-blue-600 font-bold">${savedExercise.dinero || 5}</span></label>
                                <input type="range" id="dinero_slider" min="1" max="10" value="${savedExercise.dinero || 5}" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" onchange="updateLifeWheel()">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">AMOR: <span id="amor_value" class="text-blue-600 font-bold">${savedExercise.amor || 5}</span></label>
                                <input type="range" id="amor_slider" min="1" max="10" value="${savedExercise.amor || 5}" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" onchange="updateLifeWheel()">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">FAMILIA: <span id="familia_value" class="text-blue-600 font-bold">${savedExercise.familia || 5}</span></label>
                                <input type="range" id="familia_slider" min="1" max="10" value="${savedExercise.familia || 5}" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" onchange="updateLifeWheel()">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">PROFESIÓN: <span id="profesion_value" class="text-blue-600 font-bold">${savedExercise.profesion || 5}</span></label>
                                <input type="range" id="profesion_slider" min="1" max="10" value="${savedExercise.profesion || 5}" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" onchange="updateLifeWheel()">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">DESARROLLO PERSONAL: <span id="desarrollo_value" class="text-blue-600 font-bold">${savedExercise.desarrollo || 5}</span></label>
                                <input type="range" id="desarrollo_slider" min="1" max="10" value="${savedExercise.desarrollo || 5}" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" onchange="updateLifeWheel()">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">OCIO: <span id="ocio_value" class="text-blue-600 font-bold">${savedExercise.ocio || 5}</span></label>
                                <input type="range" id="ocio_slider" min="1" max="10" value="${savedExercise.ocio || 5}" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" onchange="updateLifeWheel()">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">AMIGOS: <span id="amigos_value" class="text-blue-600 font-bold">${savedExercise.amigos || 5}</span></label>
                                <input type="range" id="amigos_slider" min="1" max="10" value="${savedExercise.amigos || 5}" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" onchange="updateLifeWheel()">
                            </div>
                        </div>
                        
                        <!-- Gráfica de la Rueda de la Vida -->
                        <div class="flex justify-center mb-6">
                            <canvas id="lifeWheelCanvas" width="400" height="400" class="border border-gray-300 rounded-lg"></canvas>
                        </div>
                        
                        <!-- Preguntas adicionales después de la gráfica -->
                        <div class="space-y-4">
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">1. Después de hacer el ejercicio del círculo de la vida, según tus resultados enumera por orden de prioridad las áreas de tu vida en las que tienes que trabajar:</label>
                                <textarea id="exercise_9_areas_prioridad" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Enumera las áreas por orden de prioridad...">${savedExercise.areas_prioridad || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">2. Enfócate en tus 2 primeras áreas. ¿Qué obstáculos en tu vida sabes que necesitas hacerles frente, pero has estado evitándolos?</label>
                                <textarea id="exercise_9_obstaculos" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Identifica los obstáculos que has estado evitando...">${savedExercise.obstaculos || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">3. Si no fuera por los juicios y expectativas tanto de otros como tuyos, ¿qué harías en tu vida en este momento para ti y tu salud integral que te sientes inhibido a hacer?</label>
                                <textarea id="exercise_9_inhibiciones" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe qué harías sin juicios ni expectativas...">${savedExercise.inhibiciones || ''}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="saveModuleExercise(${chapter.id})" class="px-6 py-3 bg-arquitecto-navy text-white rounded-lg hover:bg-arquitecto-navy-dark transition-colors">
                        <i class="fas fa-dumbbell mr-2"></i>Completar Ejercicio
                    </button>
                </div>
            `;
        } else if (chapter.id === 10) {
            // Contenido específico para el Módulo 10: Conclusiones
            const savedExercise = JSON.parse(localStorage.getItem(getUserKey(`exercise_${chapter.id}`)) || '{}');
            
            return `
                <div class="space-y-6">
                    <h3 class="text-xl font-bold">Ejercicios Prácticos</h3>
                    
                    <div class="bg-blue-50 border-l-4 border-blue-400 p-6 rounded-r-lg">
                        <h4 class="font-semibold mb-3">Ejercicios del Módulo:</h4>
                        <p class="text-gray-700 mb-4">Hemos arribado a la parte final y, a la vez, a la parte más importante. En esta última etapa, habrás de reflexionar en conjunto todo lo que hasta ahora se ha analizado y, con las herramientas que has obtenido de la filosofía del "Arquitecto de tu Destino", enfrentarás el último reto del curso y el primero de tu nueva etapa en la vida: la aplicación práctica de lo aprendido.</p>
                        <p class="text-gray-700 mb-4">Para contestar estos últimos ejercicios, haz uso de todo lo que has leído, comentado, reflexionado y aprendido; toma las herramientas con las que ya contabas y, en comunión con las que ahora has obtenido, prepárate para elaborar tu visión y para que, aplicando en tu vida las acciones que has diseñado, te conviertas en el Arquitecto de tu destino.</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">1. Piensa en el entorno que desearías tener para los próximos 1, 3, 5 o 10 años, piensa en lo que tú más desearías ser o tener. Incluye diversos aspectos de tu persona, como la Pareja, Hijos, Padres, Familia, Amigos, Hermanos, Trabajo, posesiones, logros personales, posiciones, aspectos sociales, etc. Lo que tú redactes, te debes llenar plenamente, debe reflejar lo que Tú eres y lo que Tú piensas, busca que tu redacción sea inspiradora y alentadora.</label>
                                <textarea id="exercise_10_vision_integral" class="w-full p-3 border border-gray-300 rounded-lg" rows="6" placeholder="Describe tu visión integral para los próximos años...">${savedExercise.vision_integral || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">2. ¿Cuáles cualidades de un emprendedor consideras que tienes tú? Ejemplo: tenacidad, audacia, temple, proactividad, disciplina, independencia, valor etc.</label>
                                <textarea id="exercise_10_cualidades_emprendedor" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Identifica tus cualidades emprendedoras...">${savedExercise.cualidades_emprendedor || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">3. El objetivo de este ejercicio es pedirte que analices: ¿Qué situaciones deseas cambiar?</label>
                                <textarea id="exercise_10_situaciones_cambiar" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe las situaciones que deseas cambiar...">${savedExercise.situaciones_cambiar || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">4. ¿Qué proyectos tienes en mente?</label>
                                <textarea id="exercise_10_proyectos_mente" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe los proyectos que tienes en mente...">${savedExercise.proyectos_mente || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">5. ¿Qué cosas deseas emprender en ti mismo?</label>
                                <textarea id="exercise_10_emprender_personal" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe lo que deseas emprender en ti mismo...">${savedExercise.emprender_personal || ''}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="saveModuleExercise(${chapter.id})" class="px-6 py-3 bg-arquitecto-navy text-white rounded-lg hover:bg-arquitecto-navy-dark transition-colors">
                        <i class="fas fa-dumbbell mr-2"></i>Completar Ejercicio
                    </button>
                </div>
            `;
        } else {
            // Contenido genérico para otros módulos
            return `
                <div class="space-y-6">
                    <h3 class="text-xl font-bold">Ejercicios Prácticos</h3>
                    
                    <div class="bg-blue-50 border-l-4 border-blue-400 p-6 rounded-r-lg">
                        <h4 class="font-semibold mb-3">Ejercicio del Módulo:</h4>
                        <p class="text-gray-700 mb-4">Completa los siguientes ejercicios para profundizar en el contenido del módulo.</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Ejercicio 1: Autoevaluación</label>
                                <textarea class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe tu situación actual respecto a este módulo..."></textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Ejercicio 2: Plan de Acción</label>
                                <textarea class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Define 3 acciones específicas que tomarás..."></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="saveExercise(${chapter.id})" class="px-6 py-3 bg-arquitecto-navy text-white rounded-lg hover:bg-arquitecto-navy-dark transition-colors">
                        <i class="fas fa-dumbbell mr-2"></i>Completar Ejercicio
                    </button>
                </div>
            `;
        }
    }
    
    // === FUNCIONES AUXILIARES PARA ANÁLISIS FODA ===
    
    function generateFODATable(savedFoda) {
        const categories = ['fortalezas', 'debilidades', 'amenazas', 'oportunidades'];
        const labels = ['Fortalezas', 'Debilidades', 'Amenazas', 'Oportunidades'];
        const colors = ['bg-green-100', 'bg-red-100', 'bg-orange-100', 'bg-blue-100'];
        
        return `
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                ${categories.map((category, index) => `
                    <div class="border border-gray-300 rounded-lg ${colors[index]} p-4">
                        <h5 class="font-semibold text-center mb-3">${labels[index]}</h5>
                        <div id="${category}Section">
                            ${generateFODAItems(category, savedFoda[category] || [])}
                        </div>
                        <div class="text-center mt-3">
                            <button onclick="addFODAItem('${category}')" class="px-3 py-1 bg-gray-600 text-white text-sm rounded hover:bg-gray-700 transition-colors">
                                <i class="fas fa-plus mr-1"></i>Agregar
                            </button>
                        </div>
                        <div class="text-center mt-2">
                            <span class="text-sm font-medium">Total: </span>
                            <span id="${category}Total" class="text-sm font-bold">0</span>
                            <span class="text-sm">/100</span>
                        </div>
                    </div>
                `).join('')}
            </div>
        `;
    }
    
    function generateFODAItems(category, items) {
        if (!items || items.length === 0) {
            items = [{ text: '', value: 0 }];
        }
        
        return items.map((item, index) => `
            <div class="flex items-center space-x-2 mb-2" data-category="${category}" data-index="${index}">
                <input type="text" class="flex-1 p-2 border border-gray-300 rounded text-sm foda-text" 
                       placeholder="Describe aquí..." value="${item.text || ''}" 
                       onchange="updateFODAData('${category}', ${index}, 'text', this.value)">
                <input type="number" class="w-16 p-2 border border-gray-300 rounded text-sm text-center foda-value" 
                       min="0" max="100" value="${item.value || 0}" 
                       onchange="updateFODAData('${category}', ${index}, 'value', parseInt(this.value) || 0)">
                ${items.length > 1 ? `<button onclick="removeFODAItem('${category}', ${index})" class="p-1 text-red-600 hover:text-red-800"><i class="fas fa-trash text-xs"></i></button>` : ''}
            </div>
        `).join('');
    }
    
    function addFODAItem(category) {
        const section = document.getElementById(`${category}Section`);
        const items = section.querySelectorAll(`[data-category="${category}"]`);
        
        if (items.length >= 4) {
            Swal.fire({
                icon: 'warning',
                title: 'Límite alcanzado',
                text: 'Solo puedes agregar hasta 4 elementos por categoría',
                confirmButtonColor: '#4a9fc7'
            });
            return;
        }
        
        const newIndex = items.length;
        const newItemHTML = `
            <div class="flex items-center space-x-2 mb-2" data-category="${category}" data-index="${newIndex}">
                <input type="text" class="flex-1 p-2 border border-gray-300 rounded text-sm foda-text" 
                       placeholder="Describe aquí..." value="" 
                       onchange="updateFODAData('${category}', ${newIndex}, 'text', this.value)">
                <input type="number" class="w-16 p-2 border border-gray-300 rounded text-sm text-center foda-value" 
                       min="0" max="100" value="0" 
                       onchange="updateFODAData('${category}', ${newIndex}, 'value', parseInt(this.value) || 0)">
                <button onclick="removeFODAItem('${category}', ${newIndex})" class="p-1 text-red-600 hover:text-red-800"><i class="fas fa-trash text-xs"></i></button>
            </div>
        `;
        
         section.insertAdjacentHTML('beforeend', newItemHTML);
         updateFODATotal(category);
     }
    
    function removeFODAItem(category, index) {
        const item = document.querySelector(`[data-category="${category}"][data-index="${index}"]`);
         if (item) {
             item.remove();
             updateFODATotal(category);
         }
    }
    
     function updateFODAData(category, index, field, value) {
         updateFODATotal(category);
     }
    
    function updateFODATotal(category) {
        const items = document.querySelectorAll(`[data-category="${category}"] .foda-value`);
        let total = 0;
        items.forEach(input => {
            total += parseInt(input.value) || 0;
        });
        
        const totalSpan = document.getElementById(`${category}Total`);
        if (totalSpan) {
            totalSpan.textContent = total;
            totalSpan.className = total === 100 ? 'text-sm font-bold text-green-600' : 
                                 total > 100 ? 'text-sm font-bold text-red-600' : 
                                 'text-sm font-bold text-gray-600';
        }
    }
    
    
    function generateCompromisoContent(chapter) {
        if (chapter.id === 1) {
            // Contenido específico para el Módulo 1: El Emprendedor
            const savedCommitments = JSON.parse(localStorage.getItem(getUserKey(`commitment_${chapter.id}`)) || '{}');
            
            return `
                <div class="space-y-6">
                    <h3 class="text-xl font-bold">Mis Compromisos</h3>
                    
                    <div class="bg-green-50 border-l-4 border-green-400 p-6 rounded-r-lg">
                        <h4 class="font-semibold mb-3">Basado en lo aprendido en este módulo, me comprometo a:</h4>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Aspectos que mejoraré en lo profesional (qué, cuándo, cómo):</label>
                                <textarea id="commitment_1_profesional" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe los aspectos profesionales que mejorarás...">${savedCommitments.profesional || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Aspectos que mejoraré en lo personal, involucra aspectos tanto físicos como espirituales, (qué, cuándo, cómo):</label>
                                <textarea id="commitment_1_personal" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe los aspectos personales (físicos y espirituales) que mejorarás...">${savedCommitments.personal || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Aspectos que mejoraré en lo familiar, (qué, cuándo, cómo):</label>
                                <textarea id="commitment_1_familiar" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe los aspectos familiares que mejorarás...">${savedCommitments.familiar || ''}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button onclick="saveModuleCommitment(${chapter.id})" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-handshake mr-2"></i>Crear Compromiso
                        </button>
                        <button onclick="addCommitmentToCalendar(${chapter.id})" class="px-6 py-3 bg-arquitecto-blue text-white rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                            <i class="fas fa-calendar-plus mr-2"></i>Agregar al Calendario
                        </button>
                    </div>
                </div>
            `;
        } else if (chapter.id === 2) {
            // Contenido específico para el Módulo 2: La Visión
            const savedCommitments = JSON.parse(localStorage.getItem(getUserKey(`commitment_${chapter.id}`)) || '{}');
            
            return `
                <div class="space-y-6">
                    <h3 class="text-xl font-bold">Mis Compromisos</h3>
                    
                    <div class="bg-green-50 border-l-4 border-green-400 p-6 rounded-r-lg">
                        <h4 class="font-semibold mb-3">Basado en lo aprendido en este módulo, me comprometo a:</h4>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Mi visión específica escrita con fechas concretas:</label>
                                <textarea id="commitment_2_vision" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe tu visión específica con fechas concretas...">${savedCommitments.vision || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Plan para desarrollar autocontrol y libertad interior:</label>
                                <textarea id="commitment_2_autocontrol" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe tu plan para desarrollar autocontrol y libertad interior...">${savedCommitments.autocontrol || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Compromiso de revisar y ajustar mi visión regularmente:</label>
                                <textarea id="commitment_2_revision" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe cómo y cuándo revisarás tu visión...">${savedCommitments.revision || ''}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button onclick="saveModuleCommitment(${chapter.id})" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-handshake mr-2"></i>Crear Compromiso
                        </button>
                        <button onclick="addCommitmentToCalendar(${chapter.id})" class="px-6 py-3 bg-arquitecto-blue text-white rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                            <i class="fas fa-calendar-plus mr-2"></i>Agregar al Calendario
                        </button>
                    </div>
                </div>
            `;
        } else if (chapter.id === 3) {
            // Contenido específico para el Módulo 3: En Mi Relación con Dios
            const savedCommitments = JSON.parse(localStorage.getItem(getUserKey(`commitment_${chapter.id}`)) || '{}');
            
            return `
                <div class="space-y-6">
                    <h3 class="text-xl font-bold">Mis Compromisos</h3>
                    
                    <div class="bg-green-50 border-l-4 border-green-400 p-6 rounded-r-lg">
                        <h4 class="font-semibold mb-3"><strong>Basado en lo aprendido en este módulo, me comprometo a:</strong></h4>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Un defecto específico que transformaré en virtud:</label>
                                <textarea id="commitment_3_defecto" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe el defecto específico que transformarás y cómo lo harás...">${savedCommitments.defecto_virtud || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">¿De qué forma practicaré la regla de oro?</label>
                                <textarea id="commitment_3_regla" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe cómo aplicarás la regla de oro en tu vida diaria...">${savedCommitments.regla_oro || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Aspectos que mejoraré para mantener mi brújula y hacer lo correcto siempre (qué, cuándo, cómo):</label>
                                <textarea id="commitment_3_brujula" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe los aspectos específicos que mejorarás para mantener tu brújula moral...">${savedCommitments.brujula_moral || ''}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button onclick="saveModuleCommitment(${chapter.id})" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-handshake mr-2"></i>Crear Compromiso
                        </button>
                        <button onclick="addCommitmentToCalendar(${chapter.id})" class="px-6 py-3 bg-arquitecto-blue text-white rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                            <i class="fas fa-calendar-plus mr-2"></i>Agregar al Calendario
                        </button>
                    </div>
                </div>
            `;
        } else if (chapter.id === 4) {
            // Contenido específico para el Módulo 4: El Rol de Hijo
            const savedCommitments = JSON.parse(localStorage.getItem(getUserKey(`commitment_${chapter.id}`)) || '{}');
            
            return `
                <div class="space-y-6">
                    <h3 class="text-xl font-bold">Mis Compromisos</h3>
                    
                    <div class="bg-green-50 border-l-4 border-green-400 p-6 rounded-r-lg">
                        <h4 class="font-semibold mb-3">Compromiso Personal:</h4>
                        <p class="text-gray-700 mb-4">Define tu compromiso específico para este módulo. Sé concreto y establece fechas.</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">¿Qué me comprometo a hacer?</label>
                                <textarea id="commitment_4_accion" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe tu compromiso específico como hijo...">${savedCommitments.accion || ''}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button onclick="saveModuleCommitment(${chapter.id})" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-handshake mr-2"></i>Crear Compromiso
                        </button>
                        <button onclick="addCommitmentToCalendar(${chapter.id})" class="px-6 py-3 bg-arquitecto-blue text-white rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                            <i class="fas fa-calendar-plus mr-2"></i>Agregar al Calendario
                        </button>
                    </div>
                </div>
            `;
        } else if (chapter.id === 5) {
            // Contenido específico para el Módulo 5: El Rol de Padre
            const savedCommitments = JSON.parse(localStorage.getItem(getUserKey(`commitment_${chapter.id}`)) || '{}');
            
            return `
                <div class="space-y-6">
                    <h3 class="text-xl font-bold">Mis Compromisos</h3>
                    
                    <div class="bg-green-50 border-l-4 border-green-400 p-6 rounded-r-lg">
                        <h4 class="font-semibold mb-3"><strong>Basado en lo aprendido en este módulo, me comprometo a:</strong></h4>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Tiempo específico semanal que dedicaré a mis padres:</label>
                                <textarea id="commitment_5_tiempo_padres" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Define específicamente cuánto tiempo semanal dedicarás a tus padres y cómo lo distribuirás...">${savedCommitments.tiempo_padres || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Acciones concretas para involucrarme más con ellos (qué, cómo, cuándo ):</label>
                                <textarea id="commitment_5_acciones_involucrarme" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe las acciones específicas que realizarás para involucrarte más con tus padres...">${savedCommitments.acciones_involucrarme || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Plan para crear nuevos recuerdos y tradiciones familiares (qué, cómo, cuándo):</label>
                                <textarea id="commitment_5_plan_recuerdos" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Detalla tu plan para crear nuevos recuerdos y tradiciones familiares...">${savedCommitments.plan_recuerdos || ''}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button onclick="saveModuleCommitment(${chapter.id})" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-handshake mr-2"></i>Crear Compromiso
                        </button>
                        <button onclick="addCommitmentToCalendar(${chapter.id})" class="px-6 py-3 bg-arquitecto-blue text-white rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                            <i class="fas fa-calendar-plus mr-2"></i>Agregar al Calendario
                        </button>
                    </div>
                </div>
            `;
        } else if (chapter.id === 6) {
            // Contenido específico para el Módulo 6: El Rol de Pareja
            const savedCommitments = JSON.parse(localStorage.getItem(getUserKey(`commitment_${chapter.id}`)) || '{}');
            
            return `
                <div class="space-y-6">
                    <h3 class="text-xl font-bold">Mis Compromisos</h3>
                    
                    <div class="bg-green-50 border-l-4 border-green-400 p-6 rounded-r-lg">
                        <h4 class="font-semibold mb-3">Compromiso Personal:</h4>
                        <p class="text-gray-700 mb-4">Define tu compromiso específico para este módulo. Sé concreto y establece fechas.</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Plan específico para mejorar la relación con mi pareja (qué, cuándo, dónde).</label>
                                <textarea id="commitment_6_plan_mejorar" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Define tu plan específico para mejorar la relación con tu pareja...">${savedCommitments.plan_mejorar || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Tiempo semanal dedicado exclusivamente a la pareja:</label>
                                <textarea id="commitment_6_tiempo_semanal" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Define cuánto tiempo semanal dedicarás exclusivamente a tu pareja...">${savedCommitments.tiempo_semanal || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Acciones en conjunto que fortalezca la relación conyugal (qué, cuándo, dónde):</label>
                                <textarea id="commitment_6_acciones_conjunto" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe las acciones en conjunto que fortalecerán tu relación conyugal...">${savedCommitments.acciones_conjunto || ''}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button onclick="saveModuleCommitment(${chapter.id})" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-handshake mr-2"></i>Crear Compromiso
                        </button>
                        <button onclick="addCommitmentToCalendar(${chapter.id})" class="px-6 py-3 bg-arquitecto-blue text-white rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                            <i class="fas fa-calendar-plus mr-2"></i>Agregar al Calendario
                        </button>
                    </div>
                </div>
            `;
        } else if (chapter.id === 7) {
            // Contenido específico para el Módulo 7: El Rol de Amigo
            const savedCommitments = JSON.parse(localStorage.getItem(getUserKey(`commitment_${chapter.id}`)) || '{}');
            
            return `
                <div class="space-y-6">
                    <h3 class="text-xl font-bold">Mis Compromisos</h3>
                    
                    <div class="bg-green-50 border-l-4 border-green-400 p-6 rounded-r-lg">
                        <h4 class="font-semibold mb-3">Compromiso Personal:</h4>
                        <p class="text-gray-700 mb-4">Define tu compromiso específico para este módulo. Sé concreto y establece fechas.</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Plan específico para mantener y fortalecer mis amistades más importantes (qué, cuándo, dónde):</label>
                                <textarea id="commitment_7_plan_amistades" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Define tu plan específico para mantener y fortalecer tus amistades más importantes...">${savedCommitments.plan_amistades || ''}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button onclick="saveModuleCommitment(${chapter.id})" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-handshake mr-2"></i>Crear Compromiso
                        </button>
                        <button onclick="addCommitmentToCalendar(${chapter.id})" class="px-6 py-3 bg-arquitecto-blue text-white rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                            <i class="fas fa-calendar-plus mr-2"></i>Agregar al Calendario
                        </button>
                    </div>
                </div>
            `;
        } else if (chapter.id === 8) {
            // Contenido específico para el Módulo 8: El Rol Profesional
            const savedCommitments = JSON.parse(localStorage.getItem(getUserKey(`commitment_${chapter.id}`)) || '{}');
            
            return `
                <div class="space-y-6">
                    <h3 class="text-xl font-bold">Mis Compromisos</h3>
                    
                    <div class="bg-green-50 border-l-4 border-green-400 p-6 rounded-r-lg">
                        <h4 class="font-semibold mb-3">Compromiso Personal:</h4>
                        <p class="text-gray-700 mb-4"><strong>Basado en lo aprendido en este módulo, me comprometo a:</strong></p>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Considerando lo analizado hasta el momento, ¿Cuál sería tu meta profesional en específico?</label>
                                <textarea id="commitment_8_meta_profesional" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Define tu meta profesional específica...">${savedCommitments.meta_profesional || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Detalla tu plan de acción para lograr la meta que deseas en lo profesional (qué, cuándo, dónde).</label>
                                <textarea id="commitment_8_plan_accion" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe tu plan de acción detallado (qué, cuándo, dónde)...">${savedCommitments.plan_accion || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Describe cuál sería tu estrategia para lograr tu objetivo profesional</label>
                                <textarea id="commitment_8_estrategia" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Define tu estrategia para lograr tu objetivo profesional...">${savedCommitments.estrategia || ''}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button onclick="saveModuleCommitment(${chapter.id})" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-handshake mr-2"></i>Crear Compromiso
                        </button>
                        <button onclick="addCommitmentToCalendar(${chapter.id})" class="px-6 py-3 bg-arquitecto-blue text-white rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                            <i class="fas fa-calendar-plus mr-2"></i>Agregar al Calendario
                        </button>
                    </div>
                </div>
            `;
        } else if (chapter.id === 9) {
            // Contenido específico para el Módulo 9: Conmigo Mismo
            const savedCommitments = JSON.parse(localStorage.getItem(getUserKey(`commitment_${chapter.id}`)) || '{}');
            
            return `
                <div class="space-y-6">
                    <h3 class="text-xl font-bold">Mis Compromisos</h3>
                    
                    <div class="bg-green-50 border-l-4 border-green-400 p-6 rounded-r-lg">
                        <h4 class="font-semibold mb-3">Compromiso Personal:</h4>
                        <p class="text-gray-700 mb-4"><strong>Basado en lo aprendido en este módulo, me comprometo a:</strong></p>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Acción específica de contribución ciudadana:</label>
                                <textarea id="commitment_9_contribucion_ciudadana" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe tu acción específica de contribución como ciudadano...">${savedCommitments.contribucion_ciudadana || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Plan para involucrarme como ciudadano (qué, cómo, dónde):</label>
                                <textarea id="commitment_9_plan_ciudadano" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Detalla tu plan de involucramiento ciudadano...">${savedCommitments.plan_ciudadano || ''}</textarea>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Plan de mejora en las 2 áreas más bajas del Círculo de Vida (qué, cuándo, dónde):</label>
                                <textarea id="commitment_9_mejora_areas" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Describe tu plan de mejora para las 2 áreas más bajas de tu círculo de vida...">${savedCommitments.mejora_areas || ''}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button onclick="saveModuleCommitment(${chapter.id})" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-handshake mr-2"></i>Crear Compromiso
                        </button>
                        <button onclick="addCommitmentToCalendar(${chapter.id})" class="px-6 py-3 bg-arquitecto-blue text-white rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                            <i class="fas fa-calendar-plus mr-2"></i>Agregar al Calendario
                        </button>
                    </div>
                </div>
            `;
        } else if (chapter.id === 10) {
            // Contenido específico para el Módulo 10: Conclusiones
            const savedCommitments = JSON.parse(localStorage.getItem(getUserKey(`commitment_${chapter.id}`)) || '{}');
            
            return `
                <div class="space-y-6">
                    <h3 class="text-xl font-bold">Mis Compromisos</h3>
                    
                    <div class="bg-green-50 border-l-4 border-green-400 p-6 rounded-r-lg">
                        <h4 class="font-semibold mb-3">Compromiso Personal:</h4>
                        <p class="text-gray-700 mb-4"><strong>Basado en lo aprendido en este módulo, me comprometo a:</strong></p>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">Una vez que tomes conciencia de qué realmente necesitas para cuidar de tu salud integral, puedes comenzar a hacerle frente a las áreas de tu vida que no están en consonancia con tu verdad. Ahora toma acción y crea 5 objetivos pequeños y razonables para que, cada semana, te muevas en la dirección en la que deseas ir para tu salud física, emocional y mental</label>
                                <textarea id="commitment_10_salud_objetivos" class="w-full p-3 border border-gray-300 rounded-lg" rows="6" placeholder="Describe tu compromiso con tu salud integral y tus 5 objetivos semanales...">${savedCommitments.salud_objetivos || ''}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button onclick="saveModuleCommitment(${chapter.id})" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-handshake mr-2"></i>Crear Compromiso
                        </button>
                        <button onclick="addCommitmentToCalendar(${chapter.id})" class="px-6 py-3 bg-arquitecto-blue text-white rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                            <i class="fas fa-calendar-plus mr-2"></i>Agregar al Calendario
                        </button>
                    </div>
                </div>
            `;
        } else {
            // Contenido genérico para otros módulos
            return `
                <div class="space-y-6">
                    <h3 class="text-xl font-bold">Mis Compromisos</h3>
                    
                    <div class="bg-green-50 border-l-4 border-green-400 p-6 rounded-r-lg">
                        <h4 class="font-semibold mb-3">Compromiso Personal:</h4>
                        <p class="text-gray-700 mb-4">Define tu compromiso específico para este módulo. Sé concreto y establece fechas.</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">¿Qué me comprometo a hacer?</label>
                                <textarea class="w-full p-3 border border-gray-300 rounded-lg" rows="3" placeholder="Describe tu compromiso específico..."></textarea>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block font-medium text-gray-800 mb-2">Fecha de inicio:</label>
                                    <input type="date" class="w-full p-3 border border-gray-300 rounded-lg">
                                </div>
                                <div>
                                    <label class="block font-medium text-gray-800 mb-2">Fecha objetivo:</label>
                                    <input type="date" class="w-full p-3 border border-gray-300 rounded-lg">
                                </div>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-800 mb-2">¿Cómo mediré mi progreso?</label>
                                <textarea class="w-full p-3 border border-gray-300 rounded-lg" rows="2" placeholder="Define indicadores de seguimiento..."></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button onclick="saveCommitment(${chapter.id})" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-handshake mr-2"></i>Crear Compromiso
                        </button>
                        <button onclick="addToCalendar(${chapter.id})" class="px-6 py-3 bg-arquitecto-blue text-white rounded-lg hover:bg-arquitecto-blue-dark transition-colors">
                            <i class="fas fa-calendar-plus mr-2"></i>Agregar al Calendario
                        </button>
                    </div>
                </div>
            `;
        }
    }

    // Inicialización
    console.log('🏗️ Arquitecto de tu Destino - Portal Cargado');
    console.log('📚 Basado en el libro de Eugenio Baeza Fares');
    console.log('✨ "Eres el arquitecto de tu destino. Eres lo que haces de ti mismo."');
    console.log('🎨 Diseño moderno con colores arquitecto-navy y arquitecto-blue');
    console.log('🎬 Sistema de videos implementado con 30 videos en 10 módulos + video de fondo');
    console.log('📅 Sistema de calendario implementado - Genera archivos .ics para compromisos');

    // Funciones para la Rueda de la Vida del Módulo 9
    function updateLifeWheel() {
        if (document.getElementById('salud_value')) {
            document.getElementById('salud_value').textContent = document.getElementById('salud_slider').value;
            document.getElementById('dinero_value').textContent = document.getElementById('dinero_slider').value;
            document.getElementById('amor_value').textContent = document.getElementById('amor_slider').value;
            document.getElementById('familia_value').textContent = document.getElementById('familia_slider').value;
            document.getElementById('profesion_value').textContent = document.getElementById('profesion_slider').value;
            document.getElementById('desarrollo_value').textContent = document.getElementById('desarrollo_slider').value;
            document.getElementById('ocio_value').textContent = document.getElementById('ocio_slider').value;
            document.getElementById('amigos_value').textContent = document.getElementById('amigos_slider').value;
            drawLifeWheel();
        }
    }
    
    function drawLifeWheel() {
        const canvas = document.getElementById('lifeWheelCanvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const maxRadius = 150;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const values = [
            parseInt(document.getElementById('salud_slider').value),
            parseInt(document.getElementById('dinero_slider').value),
            parseInt(document.getElementById('amor_slider').value),
            parseInt(document.getElementById('familia_slider').value),
            parseInt(document.getElementById('profesion_slider').value),
            parseInt(document.getElementById('desarrollo_slider').value),
            parseInt(document.getElementById('ocio_slider').value),
            parseInt(document.getElementById('amigos_slider').value)
        ];
        const labels = ['SALUD', 'DINERO', 'AMOR', 'FAMILIA', 'PROFESION', 'DESARROLLO', 'OCIO', 'AMIGOS'];
        ctx.strokeStyle = '#e5e7eb';
        ctx.lineWidth = 1;
        for (let i = 1; i <= 10; i++) {
            ctx.beginPath();
            ctx.arc(centerX, centerY, (maxRadius * i) / 10, 0, 2 * Math.PI);
            ctx.stroke();
        }
        ctx.strokeStyle = '#e5e7eb';
        for (let i = 0; i < 8; i++) {
            const angle = (i * Math.PI * 2) / 8 - Math.PI / 2;
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(centerX + Math.cos(angle) * maxRadius, centerY + Math.sin(angle) * maxRadius);
            ctx.stroke();
        }
        ctx.fillStyle = 'rgba(59, 130, 246, 0.3)';
        ctx.strokeStyle = '#3b82f6';
        ctx.lineWidth = 2;
        ctx.beginPath();
        for (let i = 0; i < 8; i++) {
            const angle = (i * Math.PI * 2) / 8 - Math.PI / 2;
            const radius = (maxRadius * values[i]) / 10;
            const x = centerX + Math.cos(angle) * radius;
            const y = centerY + Math.sin(angle) * radius;
            if (i === 0) {
                ctx.moveTo(x, y);
            } else {
                ctx.lineTo(x, y);
            }
        }
        ctx.closePath();
        ctx.fill();
        ctx.stroke();
        ctx.fillStyle = '#3b82f6';
        ctx.font = '12px Arial';
        ctx.textAlign = 'center';
        for (let i = 0; i < 8; i++) {
            const angle = (i * Math.PI * 2) / 8 - Math.PI / 2;
            const radius = (maxRadius * values[i]) / 10;
            const x = centerX + Math.cos(angle) * radius;
            const y = centerY + Math.sin(angle) * radius;
            ctx.beginPath();
            ctx.arc(x, y, 4, 0, 2 * Math.PI);
            ctx.fill();
            const labelX = centerX + Math.cos(angle) * (maxRadius + 20);
            const labelY = centerY + Math.sin(angle) * (maxRadius + 20);
            ctx.fillStyle = '#374151';
            ctx.fillText(labels[i], labelX, labelY);
            ctx.fillStyle = '#3b82f6';
        }
    }

    // Inicializar la rueda de la vida cuando se cambie al módulo 9
    function initializeLifeWheel() {
        setTimeout(() => {
            if (document.getElementById('lifeWheelCanvas')) {
                updateLifeWheel();
            }
        }, 100);
    }
   </script>

    <!-- Script de inicialización inmediata para evitar flash del login -->
    <script>
        // Ejecutar checkSessionState inmediatamente para mostrar la pantalla correcta
        checkSessionState();
    </script>
</body>
</html>
